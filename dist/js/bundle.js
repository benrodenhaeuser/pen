!function(){"use strict";const t={create:(e=[])=>Object.create(t).init(e),init(t){if(!(t instanceof Array))throw new Error("Create Class instances from array!");return this.list=[...t],this},toString(){return this.list.join(" ")},toJSON(){return this.list},includes(t){return this.list.indexOf(t)>=0},add(e){return this.includes(e)?t.create(this.list):t.create([...this.list,e])},remove(e){return t.create(this.list.filter(t=>t!==e))}},e=()=>{return Math.random().toString(36).substring(2)+(new Date).getTime().toString(36)},n=(t,e={},...n)=>({tag:t,props:e,children:n||[]}),r=8,i=18,s=5.5,o=(t,e)=>{const n=t.doc.canvasWidth/t.canvas.viewBox.size.x;return e/t.globalScaleFactor()/n},l=t=>t.transform&&t.transform.toString()||"matrix(1, 0, 0, 1, 0, 0)",a={canvas:t=>({tag:"svg",children:[],props:{"data-key":t.key,"data-type":t.type,viewBox:t.viewBox.toString(),xmlns:t.xmlns,class:t.class.toString()}}),group:t=>({tag:"g",children:[],props:{"data-key":t.key,"data-type":t.type,transform:l(t),class:t.class.toString()}}),wrapper:t=>n("g",{"data-type":`${t.type}-wrapper`,"data-key":t.key}),outerUI(t){const e=n("g",{"data-type":"outerUI","data-key":t.key}),r=this.frame(t),i=this.dots(t),s=this.corners(t);e.children.push(r);for(let t of i)e.children.push(t);for(let t of s)e.children.push(t);return e},corners(t){const e=n("rect",{"data-type":"nw-corner"}),i=n("rect",{"data-type":"sw-corner"}),s=n("rect",{"data-type":"ne-corner"}),a=n("rect",{"data-type":"se-corner"}),c=[e,i,s,a],h=o(t,r);for(let e of c)Object.assign(e.props,{"data-key":t.key,transform:l(t),width:h,height:h});return Object.assign(e.props,{x:t.bounds.x-h/2,y:t.bounds.y-h/2}),Object.assign(i.props,{x:t.bounds.x-h/2,y:t.bounds.y+t.bounds.height-h/2}),Object.assign(s.props,{x:t.bounds.x+t.bounds.width-h/2,y:t.bounds.y-h/2}),Object.assign(a.props,{x:t.bounds.x+t.bounds.width-h/2,y:t.bounds.y+t.bounds.height-h/2}),c},dots(t){const e=n("circle"),r=n("circle"),s=n("circle"),a=n("circle"),c=[e,r,s,a],h=o(t,i)/2;for(let e of c)Object.assign(e.props,{"data-type":"dot","data-key":t.key,transform:l(t),r:h});return Object.assign(e.props,{cx:t.bounds.x-h/2,cy:t.bounds.y-h/2}),Object.assign(r.props,{cx:t.bounds.x-h/2,cy:t.bounds.y+t.bounds.height+h/2}),Object.assign(s.props,{cx:t.bounds.x+t.bounds.width+h/2,cy:t.bounds.y-h/2}),Object.assign(a.props,{cx:t.bounds.x+t.bounds.width+h/2,cy:t.bounds.y+t.bounds.height+h/2}),c},frame:t=>n("rect",{"data-type":"frame",x:t.bounds.x,y:t.bounds.y,width:t.bounds.width,height:t.bounds.height,transform:l(t),"data-key":t.key}),curves(t){const e=o(t,s)/2,r=this.curveParts(t),i=n("circle",{"data-type":"splitter",r:e,cx:t.splitter.x,cy:t.splitter.y,transform:l(t)});return n("g",{"data-type":"shape","data-key":t.key,class:t.class.toString()},this.shapeFill(t),...r,i)},shapeFill:t=>({tag:"path",children:[],props:{"data-type":t.type,"data-key":t.key,d:t.toPathString(),transform:l(t),fill:t.fill}}),curveParts(t){const e=[],n=t.children;for(let r of n){const n=r.children,i=r.curves();for(let r=0;r<i.length;r+=1)e.push({tag:"path",children:[],props:{"data-type":"curve","data-key":n[r].key,d:i[r].toPathString(),transform:l(t)}}),e.push({tag:"path",children:[],props:{"data-type":"curve-stroke",d:i[r].toPathString(),transform:l(t),stroke:t.stroke}})}return e},segments(t){const e=t.children[0],r=n("g",{"data-type":"segments","data-key":t.key});for(let n of e.children)r.children.push(this.segmentUI(t,n));return r},segmentUI(t,e){const r=n("g",{"data-type":"segment",class:e.class.toString(),"data-key":t.key}),i=o(t,s);for(let n of["handleIn","handleOut"])e[n]&&r.children.push(this.connection(t,e.anchor,e[n]));for(let n of e.children)r.children.push(this.control(t,n,i));return r},connection:(t,e,r)=>n("line",{"data-type":"connection",x1:e.vector.x,y1:e.vector.y,x2:r.vector.x,y2:r.vector.y,transform:l(t)}),control:(t,e,r)=>n("circle",{"data-type":e.type,"data-key":e.key,transform:l(t),r:r/2,cx:e.vector.x,cy:e.vector.y,class:e.class.toString()}),tools(t){const e=n("ul",{id:"buttons"});for(let n of t.children)e.children.push(this.button(n));return e},button:t=>n("li",{class:t.class.toString()},n("a",{href:"#"},n("object",{type:"image/svg+xml",data:t.iconPath}),n("p",{},t.name),n("div",{id:t.toolType,"data-type":t.toolType,class:"buttonTarget"}))),menu(t){const e=n("ul",{class:t.class.toString()});for(let r of t.children)e.children.push(n("li",{"data-key":r._id,"data-type":"doc-identifier",class:r.class.toString()},r._id));const r=n("h1",{},"Documents");return n("div",{},r,e)}};let c="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function h(){let t=new c(2);return c!=Float32Array&&(t[0]=0,t[1]=0),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});!function(){let t=h()}();const u={create:(t=0,e=0)=>Object.create(u).init(t,e),createFromObject:t=>Object.create(u).init(t.x,t.y),init(t,e){return this.x=t,this.y=e,this},coords(){return{x:this.x,y:this.y}},transform(t){const e=h();return function(t,e,n){var r=e[0],i=e[1];t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5]}(e,this.toArray(),t.m),u.create(...e)},transformToLocal(t){return this.transform(t.globalTransform().invert())},rotate(t,e){return this.transform(f.rotation(t,e))},add(t){return u.create(this.x+t.x,this.y+t.y)},minus(t){return u.create(this.x-t.x,this.y-t.y)},abs(){return u.create(Math.abs(this.x),Math.abs(this.y))},isWithin(t){return this.x>=t.x&&this.x<=t.x+t.width&&this.y>=t.y&&this.y<=t.y+t.height},angle(...t){if(0===t.length)return Math.atan2(this.y,this.x);{const[e,n]=t;return n.minus(this).angle()-e.minus(this).angle()}},length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},toArray(){return[this.x,this.y]},toString(){return`${Number(Math.round(this.x+"e3")+"e-3")} ${Number(Math.round(this.y+"e3")+"e-3")}`}};function d(){let t=new c(6);return c!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}const f={create:t=>Object.create(f).init(t),init(t){return this.m=t,this},createFromDOMMatrix(t){const e=[t.a,t.b,t.c,t.d,t.e,t.f];return f.create(e)},equals(t){for(let e=0;e<=5;e+=1)if(this.m[e]!==t.m[e])return!1;return!0},toJSON(){return this.toArray()},toString(){return`matrix(${Array.from(this.m).map(t=>Number(Math.round(t+"e3")+"e-3")).join(", ")})`},toArray(){return Array.from(this.m)},multiply(t){const e=d();return function(t,e,n){let r=e[0],i=e[1],s=e[2],o=e[3],l=e[4],a=e[5],c=n[0],h=n[1],u=n[2],d=n[3],f=n[4],p=n[5];t[0]=r*c+s*h,t[1]=i*c+o*h,t[2]=r*u+s*d,t[3]=i*u+o*d,t[4]=r*f+s*p+l,t[5]=i*f+o*p+a}(e,this.m,t.m),f.create(e)},invert(){const t=d();return function(t,e){let n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],l=e[5],a=n*s-r*i;a&&(a=1/a,t[0]=s*a,t[1]=-r*a,t[2]=-i*a,t[3]=n*a,t[4]=(i*l-s*o)*a,t[5]=(r*o-n*l)*a)}(t,this.m),f.create(t)},identity:()=>f.create([1,0,0,1,0,0]),rotation(t,e){const n=Math.sin(t),r=Math.cos(t),i=[r,n,-n,r,-e.x*r+e.y*n+e.x,-e.x*n-e.y*r+e.y];return f.create(i)},translation(t){const e=[1,0,0,1,t.x,t.y];return f.create(e)},scale(t,e=u.create(0,0)){const n=[t,0,0,t,e.x-t*e.x,e.y-t*e.y];return f.create(n)}},p={create:(t=u.create(),e=u.create())=>Object.create(p).init(t,e),init(t,e){return this.origin=t,this.size=e,this},createFromDimensions(t,e,n,r){const i=u.create(t,e),s=u.create(n,r);return p.create(i,s)},createFromObject(t){const e=u.create(t.x,t.y),n=u.create(t.width,t.height);return p.create(e,n)},createFromMinMax(t,e){const n=u.create(t.x,t.y),r=u.create(e.x-t.x,e.y-t.y);return p.create(n,r)},get min(){return this.origin},get max(){return u.create(this.origin.x+this.size.x,this.origin.y+this.size.y)},get x(){return this.origin.x},get y(){return this.origin.y},get width(){return this.size.x},set width(t){this.size.x=t},set height(t){this.size.y=t},get height(){return this.size.y},get corners(){return[this.min,u.create(this.origin.x+this.size.x,this.origin.y),u.create(this.origin.x,this.origin.y+this.size.y),this.max]},get center(){return u.create(this.x+this.width/2,this.y+this.height/2)},getBoundingRect(t){let e=u.create(),n=u.create();return e.x=Math.min(this.min.x,t.min.x),e.y=Math.min(this.min.y,t.min.y),n.x=Math.max(this.max.x,t.max.x),n.y=Math.max(this.max.y,t.max.y),p.createFromMinMax(e,n)},transform(t){return p.create(this.origin.transform(t),this.size.transform(t))},toString(){return[this.origin.x,this.origin.y,this.size.x,this.size.y].join(" ")},toJSON(){return{x:this.origin.x,y:this.origin.y,width:this.size.x,height:this.size.y}}};var g=function(t){this.curves=[],this._3d=!1,t&&(this.curves=t,this._3d=this.curves[0]._3d)};g.prototype={valueOf:function(){return this.toString()},toString:function(){return"["+this.curves.map(function(t){return j.pointsToString(t.points)}).join(", ")+"]"},addCurve:function(t){this.curves.push(t),this._3d=this._3d||t._3d},length:function(){return this.curves.map(function(t){return t.length()}).reduce(function(t,e){return t+e})},curve:function(t){return this.curves[t]},bbox:function(){for(var t=this.curves,e=t[0].bbox(),n=1;n<t.length;n++)j.expandbox(e,t[n].bbox());return e},offset:function(t){var e=[];return this.curves.forEach(function(n){e=e.concat(n.offset(t))}),new g(e)}};var m=Math.abs,y=Math.min,v=Math.max,x=Math.cos,b=Math.sin,w=Math.acos,C=Math.sqrt,S=Math.PI,O={x:0,y:0,z:0},T=function(t){var e=t&&t.forEach?t:[].slice.call(arguments),n=!1;if("object"==typeof e[0]){n=e.length;var r=[];e.forEach(function(t){["x","y","z"].forEach(function(e){void 0!==t[e]&&r.push(t[e])})}),e=r}var i=!1,s=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var o=!i&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z;this._3d=o;for(var l=[],a=0,c=o?3:2;a<s;a+=c){var h={x:e[a],y:e[a+1]};o&&(h.z=e[a+2]),l.push(h)}this.order=l.length-1,this.points=l;var u=["x","y"];o&&u.push("z"),this.dims=u,this.dimlen=u.length,function(t){for(var e=t.order,n=t.points,r=j.align(n,{p1:n[0],p2:n[e]}),i=0;i<r.length;i++)if(m(r[i].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()};T.quadraticFromPoints=function(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new T(e,e,n);if(1===r)return new T(t,e,e);var i=getABC(2,t,e,n,r);return new T(t,i.A,n)},T.cubicFromPoints=function(t,e,n,r,i){void 0===r&&(r=.5);var s=getABC(3,t,e,n,r);void 0===i&&(i=j.dist(e,s.C));var o=i*(1-r)/r,l=j.dist(t,n),a=(n.x-t.x)/l,c=(n.y-t.y)/l,h=i*a,u=i*c,d=o*a,f=o*c,p=e.x-h,g=e.y-u,m=e.x+d,y=e.y+f,v=s.A,x=v.x+(p-v.x)/(1-r),b=v.y+(g-v.y)/(1-r),w=v.x+(m-v.x)/r,C=v.y+(y-v.y)/r,S={x:t.x+(x-t.x)/r,y:t.y+(b-t.y)/r},O={x:n.x+(w-n.x)/(1-r),y:n.y+(C-n.y)/(1-r)};return new T(t,S,O,n)};var M=function(){return j};T.getUtils=M,T.PolyBezier=g,T.prototype={getUtils:M,valueOf:function(){return this.toString()},toString:function(){return j.pointsToString(this.points)},toSVG:function(t){if(this._3d)return!1;for(var e=this.points,n=["M",e[0].x,e[0].y,2===this.order?"Q":"C"],r=1,i=e.length;r<i;r++)n.push(e[r].x),n.push(e[r].y);return n.join(" ")},update:function(){this._lut=[],this.dpoints=j.derive(this.points,this._3d),this.computedirection()},computedirection:function(){var t=this.points,e=j.angle(t[0],t[this.order],t[1]);this.clockwise=e>0},length:function(){return j.length(this.derivative.bind(this))},_lut:[],getLUT:function(t){if(t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(var e=0;e<=t;e++)this._lut.push(this.compute(e/t));return this._lut},on:function(t,e){e=e||5;for(var n,r=this.getLUT(),i=[],s=0,o=0;o<r.length;o++)n=r[o],j.dist(n,t)<e&&(i.push(n),s+=o/r.length);return!!i.length&&s/i.length},project:function(t){var e=this.getLUT(),n=e.length-1,r=j.closest(e,t),i=r.mdist,s=r.mpos;if(0===s||s===n){var o=s/n,l=this.compute(o);return l.t=o,l.d=i,l}var a,c,h,u=(s+1)/n,d=.1/n;for(i+=1,a=o=(s-1)/n;o<u+d;o+=d)c=this.compute(o),(h=j.dist(t,c))<i&&(i=h,a=o);return(c=this.compute(a)).t=a,c.d=i,c},get:function(t){return this.compute(t)},point:function(t){return this.points[t]},compute:function(t){return j.compute(t,this.points,this._3d)},raise:function(){for(var t,e,n=this.points,r=[n[0]],i=n.length,s=1;s<i;s++)t=n[s],e=n[s-1],r[s]={x:(i-s)/i*t.x+s/i*e.x,y:(i-s)/i*t.y+s/i*e.y};return r[i]=n[i-1],new T(r)},derivative:function(t){var e,n,r=1-t,i=0,s=this.dpoints[0];2===this.order&&(s=[s[0],s[1],O],e=r,n=t),3===this.order&&(e=r*r,n=r*t*2,i=t*t);var o={x:e*s[0].x+n*s[1].x+i*s[2].x,y:e*s[0].y+n*s[1].y+i*s[2].y};return this._3d&&(o.z=e*s[0].z+n*s[1].z+i*s[2].z),o},curvature:function(t){return j.curvature(t,this.points,this._3d)},inflections:function(){return j.inflections(this.points)},normal:function(t){return this._3d?this.__normal3(t):this.__normal2(t)},__normal2:function(t){var e=this.derivative(t),n=C(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}},__normal3:function(t){var e=this.derivative(t),n=this.derivative(t+.01),r=C(e.x*e.x+e.y*e.y+e.z*e.z),i=C(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;var s={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},o=C(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=o,s.y/=o,s.z/=o;var l=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{x:l[0]*e.x+l[1]*e.y+l[2]*e.z,y:l[3]*e.x+l[4]*e.y+l[5]*e.z,z:l[6]*e.x+l[7]*e.y+l[8]*e.z}},hull:function(t){var e,n=this.points,r=[],i=[],s=0,o=0,l=0;for(i[s++]=n[0],i[s++]=n[1],i[s++]=n[2],3===this.order&&(i[s++]=n[3]);n.length>1;){for(r=[],o=0,l=n.length-1;o<l;o++)e=j.lerp(t,n[o],n[o+1]),i[s++]=e,r.push(e);n=r}return i},split:function(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;var n=this.hull(t),r={left:2===this.order?new T([n[0],n[3],n[5]]):new T([n[0],n[4],n[7],n[9]]),right:2===this.order?new T([n[5],n[4],n[2]]):new T([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=j.map(0,0,1,this._t1,this._t2),r.left._t2=j.map(t,0,1,this._t1,this._t2),r.right._t1=j.map(t,0,1,this._t1,this._t2),r.right._t2=j.map(1,0,1,this._t1,this._t2),e?(e=j.map(e,t,1,0,1),r.right.split(e).left):r},extrema:function(){var t,e,n=this.dims,r={},i=[];return n.forEach(function(n){e=function(t){return t[n]},t=this.dpoints[0].map(e),r[n]=j.droots(t),3===this.order&&(t=this.dpoints[1].map(e),r[n]=r[n].concat(j.droots(t))),r[n]=r[n].filter(function(t){return t>=0&&t<=1}),i=i.concat(r[n].sort(j.numberSort))}.bind(this)),i=i.sort(j.numberSort).filter(function(t,e){return i.indexOf(t)===e}),r.values=i,r},bbox:function(){var t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=j.getminmax(this,n,t[n])}.bind(this)),e},overlaps:function(t){var e=this.bbox(),n=t.bbox();return j.bboxoverlap(e,n)},offset:function(t,e){if(void 0!==e){var n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){var s=this.normal(0),o=this.points.map(function(e){var n={x:e.x+t*s.x,y:e.y+t*s.y};return e.z&&r.z&&(n.z=e.z+t*s.z),n});return[new T(o)]}return this.reduce().map(function(e){return e.scale(t)})},simple:function(){if(3===this.order){var t=j.angle(this.points[0],this.points[3],this.points[1]),e=j.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}var n=this.normal(0),r=this.normal(1),i=n.x*r.x+n.y*r.y;return this._3d&&(i+=n.z*r.z),m(w(i))<S/3},reduce:function(){var t,e,n=0,r=0,i=[],s=[],o=this.extrema().values;for(-1===o.indexOf(0)&&(o=[0].concat(o)),-1===o.indexOf(1)&&o.push(1),n=o[0],t=1;t<o.length;t++)r=o[t],(e=this.split(n,r))._t1=n,e._t2=r,i.push(e),n=r;return i.forEach(function(t){for(n=0,r=0;r<=1;)for(r=n+.01;r<=1.01;r+=.01)if(!(e=t.split(n,r)).simple()){if(m(n-(r-=.01))<.01)return[];(e=t.split(n,r))._t1=j.map(n,0,1,t._t1,t._t2),e._t2=j.map(r,0,1,t._t1,t._t2),s.push(e),n=r;break}n<1&&((e=t.split(n,1))._t1=j.map(n,0,1,t._t1,t._t2),e._t2=t._t2,s.push(e))}),s},scale:function(t){var e=this.order,n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);var r=this.clockwise,i=n?n(0):t,s=n?n(1):t,o=[this.offset(0,10),this.offset(1,10)],l=j.lli4(o[0],o[0].c,o[1],o[1].c);if(!l)throw new Error("cannot scale this curve. Try reducing it first.");var a=this.points,c=[];return[0,1].forEach(function(t){var n=c[t*e]=j.copy(a[t*e]);n.x+=(t?s:i)*o[t].n.x,n.y+=(t?s:i)*o[t].n.y}.bind(this)),n?([0,1].forEach(function(i){if(2!==this.order||!i){var s=a[i+1],o={x:s.x-l.x,y:s.y-l.y},h=n?n((i+1)/e):t;n&&!r&&(h=-h);var u=C(o.x*o.x+o.y*o.y);o.x/=u,o.y/=u,c[i+1]={x:s.x+h*o.x,y:s.y+h*o.y}}}.bind(this)),new T(c)):([0,1].forEach(function(t){if(2!==this.order||!t){var n=c[t*e],r=this.derivative(t),i={x:n.x+r.x,y:n.y+r.y};c[t+1]=j.lli4(n,i,l,a[t+1])}}.bind(this)),new T(c))},outline:function(t,e,n,r){e=void 0===e?t:e;var i,s=this.reduce(),o=s.length,l=[],a=[],c=0,h=this.length(),u=void 0!==n&&void 0!==r;function d(t,e,n,r,i){return function(s){var o=r/n,l=(r+i)/n,a=e-t;return j.map(s,0,1,t+o*a,t+l*a)}}s.forEach(function(i){w=i.length(),u?(l.push(i.scale(d(t,n,h,c,w))),a.push(i.scale(d(-e,-r,h,c,w)))):(l.push(i.scale(t)),a.push(i.scale(-e))),c+=w}),a=a.map(function(t){return(i=t.points)[3]?t.points=[i[3],i[2],i[1],i[0]]:t.points=[i[2],i[1],i[0]],t}).reverse();var f=l[0].points[0],p=l[o-1].points[l[o-1].points.length-1],m=a[o-1].points[a[o-1].points.length-1],y=a[0].points[0],v=j.makeline(m,f),x=j.makeline(p,y),b=[v].concat(l).concat([x]).concat(a),w=b.length;return new g(b)},outlineshapes:function(t,e,n){e=e||t;for(var r=this.outline(t,e).curves,i=[],s=1,o=r.length;s<o/2;s++){var l=j.makeshape(r[s],r[o-s],n);l.startcap.virtual=s>1,l.endcap.virtual=s<o/2-1,i.push(l)}return i},intersects:function(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof T&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)},lineIntersects:function(t){var e=y(t.p1.x,t.p2.x),n=y(t.p1.y,t.p2.y),r=v(t.p1.x,t.p2.x),i=v(t.p1.y,t.p2.y),s=this;return j.roots(this.points,t).filter(function(t){var o=s.get(t);return j.between(o.x,e,r)&&j.between(o.y,n,i)})},selfintersects:function(t){var e,n,r,i,s=this.reduce(),o=s.length-2,l=[];for(e=0;e<o;e++)r=s.slice(e,e+1),i=s.slice(e+2),n=this.curveintersects(r,i,t),l=l.concat(n);return l},curveintersects:function(t,e,n){var r=[];t.forEach(function(t){e.forEach(function(e){t.overlaps(e)&&r.push({left:t,right:e})})});var i=[];return r.forEach(function(t){var e=j.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))}),i},arcs:function(t){t=t||.5;return this._iterate(t,[])},_error:function(t,e,n,r){var i=(r-n)/4,s=this.get(n+i),o=this.get(r-i),l=j.dist(t,e),a=j.dist(t,s),c=j.dist(t,o);return m(a-l)+m(c-l)},_iterate:function(t,e){var n,r=0,i=1;do{n=0,i=1;var s,o,l,a,c,h=this.get(r),u=!1,d=!1,f=i,p=1;do{if(d=u,a=l,f=(r+i)/2,s=this.get(f),o=this.get(i),(l=j.getccenter(h,s,o)).interval={start:r,end:i},u=this._error(l,h,r,i)<=t,(c=d&&!u)||(p=i),u){if(i>=1){if(l.interval.end=p=1,a=l,i>1){var g={x:l.x+l.r*x(l.e),y:l.y+l.r*b(l.e)};l.e+=j.angle({x:l.x,y:l.y},g,this.get(1))}break}i+=(i-r)/2}else i=f}while(!c&&n++<100);if(n>=100)break;a=a||l,e.push(a),r=p}while(i<1);return e}};var k=Math.abs,N=Math.cos,L=Math.sin,A=Math.acos,_=Math.atan2,E=Math.sqrt,D=Math.pow,P=function(t){return t<0?-D(-t,1/3):D(t,1/3)},I=Math.PI,z=2*I,R=I/2,H=Number.MAX_SAFE_INTEGER||9007199254740991,F=Number.MIN_SAFE_INTEGER||-9007199254740991,W={x:0,y:0,z:0},j={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(t,e){var n=e(t),r=n.x*n.x+n.y*n.y;return void 0!==n.z&&(r+=n.z*n.z),E(r)},compute:function(t,e,n){if(0===t)return e[0];var r=e.length-1;if(1===t)return e[r];var i=e,s=1-t;if(0===r)return e[0];if(1===r)return d={x:s*i[0].x+t*i[1].x,y:s*i[0].y+t*i[1].y},n&&(d.z=s*i[0].z+t*i[1].z),d;if(r<4){var o,l,a,c=s*s,h=t*t,u=0;2===r?(i=[i[0],i[1],i[2],W],o=c,l=s*t*2,a=h):3===r&&(o=c*s,l=c*t*3,a=s*h*3,u=t*h);var d={x:o*i[0].x+l*i[1].x+a*i[2].x+u*i[3].x,y:o*i[0].y+l*i[1].y+a*i[2].y+u*i[3].y};return n&&(d.z=o*i[0].z+l*i[1].z+a*i[2].z+u*i[3].z),d}for(var f=JSON.parse(JSON.stringify(e));f.length>1;){for(var p=0;p<f.length-1;p++)f[p]={x:f[p].x+(f[p+1].x-f[p].x)*t,y:f[p].y+(f[p+1].y-f[p].y)*t},void 0!==f[p].z&&(f[p]=f[p].z+(f[p+1].z-f[p].z)*t);f.splice(f.length-1,1)}return f[0]},derive:function(t,e){for(var n=[],r=t,i=r.length,s=i-1;i>1;i--,s--){for(var o,l=[],a=0;a<s;a++)o={x:s*(r[a+1].x-r[a].x),y:s*(r[a+1].y-r[a].y)},e&&(o.z=s*(r[a+1].z-r[a].z)),l.push(o);n.push(l),r=l}return n},between:function(t,e,n){return e<=t&&t<=n||j.approximately(t,e)||j.approximately(t,n)},approximately:function(t,e,n){return k(t-e)<=(n||1e-6)},length:function(t){var e,n,r=0,i=j.Tvalues.length;for(e=0;e<i;e++)n=.5*j.Tvalues[e]+.5,r+=j.Cvalues[e]*j.arcfn(n,t);return.5*r},map:function(t,e,n,r,i){return r+(i-r)*((t-e)/(n-e))},lerp:function(t,e,n){var r={x:e.x+t*(n.x-e.x),y:e.y+t*(n.y-e.y)};return e.z&&n.z&&(r.z=e.z+t*(n.z-e.z)),r},pointToString:function(t){var e=t.x+"/"+t.y;return void 0!==t.z&&(e+="/"+t.z),e},pointsToString:function(t){return"["+t.map(j.pointToString).join(", ")+"]"},copy:function(t){return JSON.parse(JSON.stringify(t))},angle:function(t,e,n){var r=e.x-t.x,i=e.y-t.y,s=n.x-t.x,o=n.y-t.y;return _(r*o-i*s,r*s+i*o)},round:function(t,e){var n=""+t,r=n.indexOf(".");return parseFloat(n.substring(0,r+1+e))},dist:function(t,e){var n=t.x-e.x,r=t.y-e.y;return E(n*n+r*r)},closest:function(t,e){var n,r,i=D(2,63);return t.forEach(function(t,s){(r=j.dist(e,t))<i&&(i=r,n=s)}),{mdist:i,mpos:n}},abcratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var n=D(t,e)+D(1-t,e);return k((n-1)/n)},projectionratio:function(t,e){if(2!==e&&3!==e)return!1;if(void 0===t)t=.5;else if(0===t||1===t)return t;var n=D(1-t,e);return n/(D(t,e)+n)},lli8:function(t,e,n,r,i,s,o,l){var a=(t-n)*(s-l)-(e-r)*(i-o);return 0!=a&&{x:((t*r-e*n)*(i-o)-(t-n)*(i*l-s*o))/a,y:((t*r-e*n)*(s-l)-(e-r)*(i*l-s*o))/a}},lli4:function(t,e,n,r){var i=t.x,s=t.y,o=e.x,l=e.y,a=n.x,c=n.y,h=r.x,u=r.y;return j.lli8(i,s,o,l,a,c,h,u)},lli:function(t,e){return j.lli4(t,t.c,e,e.c)},makeline:function(t,e){var n=t.x,r=t.y,i=e.x,s=e.y,o=(i-n)/3,l=(s-r)/3;return new T(n,r,n+o,r+l,n+2*o,r+2*l,i,s)},findbbox:function(t){var e=H,n=H,r=F,i=F;return t.forEach(function(t){var s=t.bbox();e>s.x.min&&(e=s.x.min),n>s.y.min&&(n=s.y.min),r<s.x.max&&(r=s.x.max),i<s.y.max&&(i=s.y.max)}),{x:{min:e,mid:(e+r)/2,max:r,size:r-e},y:{min:n,mid:(n+i)/2,max:i,size:i-n}}},shapeintersections:function(t,e,n,r,i){if(!j.bboxoverlap(e,r))return[];var s=[],o=[t.startcap,t.forward,t.back,t.endcap],l=[n.startcap,n.forward,n.back,n.endcap];return o.forEach(function(e){e.virtual||l.forEach(function(r){if(!r.virtual){var o=e.intersects(r,i);o.length>0&&(o.c1=e,o.c2=r,o.s1=t,o.s2=n,s.push(o))}})}),s},makeshape:function(t,e,n){var r=e.points.length,i=t.points.length,s=j.makeline(e.points[r-1],t.points[0]),o=j.makeline(t.points[i-1],e.points[0]),l={startcap:s,forward:t,back:e,endcap:o,bbox:j.findbbox([s,t,e,o])},a=j;return l.intersections=function(t){return a.shapeintersections(l,l.bbox,t,t.bbox,n)},l},getminmax:function(t,e,n){if(!n)return{min:0,max:0};var r,i,s=H,o=F;-1===n.indexOf(0)&&(n=[0].concat(n)),-1===n.indexOf(1)&&n.push(1);for(var l=0,a=n.length;l<a;l++)r=n[l],(i=t.get(r))[e]<s&&(s=i[e]),i[e]>o&&(o=i[e]);return{min:s,mid:(s+o)/2,max:o,size:o-s}},align:function(t,e){var n=e.p1.x,r=e.p1.y,i=-_(e.p2.y-r,e.p2.x-n);return t.map(function(t){return{x:(t.x-n)*N(i)-(t.y-r)*L(i),y:(t.x-n)*L(i)+(t.y-r)*N(i)}})},roots:function(t,e){e=e||{p1:{x:0,y:0},p2:{x:1,y:0}};var n=t.length-1,r=j.align(t,e),i=function(t){return 0<=t&&t<=1};if(2===n){if(0!==(h=(u=r[0].y)-2*(d=r[1].y)+(f=r[2].y))){var s=-E(d*d-u*f),o=-u+d;return[-(s+o)/h,-(-s+o)/h].filter(i)}return d!==f&&0===h?[(2*d-f)/(2*d-2*f)].filter(i):[]}var l=r[0].y,a=r[1].y,c=r[2].y,h=3*a-l-3*c+r[3].y,u=3*l-6*a+3*c,d=-3*l+3*a,f=l;if(j.approximately(h,0)){if(j.approximately(u,0))return j.approximately(d,0)?[]:[-f/d].filter(i);var p=2*u;return[((g=E(d*d-4*u*f))-d)/p,(-d-g)/p].filter(i)}var g,m,y=(r=(3*(d/=h)-(u/=h)*u)/3)/3,v=(g=(2*u*u*u-9*u*d+27*(f/=h))/27)/2,x=v*v+y*y*y;if(x<0){var b=-r/3,w=E(b*b*b),C=-g/(2*w),S=A(C<-1?-1:C>1?1:C),O=2*P(w);return[O*N(S/3)-u/3,O*N((S+z)/3)-u/3,O*N((S+2*z)/3)-u/3].filter(i)}if(0===x)return[2*(m=v<0?P(-v):-P(v))-u/3,-m-u/3].filter(i);var T=E(x);return[(m=P(-v+T))-P(v+T)-u/3].filter(i)},droots:function(t){if(3===t.length){var e=t[0],n=t[1],r=t[2],i=e-2*n+r;if(0!==i){var s=-E(n*n-e*r),o=-e+n;return[-(s+o)/i,-(-s+o)/i]}return n!==r&&0===i?[(2*n-r)/(2*(n-r))]:[]}if(2===t.length)return(e=t[0])!==(n=t[1])?[e/(e-n)]:[]},curvature:function(t,e,n){var r,i,s=j.derive(e),o=s[0],l=s[1],a=j.compute(t,o),c=j.compute(t,l);return n?(r=E(D(a.y*c.z-c.y*a.z,2)+D(a.z*c.x-c.z*a.x,2)+D(a.x*c.y-c.x*a.y,2)),i=D(a.x*a.x+a.y*a.y+a.z*a.z,2/3)):(r=a.x*c.y-a.y*c.x,i=D(a.x*a.x+a.y*a.y,2/3)),0===r||0===i?{k:0,r:0}:{k:r/i,r:i/r}},inflections:function(t){if(t.length<4)return[];var e=j.align(t,{p1:t[0],p2:t.slice(-1)[0]}),n=e[2].x*e[1].y,r=e[3].x*e[1].y,i=e[1].x*e[2].y,s=18*(-3*n+2*r+3*i-(u=e[3].x*e[2].y)),o=18*(3*n-r-3*i),l=18*(i-n);if(j.approximately(s,0)){if(!j.approximately(o,0)){var a=-l/o;if(0<=a&&a<=1)return[a]}return[]}var c=o*o-4*s*l,h=Math.sqrt(c),u=2*s;return j.approximately(u,0)?[]:[(h-o)/u,-(o+h)/u].filter(function(t){return 0<=t&&t<=1})},bboxoverlap:function(t,e){var n,r,i,s,o,l=["x","y"],a=l.length;for(n=0;n<a;n++)if(i=t[r=l[n]].mid,s=e[r].mid,o=(t[r].size+e[r].size)/2,k(i-s)>=o)return!1;return!0},expandbox:function(t,e){e.x.min<t.x.min&&(t.x.min=e.x.min),e.y.min<t.y.min&&(t.y.min=e.y.min),e.z&&e.z.min<t.z.min&&(t.z.min=e.z.min),e.x.max>t.x.max&&(t.x.max=e.x.max),e.y.max>t.y.max&&(t.y.max=e.y.max),e.z&&e.z.max>t.z.max&&(t.z.max=e.z.max),t.x.mid=(t.x.min+t.x.max)/2,t.y.mid=(t.y.min+t.y.max)/2,t.z&&(t.z.mid=(t.z.min+t.z.max)/2),t.x.size=t.x.max-t.x.min,t.y.size=t.y.max-t.y.min,t.z&&(t.z.size=t.z.max-t.z.min)},pairiteration:function(t,e,n){var r=t.bbox(),i=e.bbox(),s=1e5,o=n||.5;if(r.x.size+r.y.size<o&&i.x.size+i.y.size<o)return[(s*(t._t1+t._t2)/2|0)/s+"/"+(s*(e._t1+e._t2)/2|0)/s];var l=t.split(.5),a=e.split(.5),c=[{left:l.left,right:a.left},{left:l.left,right:a.right},{left:l.right,right:a.right},{left:l.right,right:a.left}];c=c.filter(function(t){return j.bboxoverlap(t.left.bbox(),t.right.bbox())});var h=[];return 0===c.length?h:(c.forEach(function(t){h=h.concat(j.pairiteration(t.left,t.right,o))}),h=h.filter(function(t,e){return h.indexOf(t)===e}))},getccenter:function(t,e,n){var r,i=e.x-t.x,s=e.y-t.y,o=n.x-e.x,l=n.y-e.y,a=i*N(R)-s*L(R),c=i*L(R)+s*N(R),h=o*N(R)-l*L(R),u=o*L(R)+l*N(R),d=(t.x+e.x)/2,f=(t.y+e.y)/2,p=(e.x+n.x)/2,g=(e.y+n.y)/2,m=d+a,y=f+c,v=p+h,x=g+u,b=j.lli8(d,f,m,y,p,g,v,x),w=j.dist(b,t),C=_(t.y-b.y,t.x-b.x),S=_(e.y-b.y,e.x-b.x),O=_(n.y-b.y,n.x-b.x);return C<O?((C>S||S>O)&&(C+=z),C>O&&(r=O,O=C,C=r)):O<S&&S<C?(r=O,O=C,C=r):O+=z,b.s=C,b.e=O,b.r=w,b},numberSort:function(t,e){return t-e}},B=Math.abs,U=Math.min,V=Math.max,G=Math.cos,q=Math.sin,X=Math.acos,$=Math.sqrt,Y=Math.PI,K={x:0,y:0,z:0},Z=function(t){var e=t&&t.forEach?t:[].slice.call(arguments),n=!1;if("object"==typeof e[0]){n=e.length;var r=[];e.forEach(function(t){["x","y","z"].forEach(function(e){void 0!==t[e]&&r.push(t[e])})}),e=r}var i=!1,s=e.length;if(n){if(n>4){if(1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");i=!0}}else if(6!==s&&8!==s&&9!==s&&12!==s&&1!==arguments.length)throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");var o=!i&&(9===s||12===s)||t&&t[0]&&void 0!==t[0].z;this._3d=o;for(var l=[],a=0,c=o?3:2;a<s;a+=c){var h={x:e[a],y:e[a+1]};o&&(h.z=e[a+2]),l.push(h)}this.order=l.length-1,this.points=l;var u=["x","y"];o&&u.push("z"),this.dims=u,this.dimlen=u.length,function(t){for(var e=t.order,n=t.points,r=j.align(n,{p1:n[0],p2:n[e]}),i=0;i<r.length;i++)if(B(r[i].y)>1e-4)return void(t._linear=!1);t._linear=!0}(this),this._t1=0,this._t2=1,this.update()};Z.quadraticFromPoints=function(t,e,n,r){if(void 0===r&&(r=.5),0===r)return new Z(e,e,n);if(1===r)return new Z(t,e,e);var i=getABC(2,t,e,n,r);return new Z(t,i.A,n)},Z.cubicFromPoints=function(t,e,n,r,i){void 0===r&&(r=.5);var s=getABC(3,t,e,n,r);void 0===i&&(i=j.dist(e,s.C));var o=i*(1-r)/r,l=j.dist(t,n),a=(n.x-t.x)/l,c=(n.y-t.y)/l,h=i*a,u=i*c,d=o*a,f=o*c,p=e.x-h,g=e.y-u,m=e.x+d,y=e.y+f,v=s.A,x=v.x+(p-v.x)/(1-r),b=v.y+(g-v.y)/(1-r),w=v.x+(m-v.x)/r,C=v.y+(y-v.y)/r,S={x:t.x+(x-t.x)/r,y:t.y+(b-t.y)/r},O={x:n.x+(w-n.x)/(1-r),y:n.y+(C-n.y)/(1-r)};return new Z(t,S,O,n)};var Q=function(){return j};Z.getUtils=Q,Z.PolyBezier=g,Z.prototype={getUtils:Q,valueOf:function(){return this.toString()},toString:function(){return j.pointsToString(this.points)},toSVG:function(t){if(this._3d)return!1;for(var e=this.points,n=["M",e[0].x,e[0].y,2===this.order?"Q":"C"],r=1,i=e.length;r<i;r++)n.push(e[r].x),n.push(e[r].y);return n.join(" ")},update:function(){this._lut=[],this.dpoints=j.derive(this.points,this._3d),this.computedirection()},computedirection:function(){var t=this.points,e=j.angle(t[0],t[this.order],t[1]);this.clockwise=e>0},length:function(){return j.length(this.derivative.bind(this))},_lut:[],getLUT:function(t){if(t=t||100,this._lut.length===t)return this._lut;this._lut=[],t--;for(var e=0;e<=t;e++)this._lut.push(this.compute(e/t));return this._lut},on:function(t,e){e=e||5;for(var n,r=this.getLUT(),i=[],s=0,o=0;o<r.length;o++)n=r[o],j.dist(n,t)<e&&(i.push(n),s+=o/r.length);return!!i.length&&s/i.length},project:function(t){var e=this.getLUT(),n=e.length-1,r=j.closest(e,t),i=r.mdist,s=r.mpos;if(0===s||s===n){var o=s/n,l=this.compute(o);return l.t=o,l.d=i,l}var a,c,h,u=(s+1)/n,d=.1/n;for(i+=1,a=o=(s-1)/n;o<u+d;o+=d)c=this.compute(o),(h=j.dist(t,c))<i&&(i=h,a=o);return(c=this.compute(a)).t=a,c.d=i,c},get:function(t){return this.compute(t)},point:function(t){return this.points[t]},compute:function(t){return j.compute(t,this.points,this._3d)},raise:function(){for(var t,e,n=this.points,r=[n[0]],i=n.length,s=1;s<i;s++)t=n[s],e=n[s-1],r[s]={x:(i-s)/i*t.x+s/i*e.x,y:(i-s)/i*t.y+s/i*e.y};return r[i]=n[i-1],new Z(r)},derivative:function(t){var e,n,r=1-t,i=0,s=this.dpoints[0];2===this.order&&(s=[s[0],s[1],K],e=r,n=t),3===this.order&&(e=r*r,n=r*t*2,i=t*t);var o={x:e*s[0].x+n*s[1].x+i*s[2].x,y:e*s[0].y+n*s[1].y+i*s[2].y};return this._3d&&(o.z=e*s[0].z+n*s[1].z+i*s[2].z),o},curvature:function(t){return j.curvature(t,this.points,this._3d)},inflections:function(){return j.inflections(this.points)},normal:function(t){return this._3d?this.__normal3(t):this.__normal2(t)},__normal2:function(t){var e=this.derivative(t),n=$(e.x*e.x+e.y*e.y);return{x:-e.y/n,y:e.x/n}},__normal3:function(t){var e=this.derivative(t),n=this.derivative(t+.01),r=$(e.x*e.x+e.y*e.y+e.z*e.z),i=$(n.x*n.x+n.y*n.y+n.z*n.z);e.x/=r,e.y/=r,e.z/=r,n.x/=i,n.y/=i,n.z/=i;var s={x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x},o=$(s.x*s.x+s.y*s.y+s.z*s.z);s.x/=o,s.y/=o,s.z/=o;var l=[s.x*s.x,s.x*s.y-s.z,s.x*s.z+s.y,s.x*s.y+s.z,s.y*s.y,s.y*s.z-s.x,s.x*s.z-s.y,s.y*s.z+s.x,s.z*s.z];return{x:l[0]*e.x+l[1]*e.y+l[2]*e.z,y:l[3]*e.x+l[4]*e.y+l[5]*e.z,z:l[6]*e.x+l[7]*e.y+l[8]*e.z}},hull:function(t){var e,n=this.points,r=[],i=[],s=0,o=0,l=0;for(i[s++]=n[0],i[s++]=n[1],i[s++]=n[2],3===this.order&&(i[s++]=n[3]);n.length>1;){for(r=[],o=0,l=n.length-1;o<l;o++)e=j.lerp(t,n[o],n[o+1]),i[s++]=e,r.push(e);n=r}return i},split:function(t,e){if(0===t&&e)return this.split(e).left;if(1===e)return this.split(t).right;var n=this.hull(t),r={left:2===this.order?new Z([n[0],n[3],n[5]]):new Z([n[0],n[4],n[7],n[9]]),right:2===this.order?new Z([n[5],n[4],n[2]]):new Z([n[9],n[8],n[6],n[3]]),span:n};return r.left._t1=j.map(0,0,1,this._t1,this._t2),r.left._t2=j.map(t,0,1,this._t1,this._t2),r.right._t1=j.map(t,0,1,this._t1,this._t2),r.right._t2=j.map(1,0,1,this._t1,this._t2),e?(e=j.map(e,t,1,0,1),r.right.split(e).left):r},extrema:function(){var t,e,n=this.dims,r={},i=[];return n.forEach(function(n){e=function(t){return t[n]},t=this.dpoints[0].map(e),r[n]=j.droots(t),3===this.order&&(t=this.dpoints[1].map(e),r[n]=r[n].concat(j.droots(t))),r[n]=r[n].filter(function(t){return t>=0&&t<=1}),i=i.concat(r[n].sort(j.numberSort))}.bind(this)),i=i.sort(j.numberSort).filter(function(t,e){return i.indexOf(t)===e}),r.values=i,r},bbox:function(){var t=this.extrema(),e={};return this.dims.forEach(function(n){e[n]=j.getminmax(this,n,t[n])}.bind(this)),e},overlaps:function(t){var e=this.bbox(),n=t.bbox();return j.bboxoverlap(e,n)},offset:function(t,e){if(void 0!==e){var n=this.get(t),r=this.normal(t),i={c:n,n:r,x:n.x+r.x*e,y:n.y+r.y*e};return this._3d&&(i.z=n.z+r.z*e),i}if(this._linear){var s=this.normal(0),o=this.points.map(function(e){var n={x:e.x+t*s.x,y:e.y+t*s.y};return e.z&&r.z&&(n.z=e.z+t*s.z),n});return[new Z(o)]}return this.reduce().map(function(e){return e.scale(t)})},simple:function(){if(3===this.order){var t=j.angle(this.points[0],this.points[3],this.points[1]),e=j.angle(this.points[0],this.points[3],this.points[2]);if(t>0&&e<0||t<0&&e>0)return!1}var n=this.normal(0),r=this.normal(1),i=n.x*r.x+n.y*r.y;return this._3d&&(i+=n.z*r.z),B(X(i))<Y/3},reduce:function(){var t,e,n=0,r=0,i=[],s=[],o=this.extrema().values;for(-1===o.indexOf(0)&&(o=[0].concat(o)),-1===o.indexOf(1)&&o.push(1),n=o[0],t=1;t<o.length;t++)r=o[t],(e=this.split(n,r))._t1=n,e._t2=r,i.push(e),n=r;return i.forEach(function(t){for(n=0,r=0;r<=1;)for(r=n+.01;r<=1.01;r+=.01)if(!(e=t.split(n,r)).simple()){if(B(n-(r-=.01))<.01)return[];(e=t.split(n,r))._t1=j.map(n,0,1,t._t1,t._t2),e._t2=j.map(r,0,1,t._t1,t._t2),s.push(e),n=r;break}n<1&&((e=t.split(n,1))._t1=j.map(n,0,1,t._t1,t._t2),e._t2=t._t2,s.push(e))}),s},scale:function(t){var e=this.order,n=!1;if("function"==typeof t&&(n=t),n&&2===e)return this.raise().scale(n);var r=this.clockwise,i=n?n(0):t,s=n?n(1):t,o=[this.offset(0,10),this.offset(1,10)],l=j.lli4(o[0],o[0].c,o[1],o[1].c);if(!l)throw new Error("cannot scale this curve. Try reducing it first.");var a=this.points,c=[];return[0,1].forEach(function(t){var n=c[t*e]=j.copy(a[t*e]);n.x+=(t?s:i)*o[t].n.x,n.y+=(t?s:i)*o[t].n.y}.bind(this)),n?([0,1].forEach(function(i){if(2!==this.order||!i){var s=a[i+1],o={x:s.x-l.x,y:s.y-l.y},h=n?n((i+1)/e):t;n&&!r&&(h=-h);var u=$(o.x*o.x+o.y*o.y);o.x/=u,o.y/=u,c[i+1]={x:s.x+h*o.x,y:s.y+h*o.y}}}.bind(this)),new Z(c)):([0,1].forEach(function(t){if(2!==this.order||!t){var n=c[t*e],r=this.derivative(t),i={x:n.x+r.x,y:n.y+r.y};c[t+1]=j.lli4(n,i,l,a[t+1])}}.bind(this)),new Z(c))},outline:function(t,e,n,r){e=void 0===e?t:e;var i,s=this.reduce(),o=s.length,l=[],a=[],c=0,h=this.length(),u=void 0!==n&&void 0!==r;function d(t,e,n,r,i){return function(s){var o=r/n,l=(r+i)/n,a=e-t;return j.map(s,0,1,t+o*a,t+l*a)}}s.forEach(function(i){w=i.length(),u?(l.push(i.scale(d(t,n,h,c,w))),a.push(i.scale(d(-e,-r,h,c,w)))):(l.push(i.scale(t)),a.push(i.scale(-e))),c+=w}),a=a.map(function(t){return(i=t.points)[3]?t.points=[i[3],i[2],i[1],i[0]]:t.points=[i[2],i[1],i[0]],t}).reverse();var f=l[0].points[0],p=l[o-1].points[l[o-1].points.length-1],m=a[o-1].points[a[o-1].points.length-1],y=a[0].points[0],v=j.makeline(m,f),x=j.makeline(p,y),b=[v].concat(l).concat([x]).concat(a),w=b.length;return new g(b)},outlineshapes:function(t,e,n){e=e||t;for(var r=this.outline(t,e).curves,i=[],s=1,o=r.length;s<o/2;s++){var l=j.makeshape(r[s],r[o-s],n);l.startcap.virtual=s>1,l.endcap.virtual=s<o/2-1,i.push(l)}return i},intersects:function(t,e){return t?t.p1&&t.p2?this.lineIntersects(t):(t instanceof Z&&(t=t.reduce()),this.curveintersects(this.reduce(),t,e)):this.selfintersects(e)},lineIntersects:function(t){var e=U(t.p1.x,t.p2.x),n=U(t.p1.y,t.p2.y),r=V(t.p1.x,t.p2.x),i=V(t.p1.y,t.p2.y),s=this;return j.roots(this.points,t).filter(function(t){var o=s.get(t);return j.between(o.x,e,r)&&j.between(o.y,n,i)})},selfintersects:function(t){var e,n,r,i,s=this.reduce(),o=s.length-2,l=[];for(e=0;e<o;e++)r=s.slice(e,e+1),i=s.slice(e+2),n=this.curveintersects(r,i,t),l=l.concat(n);return l},curveintersects:function(t,e,n){var r=[];t.forEach(function(t){e.forEach(function(e){t.overlaps(e)&&r.push({left:t,right:e})})});var i=[];return r.forEach(function(t){var e=j.pairiteration(t.left,t.right,n);e.length>0&&(i=i.concat(e))}),i},arcs:function(t){t=t||.5;return this._iterate(t,[])},_error:function(t,e,n,r){var i=(r-n)/4,s=this.get(n+i),o=this.get(r-i),l=j.dist(t,e),a=j.dist(t,s),c=j.dist(t,o);return B(a-l)+B(c-l)},_iterate:function(t,e){var n,r=0,i=1;do{n=0,i=1;var s,o,l,a,c,h=this.get(r),u=!1,d=!1,f=i,p=1;do{if(d=u,a=l,f=(r+i)/2,s=this.get(f),o=this.get(i),(l=j.getccenter(h,s,o)).interval={start:r,end:i},u=this._error(l,h,r,i)<=t,(c=d&&!u)||(p=i),u){if(i>=1){if(l.interval.end=p=1,a=l,i>1){var g={x:l.x+l.r*G(l.e),y:l.y+l.r*q(l.e)};l.e+=j.angle({x:l.x,y:l.y},g,this.get(1))}break}i+=(i-r)/2}else i=f}while(!c&&n++<100);if(n>=100)break;a=a||l,e.push(a),r=p}while(i<1);return e}};const J={create:(t,e,n,r)=>Object.create(J).init(t,e,n,r),createFromCoordinates:t=>J.create(u.create(t[0]),u.create(t[1]),u.create(t[2]),u.create(t[3])),createFromSegments:(t,e)=>J.create(t.anchor&&t.anchor.vector,e.anchor&&e.anchor.vector,t.handleOut&&t.handleOut.vector,e.handleIn&&e.handleIn.vector),init(t,e,n,r){return this.anchor1=t,this.anchor2=e,this.handle1=n,this.handle2=r,this},points(){return[this.anchor1,this.handle1,this.handle2,this.anchor2].filter(t=>null!=t)},coords(){return this.points().map(t=>t.coords())},toPathString(){const t=this.anchor1&&this.anchor1.toString(),e=this.anchor2&&this.anchor2.toString(),n=this.handle1&&this.handle1.toString(),r=this.handle2&&this.handle2.toString();return this.isDegenerate()?`M ${t}`:this.isLine()?`M ${t} L ${e}`:this.isQuadratic()?`M ${t} Q ${n||r} ${e}`:this.isCubic()?`M ${t} C ${n} ${r} ${e}`:void 0},isInvalid(){return this.hasNoAnchor()},isDegenerate(){return this.hasOneAnchor()},isLine(){return this.hasTwoAnchors()&&this.hasNoHandle()},isQuadratic(){return this.hasTwoAnchors()&&this.hasOneHandle()},isCubic(){return this.hasTwoAnchors()&&this.hasTwoHandles()},hasAnchor(){return this.anchor1||this.anchor2},hasHandle(){return this.handle1||this.handle2},hasTwoAnchors(){return this.anchor1&&this.anchor2},hasTwoHandles(){return this.handle1&&this.handle2},hasOneAnchor(){return this.hasAnchor()&&!this.hasTwoAnchors()},hasOneHandle(){return this.hasHandle()&&!this.hasTwoHandles()},hasNoAnchor(){return!this.hasAnchor()},hasNoHandle(){return!this.hasHandle()},get bounds(){let t,e;if(this.isLine()){const n=Math.min(this.anchor1.x,this.anchor2.x),r=Math.min(this.anchor1.y,this.anchor2.y),i=Math.max(this.anchor1.x,this.anchor2.x),s=Math.max(this.anchor1.y,this.anchor2.y);t=u.create(n,r),e=u.create(i,s)}else{const n=new Z(...this.coords()).bbox();t=u.create(n.x.min,n.y.min),e=u.create(n.x.max,n.y.max)}return p.createFromMinMax(t,e)}},tt={DOC:"doc",EDITOR:"editor",MESSAGE:"message",DOCS:"docs",IDENTIFIER:"identifier",CANVAS:"canvas",GROUP:"group",SHAPE:"shape",SPLINE:"spline",SEGMENT:"segment",ANCHOR:"anchor",HANDLEIN:"handleIn",HANDLEOUT:"handleOut",CURVE:"curve",TOOLS:"tools",TOOL:"tool",MARKUPNODE:"markupNode",MARKUPROOT:"markupRoot",LINE:"line",TOKEN:"token"},et=["xmlns","viewBox","transform"],nt={defineProps(t){for(let e of t)Object.defineProperty(this,e,{get(){return this.props[e]},set(t){this.props[e]=t,this.isSceneNode()&&this.invalidateCache()}});return this},set(t){for(let e of Object.keys(t))this[e]=t[e];return this},toJSON(){return{type:this.type,children:this.children,props:this.props}}},rt=Object.create(nt);rt.defineProps(["key","class"]),Object.assign(rt,{create(n={}){return Object.create(this).set({children:[],parent:null,props:{}}).set({type:null,key:e(),class:t.create()}).set(n)},findAncestor(t){return t(this)?this:null===this.parent?null:this.parent.findAncestor(t)},findAncestors(t,e=[]){return t(this)&&e.push(this),null===this.parent?e:this.parent.findAncestors(t,e)},findDescendant(t){if(t(this))return this;for(let e of this.children){let n=e.findDescendant(t);if(n)return n}return null},findDescendants(t,e=[]){t(this)&&e.push(this);for(let n of this.children)n.findDescendants(t,e);return e},findDescendantByKey(t){return this.findDescendant(e=>e.key===t)},findDescendantByClass(t){return this.findDescendant(e=>e.class.includes(t))},findAncestorByClass(t){return this.findAncestor(e=>e.class.includes(t))},mount(...t){for(let e of t)this.children=this.children.concat([e]),e.parent=this,e.isGroupOrShape()&&(e.height=e.parent.height+1);return this.isSceneNode()&&this.invalidateCache(),this},replaceWith(t){t.parent=this.parent;const e=this.parent.children.indexOf(this);this.parent.children.splice(e,1,t)},unmount(){this.parent.unmountChild(this)},unmountChild(t){const e=this.children.indexOf(t);-1!==e&&(this.children.splice(e,1),t.parent=null,this.isSceneNode()&&this.invalidateCache())},insertChild(t,e){t.parent=this,this.children.splice(e,0,t)},isLeaf(){return 0===this.children.length},isRoot(){return null===this.parent},isGraphicsNode(){return[tt.CANVAS,tt.GROUP,tt.SHAPE].includes(this.type)},isGroupOrShape(){return[tt.GROUP,tt.SHAPE].includes(this.type)},isSceneNode(){return[tt.CANVAS,tt.GROUP,tt.SHAPE,tt.SPLINE,tt.SEGMENT,tt.ANCHOR,tt.HANDLEIN,tt.HANDLEOUT].includes(this.type)}}),Object.defineProperty(rt,"root",{get(){return this.findAncestor(t=>null===t.parent)}}),Object.defineProperty(rt,"leaves",{get(){return this.findDescendants(t=>0===t.children.length)}}),Object.defineProperty(rt,"ancestors",{get(){return this.findAncestors(t=>!0)}}),Object.defineProperty(rt,"properAncestors",{get(){return this.parent.findAncestors(t=>!0)}}),Object.defineProperty(rt,"descendants",{get(){return this.findDescendants(t=>!0)}}),Object.defineProperty(rt,"siblings",{get(){return this.parent.children.filter(t=>t!==this)}}),Object.defineProperty(rt,"lastChild",{get(){return this.children[this.children.length-1]}}),Object.defineProperty(rt,"graphicsChildren",{get(){return this.children.filter(t=>t.isGraphicsNode())}}),Object.defineProperty(rt,"graphicsAncestors",{get(){return this.ancestors.filter(t=>t.isGraphicsNode())}}),Object.defineProperty(rt,"shapeOrGroupAncestors",{get(){return this.ancestors.filter(t=>t.isGroupOrShape())}});const it=Object.create(rt);Object.assign(it,{invalidateCache(){for(let t of this.graphicsAncestors)t.cache={}}}),Object.defineProperty(it,"canvas",{get(){return this.findAncestor(t=>t.type===tt.CANVAS)}}),Object.defineProperty(it,"doc",{get(){return this.findAncestor(t=>t.type===tt.DOC)}});const st=it.create();st.defineProps(["transform","height"]),Object.assign(st,{create(){return it.create.bind(this)().set({cache:{},class:t.create()})},focus(){this.class=this.class.add("focus")},select(){this.canvas.removeSelection(),this.class=this.class.add("selected"),this.canvas.updateFrontier()},placePen(){return this.canvas.removeSelection(),this.class=this.class.add("pen"),this.canvas.updateFrontier(),this},rotate(t,e){e=e.transform(this.properAncestorTransform().invert()),this.transform=f.rotation(t,e).multiply(this.transform||f.identity())},scale(t,e){e=e.transform(this.properAncestorTransform().invert()),this.transform=f.scale(t,e).multiply(this.transform||f.identity())},translate(t){this.transform=this.properAncestorTransform().invert().multiply(f.translation(t)).multiply(this.globalTransform())},globalTransform(){return this.properAncestorTransform().multiply(this.transform||f.identity())},properAncestorTransform(){let t=f.identity();for(let e of this.properAncestors.reverse())e.transform&&(t=t.multiply(e.transform));return t},globalScaleFactor(){const t=this.globalTransform().m;return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))},contains(t){return t.transform(this.globalTransform().invert()).isWithin(this.bounds)},computeBounds(){const t=[];for(let e of this.children)for(let n of e.bounds.corners)e.type===tt.SPLINE?t.push(n):t.push(n.transform(e.transform||f.identity()));const e=t.map(t=>t.x),n=t.map(t=>t.y),r=u.create(Math.min(...e),Math.min(...n)),i=u.create(Math.max(...e),Math.max(...n)),s=p.createFromMinMax(r,i);return this.bounds=s,s},renderElement(){return this.component()}}),Object.defineProperty(st,"bounds",{get(){return this.props.bounds||this.computeBounds()},set(t){this.props.bounds=t}}),Object.defineProperty(st,"attributes",{get(){const t={};for(let[e,n]of Object.entries(this.props))et.includes(e)&&n&&(t[e]=n);return t}}),Object.defineProperty(st,"tags",{get(){return this.cache.tags||(this.cache.tags=this.toTags()),this.cache.tags},set(t){this.cache.tags=t}}),Object.defineProperty(st,"component",{get(){return this.cache.component||(this.cache.component=this.toComponent()),this.cache.component},set(t){this.cache.component=t}});const ot=Object.create(st);ot.defineProps(["viewBox","xmlns","cursor"]),Object.assign(ot,{create(t={}){return st.create.bind(this)().set({type:tt.CANVAS,xmlns:"http://www.w3.org/2000/svg"}).set({height:0}).set(t)},findFocus(){return this.findDescendant(t=>t.class.includes("focus"))},removeFocus(){const t=this.findFocus();t&&(t.class=t.class.remove("focus"))},findSelection(){return this.findDescendant(t=>t.class.includes("selected"))},removeSelection(){const t=this.findSelection();t&&(t.class=t.class.remove("selected")),this.updateFrontier()},findPen(){return this.findDescendant(t=>t.class.includes("pen"))},removePen(){const t=this.findPen();t&&(t.class=t.class.remove("pen"),this.removePenTip())},findPenTip(){return this.findDescendant(t=>t.class.includes("tip"))},removePenTip(){const t=this.findPenTip();t&&(t.class=t.class.remove("tip"),t.parent.class=t.parent.class.remove("containsTip"))},findFrontier(){return this.findDescendants(t=>t.class.includes("frontier"))},removeFrontier(){for(let t of this.findFrontier())t.class=t.class.remove("frontier")},updateFrontier(){if(this.removeFrontier(),this.findSelection()&&this.findSelection()!==this){const t=this.findSelection();t.class=t.class.add("frontier");let e=t;do{for(let t of e.siblings)t.class=t.class.add("frontier");e=e.parent}while(e.parent.type!==tt.DOC)}else for(let t of this.children)t.class=t.class.add("frontier")},updateBounds(t){for(let e of t.children)e.computeBounds();for(let e of t.shapeOrGroupAncestors)e.computeBounds()},setCursor(t,e){const n=e.mode,r=e.label,i=e.update,s=t.type,o=t.target;if("pen"===n&&this.activateCursor("penCursor"),"select"===n&&"idle"===r&&"mousemove"===s)switch(o){case"dot":this.activateCursor("rotationCursor");break;case"nw-corner":case"se-corner":this.activateCursor("scaleCursorSE");break;case"ne-corner":case"sw-corner":this.activateCursor("scaleCursorNE");break;case"group":const e=this.findDescendantByKey(t.key);e&&e.class.includes("focus")?this.activateCursor("shiftableCursor"):this.activateCursor("selectCursor");break;case"shape":case"curve":this.activateCursor("shiftableCursor");break;case"canvas":this.activateCursor("selectCursor")}"select"===i?this.activateCursor("shiftCursor"):"shiftCursor"===this.cursor&&"release"===i&&this.activateCursor("shiftableCursor"),"esc"===t.target&&this.activateCursor("selectCursor")},activateCursor(t){this.class=this.class.remove(this.cursor).add(t),this.cursor=t},mountShape(){const t=at.create();return this.mount(t),t},toTags(){const t=Ct.create({indent:0}).mount(St.create({markup:`<svg xmlns="${this.xmlns}" viewBox="${this.viewBox.toString()}">`,key:this.key})),e=Ct.create({indent:0}).mount(St.create({markup:"</svg>",key:this.key}));return()=>wt.create().mount(t,...this.children.flatMap(t=>t.tags()),e)},toComponent(){const t=a.canvas(this);return()=>(t.children=this.children.map(t=>t.renderElement()),t)},renderTags(){return this.tags()}});const lt=Object.create(st);Object.assign(lt,{create(t={}){return st.create.bind(this)().set({type:tt.GROUP}).set(t)},toTags(t){let e;e=this.transform?`<g transform="${this.transform.toString()}">`:"<g>";const n=Ct.create({indent:this.height}).mount(St.create({markup:e,key:this.key,class:this.class})),r=Ct.create({indent:this.height}).mount(St.create({markup:"</g>",key:this.key,class:this.class}));return()=>[n,...this.children.flatMap(t=>t.tags()),r]},toComponent(){const t=a.wrapper(this),e=a.group(this),n=a.outerUI(this);return t.children.push(e),t.children.push(n),()=>(e.children=this.children.map(t=>t.renderElement()),t)}});const at=Object.create(st);at.defineProps(["fill","stroke","splitter"]),Object.assign(at,{create(t={}){return st.create.bind(this)().set({type:tt.SHAPE,splitter:u.create(-1e3,-1e3),fill:"none",stroke:"#000"}).set(t)},mountSpline(){const t=ct.create();return this.mount(t),t},toPathString(){let t=[];for(let e of this.children)t.push(e.commands().map(t=>t.map(t=>Array.isArray(t)?t[0]:t).join(" ")));return t.map(t=>t.join(" ")).join(" ")},toTags(){const t=[];t.push(Ct.create({indent:this.height}).mount(St.create({markup:"<path",key:this.key,class:this.class}))),t.push(Ct.create({indent:this.height+1}).mount(St.create({markup:`fill="${this.fill}" stroke="${this.stroke}"`}))),t.push(Ct.create({indent:this.height+1}).mount(St.create({markup:'d="'})));for(let e of this.children){const n=e.commands();for(let e of n){const n=this.height+2,r=Ct.create({indent:n}).mount(St.create({markup:e[0]}));for(let t=1;t<e.length;t+=1)r.mount(St.create({markup:e[t][0],key:e[t][1],class:e[t][2]}));t.push(r)}}return t.push(Ct.create({indent:this.height+1}).mount(St.create({markup:'"'}))),this.transform&&t.push(Ct.create({indent:this.height+1}).mount(St.create({markup:`transform="${this.transform.toString()}"`}))),t.push(Ct.create({indent:this.height}).mount(St.create({markup:"/>"}))),()=>t},toComponent(){const t=a.wrapper(this),e=a.curves(this),n=a.segments(this),r=a.outerUI(this);return t.children.push(e),t.children.push(n),t.children.push(r),()=>t}});const ct=Object.create(it);ct.defineProps(["closed"]),Object.defineProperty(ct,"bounds",{get(){return this.props.bounds||this.computeBounds()},set(t){this.props.bounds=t}}),Object.assign(ct,{create(t={}){return it.create.bind(this)().set({type:tt.SPLINE,closed:!1}).set(t)},mountSegment(){const t=ht.create();return this.mount(t),t},close(){this.closed=!0},open(){this.closed=!1},isClosed(){return!0===this.closed},curves(){const t=[];switch(this.children.length){case 1:t.push(J.createFromSegments(this.children[0],ht.create()));break;default:for(let e=0;e+1<this.children.length;e+=1)t.push(J.createFromSegments(this.children[e],this.children[e+1]));this.isClosed()&&t.push(J.createFromSegments(this.children[this.children.length-1],this.children[0]))}return t},commands(){const t=[];t.push(this.command(this.children[0]));for(let e=1;e<this.children.length;e+=1)t.push(this.command(this.children[e-1],this.children[e]));return this.isClosed()&&(t.push(this.command(this.children[this.children.length-1],this.children[0])),t.push(this.command())),t},command(t,e){const n=[];return t&&e?(t.handleOut&&e.handleIn?n.push("C"):t.handleOut||e.handleIn?n.push("Q"):n.push("L"),t.handleOut&&n.push([t.handleOut.toString(),t.handleOut.key,t.handleOut.class]),e.handleIn&&n.push([e.handleIn.toString(),e.handleIn.key,e.handleIn.class]),n.push([e.anchor.toString(),e.anchor.key,e.anchor.class])):t?(n.push("M"),n.push([this.children[0].anchor.toString(),this.children[0].anchor.key,this.children[0].anchor.class])):n.push("Z"),n},computeBounds(){const t=this.curves();let e;if(0===t.length)return e=p.create(),this.bounds=e,e;if(1===t.length&&t[0].isDegenerate())return e=p.create(),this.bounds=e,e;e=t[0]&&t[0].bounds;for(let n=1;n<t.length;n+=1){const r=t[n].bounds;e=e.getBoundingRect(r)}return this.bounds=e,e}});const ht=Object.create(it);Object.assign(ht,{create(t={}){return it.create.bind(this)().set({type:tt.SEGMENT}).set(t)},mountAnchor(t){const e=dt.create();return e.vector=t,this.mount(e),e},mountHandleIn(t){const e=ft.create();return e.vector=t,this.mount(e),e},mountHandleOut(t){const e=pt.create();return e.vector=t,this.mount(e),e}}),Object.defineProperty(ht,"anchor",{get(){return this.children.find(t=>t.type===tt.ANCHOR)}}),Object.defineProperty(ht,"handleIn",{get(){return this.children.find(t=>t.type===tt.HANDLEIN)}}),Object.defineProperty(ht,"handleOut",{get(){return this.children.find(t=>t.type===tt.HANDLEOUT)}});const ut=it.create();ut.defineProps(["vector"]),Object.assign(ut,{placePenTip(){this.canvas.removePenTip(),this.class=this.class.add("tip"),this.parent.class=this.parent.class.add("containsTip")},toString(){return this.vector.toString()},enclosingShape(){return this.parent&&this.parent.parent&&this.parent.parent.parent}});const dt=Object.create(ut);Object.assign(dt,{create(t={}){return ut.create.bind(this)().set({type:tt.ANCHOR}).set(t)}});const ft=Object.create(ut);Object.assign(ft,{create(t={}){return ut.create.bind(this)().set({type:tt.HANDLEIN}).set(t)}});const pt=Object.create(ut);Object.assign(pt,{create(t={}){return ut.create.bind(this)().set({type:tt.HANDLEOUT}).set(t)}});const gt=Object.create(rt);gt.defineProps(["_id","canvasWidth"]),Object.assign(gt,{create(t={}){return rt.create.bind(this)().set({type:tt.DOC,_id:e()}).set(t)}});const mt=Object.create(rt);Object.assign(mt,{create(t={}){return rt.create.bind(this)().set({type:tt.EDITOR}).set(t)}}),Object.defineProperty(mt,"message",{get(){return this.root.findDescendant(t=>t.type===tt.MESSAGE)}}),Object.defineProperty(mt,"canvas",{get(){return this.root.findDescendant(t=>t.type===tt.CANVAS)}}),Object.defineProperty(mt,"tools",{get(){return this.root.findDescendant(t=>t.type===tt.TOOLS)}}),Object.defineProperty(mt,"docs",{get(){return this.root.findDescendant(t=>t.type===tt.DOCS)}}),Object.defineProperty(mt,"doc",{get(){return this.root.findDescendant(t=>t.type===tt.DOC)}});const yt=Object.create(rt);Object.assign(yt,{create(t={}){return rt.create.bind(this)().set({type:tt.DOCS}).set(t)},setActiveStatus(t){for(let t of this.children)t.deactivate();const e=this.children.find(e=>e._id===t);e&&e.activate()}});const vt=Object.create(rt);vt.defineProps(["text"]),Object.assign(vt,{create(t={}){return rt.create.bind(this)().set({type:tt.MESSAGE}).set(t)}});const xt=Object.create(rt);xt.defineProps(["_id"]),Object.assign(xt,{create(t={}){return rt.create.bind(this)().set({type:tt.IDENTIFIER}).set(t)},activate(){this.class=this.class.add("active")},deactivate(){this.class=this.class.remove("active")}});const bt=Object.create(rt);Object.assign(bt,{create(t={}){return rt.create.bind(this)().set(t)},toMarkupString(){switch(this.type){case tt.TOKEN:return this.markup;case tt.LINE:return"  ".repeat(this.indent)+this.children.map(t=>t.toMarkupString()).join(" ");case tt.MARKUPROOT:return this.children.map(t=>t.toMarkupString()).join("\n")+"\n"}}});const wt=Object.create(bt);Object.assign(wt,{create(t={}){return bt.create.bind(this)().set({type:tt.MARKUPROOT}).set(t)},findTokenByPosition(t){const e=this.children[t.line];return e.findTokenByCharIndex(t.ch-2*e.indent)}});const Ct=Object.create(bt);Ct.defineProps(["indent"]),Object.assign(Ct,{create(t={}){return bt.create.bind(this)().set({type:tt.LINE}).set(t)},findTokenByCharIndex(t){let e=0;for(let n of this.children){const r=e,i=e+n.markup.length;if(r<=t&&t<=i)return n;e=i+1}}});const St=Object.create(bt);St.defineProps(["markup"]),Object.assign(St,{create(t={}){return bt.create.bind(this)().set({type:tt.TOKEN}).set(t)},getRange(){const t=this.parent,e=t.parent.children.indexOf(t),n=t.children.indexOf(this),r=t.children.slice(0,n).reduce((t,e)=>t+e.markup.length,0)+n+2*t.indent;return[{line:e,ch:r},{line:e,ch:r+this.markup.length}]}});const Ot=Object.create(rt);Object.assign(Ot,{create(t={}){return rt.create.bind(this)().set({type:tt.TOOLS}).set(t)},setActiveStatus(t){for(let t of this.children)t.deactivate();switch(t.mode){case"pen":this.pen.activate();break;case"select":this.select.activate()}t.layout.menuVisible&&this.open.activate()}}),Object.defineProperty(Ot,"pen",{get(){return this.children[0]}}),Object.defineProperty(Ot,"select",{get(){return this.children[1]}}),Object.defineProperty(Ot,"open",{get(){return this.children[5]}});const Tt=Object.create(rt);Tt.defineProps(["name","iconPath","toolType"]),Object.assign(Tt,{create(t={}){return rt.create.bind(this)().set({type:tt.Tool}).set(t)},activate(){this.class=this.class.add("active")},deactivate(){this.class=this.class.remove("active")}});const Mt={Editor:mt,Docs:yt,Doc:gt,Message:vt,Canvas:ot,Shape:at,Group:lt,Spline:ct,Segment:ht,Anchor:dt,HandleIn:ft,HandleOut:pt},kt=t=>{const e=Mt[Lt(t.type)].create();e.type=t.type,Nt(e,t);for(let n of t.children)e.mount(kt(n));return e},Nt=(e,n)=>{for(let[r,i]of Object.entries(n.props))switch(r){case"viewBox":e.viewBox=p.createFromObject(i);break;case"transform":e.transform=f.create(i);break;case"class":e.class=t.create(i);break;case"text":e.text=i;break;case"bounds":i&&(e.bounds=p.createFromObject(i));break;case"vector":e.vector=u.createFromObject(i);break;default:e[r]=i}},Lt=t=>t.charAt(0).toUpperCase()+t.slice(1);var At=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function _t(t,e){function n(){this.constructor=t}At(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Et(t,e){var n=t[0],r=t[1];return[n*Math.cos(e)-r*Math.sin(e),n*Math.sin(e)+r*Math.cos(e)]}function Dt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;n++)if("number"!=typeof t[n])throw new Error("assertNumbers arguments["+n+"] is not a number. "+typeof t[n]+" == typeof "+t[n]);return!0}var Pt=Math.PI;function It(t,e,n){t.lArcFlag=0===t.lArcFlag?0:1,t.sweepFlag=0===t.sweepFlag?0:1;var r=t.rX,i=t.rY,s=t.x,o=t.y;r=Math.abs(t.rX),i=Math.abs(t.rY);var l=Et([(e-s)/2,(n-o)/2],-t.xRot/180*Pt),a=l[0],c=l[1],h=Math.pow(a,2)/Math.pow(r,2)+Math.pow(c,2)/Math.pow(i,2);1<h&&(r*=Math.sqrt(h),i*=Math.sqrt(h)),t.rX=r,t.rY=i;var u=Math.pow(r,2)*Math.pow(c,2)+Math.pow(i,2)*Math.pow(a,2),d=(t.lArcFlag!==t.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(r,2)*Math.pow(i,2)-u)/u)),f=r*c/i*d,p=-i*a/r*d,g=Et([f,p],t.xRot/180*Pt);t.cX=g[0]+(e+s)/2,t.cY=g[1]+(n+o)/2,t.phi1=Math.atan2((c-p)/i,(a-f)/r),t.phi2=Math.atan2((-c-p)/i,(-a-f)/r),0===t.sweepFlag&&t.phi2>t.phi1&&(t.phi2-=2*Pt),1===t.sweepFlag&&t.phi2<t.phi1&&(t.phi2+=2*Pt),t.phi1*=180/Pt,t.phi2*=180/Pt}function zt(t,e,n){Dt(t,e,n);var r=t*t+e*e-n*n;if(0>r)return[];if(0===r)return[[t*n/(t*t+e*e),e*n/(t*t+e*e)]];var i=Math.sqrt(r);return[[(t*n+e*i)/(t*t+e*e),(e*n-t*i)/(t*t+e*e)],[(t*n-e*i)/(t*t+e*e),(e*n+t*i)/(t*t+e*e)]]}var Rt,Ht=Math.PI/180;function Ft(t,e,n){return(1-n)*t+n*e}function Wt(t,e,n,r){return t+Math.cos(r/180*Pt)*e+Math.sin(r/180*Pt)*n}function jt(t,e,n,r){var i=e-t,s=n-e,o=3*i+3*(r-n)-6*s,l=6*(s-i),a=3*i;return Math.abs(o)<1e-6?[-a/l]:function(t,e,n){void 0===n&&(n=1e-6);var r=t*t/4-e;if(r<-n)return[];if(r<=n)return[-t/2];var i=Math.sqrt(r);return[-t/2-i,-t/2+i]}(l/o,a/o,1e-6)}function Bt(t,e,n,r,i){var s=1-i;return t*(s*s*s)+e*(3*s*s*i)+n*(3*s*i*i)+r*(i*i*i)}!function(t){function e(){return i(function(t,e,n){return t.relative&&(void 0!==t.x1&&(t.x1+=e),void 0!==t.y1&&(t.y1+=n),void 0!==t.x2&&(t.x2+=e),void 0!==t.y2&&(t.y2+=n),void 0!==t.x&&(t.x+=e),void 0!==t.y&&(t.y+=n),t.relative=!1),t})}function n(){var t=NaN,e=NaN,n=NaN,r=NaN;return i(function(i,s,o){return i.type&Yt.SMOOTH_CURVE_TO&&(i.type=Yt.CURVE_TO,t=isNaN(t)?s:t,e=isNaN(e)?o:e,i.x1=i.relative?s-t:2*s-t,i.y1=i.relative?o-e:2*o-e),i.type&Yt.CURVE_TO?(t=i.relative?s+i.x2:i.x2,e=i.relative?o+i.y2:i.y2):(t=NaN,e=NaN),i.type&Yt.SMOOTH_QUAD_TO&&(i.type=Yt.QUAD_TO,n=isNaN(n)?s:n,r=isNaN(r)?o:r,i.x1=i.relative?s-n:2*s-n,i.y1=i.relative?o-r:2*o-r),i.type&Yt.QUAD_TO?(n=i.relative?s+i.x1:i.x1,r=i.relative?o+i.y1:i.y1):(n=NaN,r=NaN),i})}function r(){var t=NaN,e=NaN;return i(function(n,r,i){if(n.type&Yt.SMOOTH_QUAD_TO&&(n.type=Yt.QUAD_TO,t=isNaN(t)?r:t,e=isNaN(e)?i:e,n.x1=n.relative?r-t:2*r-t,n.y1=n.relative?i-e:2*i-e),n.type&Yt.QUAD_TO){t=n.relative?r+n.x1:n.x1,e=n.relative?i+n.y1:n.y1;var s=n.x1,o=n.y1;n.type=Yt.CURVE_TO,n.x1=((n.relative?0:r)+2*s)/3,n.y1=((n.relative?0:i)+2*o)/3,n.x2=(n.x+2*s)/3,n.y2=(n.y+2*o)/3}else t=NaN,e=NaN;return n})}function i(t){var e=0,n=0,r=NaN,i=NaN;return function(s){if(isNaN(r)&&!(s.type&Yt.MOVE_TO))throw new Error("path must start with moveto");var o=t(s,e,n,r,i);return s.type&Yt.CLOSE_PATH&&(e=r,n=i),void 0!==s.x&&(e=s.relative?e+s.x:s.x),void 0!==s.y&&(n=s.relative?n+s.y:s.y),s.type&Yt.MOVE_TO&&(r=e,i=n),o}}function s(t,e,n,r,s,o){return Dt(t,e,n,r,s,o),i(function(i,l,a,c){var h=i.x1,u=i.x2,d=i.relative&&!isNaN(c),f=void 0!==i.x?i.x:d?0:l,p=void 0!==i.y?i.y:d?0:a;function g(t){return t*t}i.type&Yt.HORIZ_LINE_TO&&0!==e&&(i.type=Yt.LINE_TO,i.y=i.relative?0:a),i.type&Yt.VERT_LINE_TO&&0!==n&&(i.type=Yt.LINE_TO,i.x=i.relative?0:l),void 0!==i.x&&(i.x=i.x*t+p*n+(d?0:s)),void 0!==i.y&&(i.y=f*e+i.y*r+(d?0:o)),void 0!==i.x1&&(i.x1=i.x1*t+i.y1*n+(d?0:s)),void 0!==i.y1&&(i.y1=h*e+i.y1*r+(d?0:o)),void 0!==i.x2&&(i.x2=i.x2*t+i.y2*n+(d?0:s)),void 0!==i.y2&&(i.y2=u*e+i.y2*r+(d?0:o));var m=t*r-e*n;if(void 0!==i.xRot&&(1!==t||0!==e||0!==n||1!==r))if(0===m)delete i.rX,delete i.rY,delete i.xRot,delete i.lArcFlag,delete i.sweepFlag,i.type=Yt.LINE_TO;else{var y=i.xRot*Math.PI/180,v=Math.sin(y),x=Math.cos(y),b=1/g(i.rX),w=1/g(i.rY),C=g(x)*b+g(v)*w,S=2*v*x*(b-w),O=g(v)*b+g(x)*w,T=C*r*r-S*e*r+O*e*e,M=S*(t*r+e*n)-2*(C*n*r+O*t*e),k=C*n*n-S*t*n+O*t*t,N=(Math.atan2(M,T-k)+Math.PI)%Math.PI/2,L=Math.sin(N),A=Math.cos(N);i.rX=Math.abs(m)/Math.sqrt(T*g(A)+M*L*A+k*g(L)),i.rY=Math.abs(m)/Math.sqrt(T*g(L)-M*L*A+k*g(A)),i.xRot=180*N/Math.PI}return void 0!==i.sweepFlag&&0>m&&(i.sweepFlag=+!i.sweepFlag),i})}t.ROUND=function(t){function e(e){return Math.round(e*t)/t}return void 0===t&&(t=1e13),Dt(t),function(t){return void 0!==t.x1&&(t.x1=e(t.x1)),void 0!==t.y1&&(t.y1=e(t.y1)),void 0!==t.x2&&(t.x2=e(t.x2)),void 0!==t.y2&&(t.y2=e(t.y2)),void 0!==t.x&&(t.x=e(t.x)),void 0!==t.y&&(t.y=e(t.y)),t}},t.TO_ABS=e,t.TO_REL=function(){return i(function(t,e,n){return t.relative||(void 0!==t.x1&&(t.x1-=e),void 0!==t.y1&&(t.y1-=n),void 0!==t.x2&&(t.x2-=e),void 0!==t.y2&&(t.y2-=n),void 0!==t.x&&(t.x-=e),void 0!==t.y&&(t.y-=n),t.relative=!0),t})},t.NORMALIZE_HVZ=function(t,e,n){return void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),i(function(r,i,s,o,l){if(isNaN(o)&&!(r.type&Yt.MOVE_TO))throw new Error("path must start with moveto");return e&&r.type&Yt.HORIZ_LINE_TO&&(r.type=Yt.LINE_TO,r.y=r.relative?0:s),n&&r.type&Yt.VERT_LINE_TO&&(r.type=Yt.LINE_TO,r.x=r.relative?0:i),t&&r.type&Yt.CLOSE_PATH&&(r.type=Yt.LINE_TO,r.x=r.relative?o-i:o,r.y=r.relative?l-s:l),r.type&Yt.ARC&&(0===r.rX||0===r.rY)&&(r.type=Yt.LINE_TO,delete r.rX,delete r.rY,delete r.xRot,delete r.lArcFlag,delete r.sweepFlag),r})},t.NORMALIZE_ST=n,t.QT_TO_C=r,t.INFO=i,t.SANITIZE=function(t){void 0===t&&(t=0),Dt(t);var e=NaN,n=NaN,r=NaN,s=NaN;return i(function(i,o,l,a,c){var h=Math.abs,u=!1,d=0,f=0;if(i.type&Yt.SMOOTH_CURVE_TO&&(d=isNaN(e)?0:o-e,f=isNaN(n)?0:l-n),i.type&(Yt.CURVE_TO|Yt.SMOOTH_CURVE_TO)?(e=i.relative?o+i.x2:i.x2,n=i.relative?l+i.y2:i.y2):(e=NaN,n=NaN),i.type&Yt.SMOOTH_QUAD_TO?(r=isNaN(r)?o:2*o-r,s=isNaN(s)?l:2*l-s):i.type&Yt.QUAD_TO?(r=i.relative?o+i.x1:i.x1,s=i.relative?l+i.y1:i.y2):(r=NaN,s=NaN),i.type&Yt.LINE_COMMANDS||i.type&Yt.ARC&&(0===i.rX||0===i.rY||!i.lArcFlag)||i.type&Yt.CURVE_TO||i.type&Yt.SMOOTH_CURVE_TO||i.type&Yt.QUAD_TO||i.type&Yt.SMOOTH_QUAD_TO){var p=void 0===i.x?0:i.relative?i.x:i.x-o,g=void 0===i.y?0:i.relative?i.y:i.y-l;d=isNaN(r)?void 0===i.x1?d:i.relative?i.x:i.x1-o:r-o,f=isNaN(s)?void 0===i.y1?f:i.relative?i.y:i.y1-l:s-l;var m=void 0===i.x2?0:i.relative?i.x:i.x2-o,y=void 0===i.y2?0:i.relative?i.y:i.y2-l;h(p)<=t&&h(g)<=t&&h(d)<=t&&h(f)<=t&&h(m)<=t&&h(y)<=t&&(u=!0)}return i.type&Yt.CLOSE_PATH&&h(o-a)<=t&&h(l-c)<=t&&(u=!0),u?[]:i})},t.MATRIX=s,t.ROTATE=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),Dt(t,e,n);var r=Math.sin(t),i=Math.cos(t);return s(i,r,-r,i,e-e*i+n*r,n-e*r-n*i)},t.TRANSLATE=function(t,e){return void 0===e&&(e=0),Dt(t,e),s(1,0,0,1,t,e)},t.SCALE=function(t,e){return void 0===e&&(e=t),Dt(t,e),s(t,0,0,e,0,0)},t.SKEW_X=function(t){return Dt(t),s(1,0,Math.atan(t),1,0,0)},t.SKEW_Y=function(t){return Dt(t),s(1,Math.atan(t),0,1,0,0)},t.X_AXIS_SYMMETRY=function(t){return void 0===t&&(t=0),Dt(t),s(-1,0,0,1,t,0)},t.Y_AXIS_SYMMETRY=function(t){return void 0===t&&(t=0),Dt(t),s(1,0,0,-1,0,t)},t.A_TO_C=function(){return i(function(t,e,n){return Yt.ARC===t.type?function(t,e,n){var r,i,s,o;t.cX||It(t,e,n);for(var l=Math.min(t.phi1,t.phi2),a=Math.max(t.phi1,t.phi2)-l,c=Math.ceil(a/90),h=new Array(c),u=e,d=n,f=0;f<c;f++){var p=Ft(t.phi1,t.phi2,f/c),g=Ft(t.phi1,t.phi2,(f+1)/c),m=g-p,y=4/3*Math.tan(m*Ht/4),v=[Math.cos(p*Ht)-y*Math.sin(p*Ht),Math.sin(p*Ht)+y*Math.cos(p*Ht)],x=v[0],b=v[1],w=[Math.cos(g*Ht),Math.sin(g*Ht)],C=w[0],S=w[1],O=[C+y*Math.sin(g*Ht),S-y*Math.cos(g*Ht)],T=O[0],M=O[1];h[f]={relative:t.relative,type:Yt.CURVE_TO};var k=function(e,n){var r=Et([e*t.rX,n*t.rY],t.xRot),i=r[0],s=r[1];return[t.cX+i,t.cY+s]};r=k(x,b),h[f].x1=r[0],h[f].y1=r[1],i=k(T,M),h[f].x2=i[0],h[f].y2=i[1],s=k(C,S),h[f].x=s[0],h[f].y=s[1],t.relative&&(h[f].x1-=u,h[f].y1-=d,h[f].x2-=u,h[f].y2-=d,h[f].x-=u,h[f].y-=d),u=(o=[h[f].x,h[f].y])[0],d=o[1]}return h}(t,t.relative?0:e,t.relative?0:n):t})},t.ANNOTATE_ARCS=function(){return i(function(t,e,n){return t.relative&&(e=0,n=0),Yt.ARC===t.type&&It(t,e,n),t})},t.CLONE=function(){return function(t){var e={};for(var n in t)e[n]=t[n];return e}},t.CALCULATE_BOUNDS=function(){var t=e(),s=r(),o=n(),l=i(function(e,n,r){var i=o(s(t(function(t){var e={};for(var n in t)e[n]=t[n];return e}(e))));function a(t){t>l.maxX&&(l.maxX=t),t<l.minX&&(l.minX=t)}function c(t){t>l.maxY&&(l.maxY=t),t<l.minY&&(l.minY=t)}if(i.type&Yt.DRAWING_COMMANDS&&(a(n),c(r)),i.type&Yt.HORIZ_LINE_TO&&a(i.x),i.type&Yt.VERT_LINE_TO&&c(i.y),i.type&Yt.LINE_TO&&(a(i.x),c(i.y)),i.type&Yt.CURVE_TO){a(i.x),c(i.y);for(var h=0,u=jt(n,i.x1,i.x2,i.x);h<u.length;h++)0<(k=u[h])&&1>k&&a(Bt(n,i.x1,i.x2,i.x,k));for(var d=0,f=jt(r,i.y1,i.y2,i.y);d<f.length;d++)0<(k=f[d])&&1>k&&c(Bt(r,i.y1,i.y2,i.y,k))}if(i.type&Yt.ARC){a(i.x),c(i.y),It(i,n,r);for(var p=i.xRot/180*Math.PI,g=Math.cos(p)*i.rX,m=Math.sin(p)*i.rX,y=-Math.sin(p)*i.rY,v=Math.cos(p)*i.rY,x=i.phi1<i.phi2?[i.phi1,i.phi2]:-180>i.phi2?[i.phi2+360,i.phi1+360]:[i.phi2,i.phi1],b=x[0],w=x[1],C=function(t){var e=t[0],n=t[1],r=180*Math.atan2(n,e)/Math.PI;return r<b?r+360:r},S=0,O=zt(y,-g,0).map(C);S<O.length;S++)(k=O[S])>b&&k<w&&a(Wt(i.cX,g,y,k));for(var T=0,M=zt(v,-m,0).map(C);T<M.length;T++){var k;(k=M[T])>b&&k<w&&c(Wt(i.cY,m,v,k))}}return e});return l.minX=1/0,l.maxX=-1/0,l.minY=1/0,l.maxY=-1/0,l}}(Rt||(Rt={}));var Ut,Vt,Gt=function(){function t(){}return t.prototype.round=function(t){return this.transform(Rt.ROUND(t))},t.prototype.toAbs=function(){return this.transform(Rt.TO_ABS())},t.prototype.toRel=function(){return this.transform(Rt.TO_REL())},t.prototype.normalizeHVZ=function(t,e,n){return this.transform(Rt.NORMALIZE_HVZ(t,e,n))},t.prototype.normalizeST=function(){return this.transform(Rt.NORMALIZE_ST())},t.prototype.qtToC=function(){return this.transform(Rt.QT_TO_C())},t.prototype.aToC=function(){return this.transform(Rt.A_TO_C())},t.prototype.sanitize=function(t){return this.transform(Rt.SANITIZE(t))},t.prototype.translate=function(t,e){return this.transform(Rt.TRANSLATE(t,e))},t.prototype.scale=function(t,e){return this.transform(Rt.SCALE(t,e))},t.prototype.rotate=function(t,e,n){return this.transform(Rt.ROTATE(t,e,n))},t.prototype.matrix=function(t,e,n,r,i,s){return this.transform(Rt.MATRIX(t,e,n,r,i,s))},t.prototype.skewX=function(t){return this.transform(Rt.SKEW_X(t))},t.prototype.skewY=function(t){return this.transform(Rt.SKEW_Y(t))},t.prototype.xSymmetry=function(t){return this.transform(Rt.X_AXIS_SYMMETRY(t))},t.prototype.ySymmetry=function(t){return this.transform(Rt.Y_AXIS_SYMMETRY(t))},t.prototype.annotateArcs=function(){return this.transform(Rt.ANNOTATE_ARCS())},t}(),qt=function(t){return" "===t||"\t"===t||"\r"===t||"\n"===t},Xt=function(t){return"0".charCodeAt(0)<=t.charCodeAt(0)&&t.charCodeAt(0)<="9".charCodeAt(0)},$t=function(t){function e(){var e=t.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return _t(e,t),e.prototype.finish=function(t){if(void 0===t&&(t=[]),this.parse(" ",t),0!==this.curArgs.length||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return t},e.prototype.parse=function(t,e){var n=this;void 0===e&&(e=[]);for(var r=function(t){e.push(t),n.curArgs.length=0,n.canParseCommandOrComma=!0},i=0;i<t.length;i++){var s=t[i];if(Xt(s))this.curNumber+=s,this.curNumberHasExpDigits=this.curNumberHasExp;else if("e"!==s&&"E"!==s)if("-"!==s&&"+"!==s||!this.curNumberHasExp||this.curNumberHasExpDigits)if("."!==s||this.curNumberHasExp||this.curNumberHasDecimal){if(this.curNumber&&-1!==this.curCommandType){var o=Number(this.curNumber);if(isNaN(o))throw new SyntaxError("Invalid number ending at "+i);if(this.curCommandType===Yt.ARC)if(0===this.curArgs.length||1===this.curArgs.length){if(0>o)throw new SyntaxError('Expected positive number, got "'+o+'" at index "'+i+'"')}else if((3===this.curArgs.length||4===this.curArgs.length)&&"0"!==this.curNumber&&"1"!==this.curNumber)throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+i+'"');this.curArgs.push(o),this.curArgs.length===Kt[this.curCommandType]&&(Yt.HORIZ_LINE_TO===this.curCommandType?r({type:Yt.HORIZ_LINE_TO,relative:this.curCommandRelative,x:o}):Yt.VERT_LINE_TO===this.curCommandType?r({type:Yt.VERT_LINE_TO,relative:this.curCommandRelative,y:o}):this.curCommandType===Yt.MOVE_TO||this.curCommandType===Yt.LINE_TO||this.curCommandType===Yt.SMOOTH_QUAD_TO?(r({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),Yt.MOVE_TO===this.curCommandType&&(this.curCommandType=Yt.LINE_TO)):this.curCommandType===Yt.CURVE_TO?r({type:Yt.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===Yt.SMOOTH_CURVE_TO?r({type:Yt.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Yt.QUAD_TO?r({type:Yt.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===Yt.ARC&&r({type:Yt.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!qt(s))if(","===s&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if("+"!==s&&"-"!==s&&"."!==s){if(0!==this.curArgs.length)throw new SyntaxError("Unterminated command at index "+i+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+s+'" at index '+i+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,"z"!==s&&"Z"!==s)if("h"===s||"H"===s)this.curCommandType=Yt.HORIZ_LINE_TO,this.curCommandRelative="h"===s;else if("v"===s||"V"===s)this.curCommandType=Yt.VERT_LINE_TO,this.curCommandRelative="v"===s;else if("m"===s||"M"===s)this.curCommandType=Yt.MOVE_TO,this.curCommandRelative="m"===s;else if("l"===s||"L"===s)this.curCommandType=Yt.LINE_TO,this.curCommandRelative="l"===s;else if("c"===s||"C"===s)this.curCommandType=Yt.CURVE_TO,this.curCommandRelative="c"===s;else if("s"===s||"S"===s)this.curCommandType=Yt.SMOOTH_CURVE_TO,this.curCommandRelative="s"===s;else if("q"===s||"Q"===s)this.curCommandType=Yt.QUAD_TO,this.curCommandRelative="q"===s;else if("t"===s||"T"===s)this.curCommandType=Yt.SMOOTH_QUAD_TO,this.curCommandRelative="t"===s;else{if("a"!==s&&"A"!==s)throw new SyntaxError('Unexpected character "'+s+'" at index '+i+".");this.curCommandType=Yt.ARC,this.curCommandRelative="a"===s}else e.push({type:Yt.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=s,this.curNumberHasDecimal="."===s}else this.curNumber+=s,this.curNumberHasDecimal=!0;else this.curNumber+=s;else this.curNumber+=s,this.curNumberHasExp=!0}return e},e.prototype.transform=function(t){return Object.create(this,{parse:{value:function(e,n){void 0===n&&(n=[]);for(var r=0,i=Object.getPrototypeOf(this).parse.call(this,e);r<i.length;r++){var s=i[r],o=t(s);Array.isArray(o)?n.push.apply(n,o):n.push(o)}return n}}})},e}(Gt),Yt=function(t){function e(n){var r=t.call(this)||this;return r.commands="string"==typeof n?e.parse(n):n,r}return _t(e,t),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=Rt.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var e=[],n=0,r=this.commands;n<r.length;n++){var i=t(r[n]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return this.commands=e,this},e.encode=function(t){return Qt(t)},e.parse=function(t){var e=new $t,n=[];return e.parse(t,n),e.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(Gt),Kt=((Ut={})[Yt.MOVE_TO]=2,Ut[Yt.LINE_TO]=2,Ut[Yt.HORIZ_LINE_TO]=1,Ut[Yt.VERT_LINE_TO]=1,Ut[Yt.CLOSE_PATH]=0,Ut[Yt.QUAD_TO]=4,Ut[Yt.SMOOTH_QUAD_TO]=2,Ut[Yt.CURVE_TO]=6,Ut[Yt.SMOOTH_CURVE_TO]=4,Ut[Yt.ARC]=7,Ut),Zt=" ";function Qt(t){var e="";Array.isArray(t)||(t=[t]);for(var n=0;n<t.length;n++){var r=t[n];if(r.type===Yt.CLOSE_PATH)e+="z";else if(r.type===Yt.HORIZ_LINE_TO)e+=(r.relative?"h":"H")+r.x;else if(r.type===Yt.VERT_LINE_TO)e+=(r.relative?"v":"V")+r.y;else if(r.type===Yt.MOVE_TO)e+=(r.relative?"m":"M")+r.x+Zt+r.y;else if(r.type===Yt.LINE_TO)e+=(r.relative?"l":"L")+r.x+Zt+r.y;else if(r.type===Yt.CURVE_TO)e+=(r.relative?"c":"C")+r.x1+Zt+r.y1+Zt+r.x2+Zt+r.y2+Zt+r.x+Zt+r.y;else if(r.type===Yt.SMOOTH_CURVE_TO)e+=(r.relative?"s":"S")+r.x2+Zt+r.y2+Zt+r.x+Zt+r.y;else if(r.type===Yt.QUAD_TO)e+=(r.relative?"q":"Q")+r.x1+Zt+r.y1+Zt+r.x+Zt+r.y;else if(r.type===Yt.SMOOTH_QUAD_TO)e+=(r.relative?"t":"T")+r.x+Zt+r.y;else{if(r.type!==Yt.ARC)throw new Error('Unexpected command type "'+r.type+'" at index '+n+".");e+=(r.relative?"a":"A")+r.rX+Zt+r.rY+Zt+r.xRot+Zt+ +r.lArcFlag+Zt+ +r.sweepFlag+Zt+r.x+Zt+r.y}}return e}var Jt=function(t){function e(n){var r=t.call(this)||this;return r.commands="string"==typeof n?e.parse(n):n,r}return _t(e,t),e.prototype.encode=function(){return e.encode(this.commands)},e.prototype.getBounds=function(){var t=Rt.CALCULATE_BOUNDS();return this.transform(t),t},e.prototype.transform=function(t){for(var e=[],n=0,r=this.commands;n<r.length;n++){var i=t(r[n]);Array.isArray(i)?e.push.apply(e,i):e.push(i)}return this.commands=e,this},e.encode=function(t){return Qt(t)},e.parse=function(t){var e=new $t,n=[];return e.parse(t,n),e.finish(n),n},e.CLOSE_PATH=1,e.MOVE_TO=2,e.HORIZ_LINE_TO=4,e.VERT_LINE_TO=8,e.LINE_TO=16,e.CURVE_TO=32,e.SMOOTH_CURVE_TO=64,e.QUAD_TO=128,e.SMOOTH_QUAD_TO=256,e.ARC=512,e.LINE_COMMANDS=e.LINE_TO|e.HORIZ_LINE_TO|e.VERT_LINE_TO,e.DRAWING_COMMANDS=e.HORIZ_LINE_TO|e.VERT_LINE_TO|e.LINE_TO|e.CURVE_TO|e.SMOOTH_CURVE_TO|e.QUAD_TO|e.SMOOTH_QUAD_TO|e.ARC,e}(Gt);(Vt={})[Jt.MOVE_TO]=2,Vt[Jt.LINE_TO]=2,Vt[Jt.HORIZ_LINE_TO]=1,Vt[Jt.VERT_LINE_TO]=1,Vt[Jt.CLOSE_PATH]=0,Vt[Jt.QUAD_TO]=4,Vt[Jt.SMOOTH_QUAD_TO]=2,Vt[Jt.CURVE_TO]=6,Vt[Jt.SMOOTH_CURVE_TO]=4,Vt[Jt.ARC]=7;const te=t=>{const e=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;return e instanceof SVGElement?e:null},ee=t=>{const e=ot.create();return ne(t,e),e.updateFrontier(),e},ne=(t,e)=>{re(t,e);const n=Array.from(t.children).filter(t=>t instanceof SVGGElement||t instanceof SVGGeometryElement);for(let t of n){let n;t instanceof SVGGElement?(n=lt.create(),e.mount(n),ne(t,n)):(n=ie(t),e.mount(n))}},re=(e,n)=>{if("svg"===e.tagName){const t=e.getAttributeNS(null,"viewBox").split(" ").map(t=>Number(t)),r=u.create(t[0],t[1]),i=u.create(t[2],t[3]);n.viewBox=p.create(r,i)}if(e.transform&&e.transform.baseVal&&e.transform.baseVal.consolidate()){const t=e.transform.baseVal.consolidate().matrix;n.transform=f.createFromDOMMatrix(t)}n.class=t.create(Array.from(e.classList)),e.attributes.fill&&(n.fill=e.getAttributeNS(null,"fill")),e.attributes.stroke&&(n.stroke=e.getAttributeNS(null,"stroke"))},ie=t=>{const e=at.create();let n;switch(re(t,e),t.tagName){case"rect":const r=Number(t.getAttributeNS(null,"x")),i=Number(t.getAttributeNS(null,"y")),s=Number(t.getAttributeNS(null,"width")),o=Number(t.getAttributeNS(null,"height"));n=he(`\n        M ${r} ${i}\n        H ${r+s}\n        V ${i+o}\n        H ${r}\n        Z\n      `);break;case"path":n=he(t.getAttributeNS(null,"d"))}const r=ce(n);for(let t of r){const n=se(t);e.mount(n)}return e},se=t=>{const e=ct.create({closed:1===t[t.length-1].type}),n=oe(t,e);for(let t of n)e.mount(t);return e},oe=(t,e)=>{const n=[];n.push(ht.create().mount(dt.create({vector:u.create(t[0].x,t[0].y)})));const r=e.isClosed()?t.length-2:t.length;for(let e=1;e<r;e+=1)n.push(le(t[e],n[e-1]));return ae(n),n},le=(t,e)=>{const n=ht.create().mount(dt.create({vector:u.create(t.x,t.y)}));return t.x1&&t.x2?(e.mount(pt.create({vector:u.create(t.x1,t.y1)})),n.mount(ft.create({vector:u.create(t.x2,t.y2)}))):t.x1&&n.mount(ft.create({vector:u.create(t.x1,t.y1)})),n},ae=t=>{const e=t[0],n=t[t.length-1];e.handleOut&&e.mount(ft.create({vector:e.handleOut.vector.rotate(Math.PI,e.anchor.vector)})),n.handleIn&&n.mount(pt.create({vector:n.handleIn.vector.rotate(Math.PI,n.anchor.vector)}))},ce=t=>{const e=[];for(let n of t)2===n.type?e.push([n]):e[e.length-1].push(n);return e},he=t=>new Jt(t).transform(Rt.NORMALIZE_HVZ(!1)).transform(Rt.NORMALIZE_ST()).transform(Rt.A_TO_C()).toAbs().commands,ue={create:t=>Object.create(ue).init(t),init(t){return this.editor=this.buildEditor(t),this.description={mode:"start",label:void 0,input:{},update:void 0,layout:{menuVisible:!1}},this.temp={},this.snapshots={},this},buildEditor(t){return mt.create().mount(this.buildDoc(t),this.buildTools(),yt.create(),this.buildMessage())},buildMessage:()=>vt.create({text:"Welcome!"}),buildTools:()=>Ot.create().mount(Tt.create({name:"Pen",iconPath:"/assets/buttons/pen.svg",toolType:"penButton"}),Tt.create({name:"Select",iconPath:"/assets/buttons/select.svg",toolType:"selectButton"}),Tt.create({name:"Undo",iconPath:"/assets/buttons/undo.svg",toolType:"getPrevious"}),Tt.create({name:"Redo",iconPath:"/assets/buttons/redo.svg",toolType:"getNext"}),Tt.create({name:"New",iconPath:"/assets/buttons/new.svg",toolType:"newDocButton"}),Tt.create({name:"Open",iconPath:"/assets/buttons/open.svg",toolType:"docListButton"})),buildDoc:t=>gt.create({canvasWidth:t}).mount(ot.create({viewBox:p.createFromDimensions(0,0,800,1600)})),docToObject(){return(t=>({doc:JSON.parse(JSON.stringify(t))}))(this.doc)},objectToDoc:t=>kt(t),markupToCanvas:t=>(t=>{const e=te(t);return e?ee(e):null})(t),snapshot(t){if(this.snapshots[t])return this.snapshots[t];switch(t){case"vDOM":return this.snapshots.vDOM={tools:a.tools(this.tools),menu:a.menu(this.docs),message:this.editor.message.text,canvas:this.canvas.renderElement()};case"plain":return this.snapshots.plain=this.docToObject();case"markupTree":return this.snapshots.markupTree=this.canvas.renderTags()}}};Object.defineProperty(ue,"mode",{get(){return this.description.mode},set(t){this.description.mode=t}}),Object.defineProperty(ue,"label",{get(){return this.description.label},set(t){this.description.label=t}}),Object.defineProperty(ue,"input",{get(){return this.description.input},set(t){this.description.input=t}}),Object.defineProperty(ue,"update",{get(){return this.description.update},set(t){this.description.update=t}}),Object.defineProperty(ue,"layout",{get(){return this.description.layout},set(t){this.description.layout=t}}),Object.defineProperty(ue,"canvas",{get(){return this.editor.canvas}}),Object.defineProperty(ue,"doc",{get(){return this.editor.doc}}),Object.defineProperty(ue,"tools",{get(){return this.editor.tools}}),Object.defineProperty(ue,"docs",{get(){return this.editor.docs}}),Object.defineProperty(ue,"message",{get(){return this.editor.message}}),Object.defineProperty(ue,"target",{get(){return this.temp.target},set(t){this.temp.target=t}}),Object.defineProperty(ue,"from",{get(){return this.temp.from},set(t){this.temp.from=t}});const de=[{from:{mode:"start"},type:"go",do:"go",to:{mode:"select",label:"idle"}},{type:"resize",do:"refresh"},{type:"click",target:"newDocButton",do:"createDoc",to:{mode:"select",label:"idle"}},{type:"click",target:"docListButton",do:"toggleMenu"},{type:"click",target:"doc-identifier",do:"requestDoc"},{type:"click",target:"selectButton",do:"cleanup",to:{mode:"select",label:"idle"}},{type:"keydown",target:"letterS",do:"cleanup",to:{mode:"select",label:"idle"}},{type:"click",target:"penButton",do:"cleanup",to:{mode:"pen",label:"idle"}},{type:"keydown",target:"letterV",do:"cleanup",to:{mode:"pen",label:"idle"}},{type:"click",target:"getPrevious",do:"getPrevious",to:{mode:"select",label:"idle"}},{type:"click",target:"getNext",do:"getNext",to:{mode:"select",label:"idle"}},{type:"keydown",target:"esc",do:"exitEdit"},{type:"keydown",target:"delete",do:"deleteNode"},{from:{mode:"pen",label:"idle"},type:"keydown",target:"letterC",do:"toggleClosedStatus"},{from:{mode:"select",label:"idle"},type:"mousemove",do:"focus"},{from:{mode:"select",label:"idle"},type:"dblclick",do:"deepSelect"},{from:{mode:"select",label:"idle"},type:"mousedown",target:[tt.CURVE,tt.SHAPE,tt.GROUP,tt.CANVAS],do:"select",to:{mode:"select",label:"shifting"}},{from:{mode:"select",label:"idle"},type:"mousedown",target:"dot",do:"initTransform",to:{mode:"select",label:"rotating"}},{from:{mode:"select",label:"idle"},type:"mousedown",target:["nw-corner","ne-corner","sw-corner","se-corner"],do:"initTransform",to:{mode:"select",label:"scaling"}},{from:{mode:"select",label:"shifting"},type:"mousemove",do:"shift"},{from:{mode:"select",label:"shifting"},type:"mouseup",do:"release",to:{mode:"select",label:"idle"}},{from:{mode:"select",label:"rotating"},type:"mousemove",do:"rotate"},{from:{mode:"select",label:"rotating"},type:"mouseup",do:"release",to:{mode:"select",label:"idle"}},{from:{mode:"select",label:"scaling"},type:"mousemove",do:"scale"},{from:{mode:"select",label:"scaling"},type:"mouseup",do:"release",to:{mode:"select",label:"idle"}},{from:{mode:"pen",label:"idle"},type:"mousedown",target:[tt.SHAPE,tt.GROUP,tt.CANVAS],do:"addSegment",to:{mode:"pen",label:"settingHandles"}},{from:{mode:"pen",label:"settingHandles"},type:"mousemove",do:"setHandles"},{from:{mode:"pen",label:"settingHandles"},type:"mouseup",do:"releasePen",to:{mode:"pen",label:"idle"}},{from:{mode:"pen",label:"idle"},type:"mousedown",target:[tt.ANCHOR,tt.HANDLEIN,tt.HANDLEOUT],do:"initAdjustSegment",to:{mode:"pen",label:"adjustingSegment"}},{from:{mode:"pen",label:"adjustingSegment"},type:"mousemove",do:"adjustSegment"},{from:{mode:"pen",label:"adjustingSegment"},type:"mouseup",do:"releasePen",to:{mode:"pen",label:"idle"}},{from:{mode:"pen",label:"idle"},type:"mousemove",target:"curve",do:"projectInput"},{from:{mode:"pen",label:"idle"},type:"mouseout",target:"curve",do:"hideSplitter"},{from:{mode:"pen",label:"idle"},type:"mousedown",target:"curve",do:"splitCurve",to:{mode:"pen",label:"adjustingSegment"}},{type:"userChangedMarkup",do:"userChangedMarkup"},{type:"userSelectedMarkupNode",do:"userSelectedMarkupNode"},{type:"docSaved",do:"setSavedMessage"},{type:"wipeMessage",do:"wipeMessage"},{type:"updateDocList",do:"updateDocList"},{type:"switchDocument",do:"switchDocument"}];de.get=function(t,e){const n=de.find(n=>{const r=n.from,i=n.type,s=n.target,o=void 0===r||r.mode===t.mode&&r.label===t.label,l=i===e.type,a=Array.isArray(s)&&s.includes(e.target)||"string"==typeof s&&s===e.target||void 0===s;return o&&l&&a});if(n)return{do:n.do,to:n.to||{mode:t.mode,label:t.label}}};const fe={after(t,e){"mousemove"!==e.type&&(t.tools.setActiveStatus(t.description),t.docs.setActiveStatus(t.doc._id)),t.canvas.setCursor(t.input,t.description)},refresh(t,e){e.width>0&&(t.doc.canvasWidth=e.width);for(let e of t.canvas.leaves)e.invalidateCache()},focus(t,e){t.canvas.removeFocus();const n=t.canvas.findDescendantByKey(e.key);if(!n)return;const r=u.create(e.x,e.y);t.target=n.findAncestorByClass("frontier"),t.target&&t.target.contains(r)&&t.target.focus()},select(t,e){t.target=t.canvas.findFocus(),t.target?(t.target.select(),t.from=u.create(e.x,e.y),t.temp.center=t.target.bounds.center.transform(t.target.globalTransform())):t.canvas.removeSelection()},deepSelect(t,e){const n=t.canvas.findDescendantByKey(e.key),r=n&&n.findAncestorByClass("frontier");r&&(r.type===tt.SHAPE?(r.placePen(),t.mode="pen",t.label="idle",t.canvas.removeFocus()):r.type===tt.GROUP&&(r===n?(t.canvas.select(),t.canvas.removeFocus()):(r.children.find(t=>t.descendants.includes(n)).select(),t.canvas.updateFrontier(),t.canvas.removeFocus())))},release(t,e){t.target&&(t.canvas.updateBounds(t.target),t.temp={})},cleanup(t,e){const n=t.canvas.findPen();n&&t.canvas.updateBounds(n),t.canvas.removeSelection(),t.canvas.removePen()},exitEdit(t,e){"pen"===t.mode&&"idle"===t.label?(t.target=t.canvas.findPen(),fe.cleanup(t,e),t.target.select(),t.mode="select",t.label="idle"):"select"===t.mode&&"idle"===t.label&&fe.cleanup(t,e)},deleteNode(t,e){let n=t.canvas.findSelection()||t.canvas.findPenTip();n&&(n.type===tt.ANCHOR?n.parent.unmount():[tt.GROUP,tt.SHAPE,tt.HANDLEIN,tt.HANDLEOUT].includes(n.type)&&n.unmount())},initTransform(t,e){t.target=t.canvas.findDescendantByKey(e.key),t.from=u.create(e.x,e.y),t.temp.center=t.target.bounds.center.transform(t.target.globalTransform())},shift(t,e){if(!t.target)return;const n=u.create(e.x,e.y),r=t.from,i=n.minus(r);t.target.translate(i),t.from=n},rotate(t,e){if(!t.target)return;const n=u.create(e.x,e.y),r=t.from,i=t.temp.center,s=i.angle(r,n);t.target.rotate(s,i),t.from=n},scale(t,e){if(!t.target)return;const n=u.create(e.x,e.y),r=t.from,i=t.temp.center,s=n.minus(i).length()/r.minus(i).length();t.target.scale(s,i),t.from=n},addSegment(t,e){t.target=t.canvas.findPen()||t.canvas.mountShape().placePen();const n=t.target.lastChild||t.target.mountSpline();if(n.isClosed())return t.mode="pen",void(t.label="idle");n.mountSegment().mountAnchor(u.create(e.x,e.y).transformToLocal(t.target)).placePenTip()},setHandles(t,e){t.target=t.canvas.findPen();const n=t.target.lastChild.lastChild,r=n.handleOut||n.mountHandleOut();r.vector=u.create(e.x,e.y).transformToLocal(t.target),(n.handleIn||n.mountHandleIn()).vector=r.vector.rotate(Math.PI,n.anchor.vector),r.placePenTip()},initAdjustSegment(t,e){const n=t.canvas.findDescendantByKey(e.key);t.target=n.parent.parent.parent,t.from=u.create(e.x,e.y).transformToLocal(t.target),n.placePenTip()},toggleClosedStatus(t,e){console.log("toggleClosedStatus update");const n=t.canvas.findPenTip().parent.parent;n.isClosed()?n.open():n.close()},adjustSegment(t,e){const n=t.canvas.findPenTip(),r=n.parent;t.target=r.parent.parent;const i=u.create(e.x,e.y).transformToLocal(t.target),s=i.minus(t.from);switch(n.vector=n.vector.add(s),n.type){case"anchor":r.handleIn&&(r.handleIn.vector=r.handleIn.vector.add(s)),r.handleOut&&(r.handleOut.vector=r.handleOut.vector.add(s));break;case"handleIn":r.handleOut.vector=r.handleIn.vector.rotate(Math.PI,r.anchor.vector);break;case"handleOut":r.handleIn.vector=r.handleOut.vector.rotate(Math.PI,r.anchor.vector)}t.from=i},projectInput(t,e){const n=t.canvas.findDescendantByKey(e.key),r=n.parent,i=r.parent,s=r.children.indexOf(n),o=r.children[s+1]||r.children[0],l=J.createFromSegments(n,o),a=new Z(...l.coords()),c=u.create(e.x,e.y).transformToLocal(i),h=a.project({x:c.x,y:c.y});i.splitter=u.createFromObject(h),t.temp.spline=r,t.temp.splitter=i.splitter,t.temp.startSegment=n,t.temp.endSegment=o,t.temp.insertionIndex=s+1,t.temp.bCurve=a,t.temp.curveTime=h.t,t.from=c,t.target=i},splitCurve(t,e){t.target;const n=t.temp.spline,r=t.temp.splitter,i=t.temp.startSegment,s=t.temp.endSegment,o=t.temp.insertionIndex,l=t.temp.bCurve,a=t.temp.curveTime,c=l.split(a),h=c.left,d=c.right,f=ht.create(),p=f.mountAnchor(),g=f.mountHandleIn(),m=f.mountHandleOut();n.insertChild(f,o),p.vector=r,g.vector=u.createFromObject(h.points[2]),m.vector=u.createFromObject(d.points[1]),i.handleOut.vector=u.createFromObject(h.points[1]),s.handleIn.vector=u.createFromObject(d.points[2]),p.placePenTip(),fe.hideSplitter(t,e),fe.adjustSegment(t,e)},hideSplitter(t,e){const n=t.canvas.findDescendantByKey(e.key);t.target=n.parent.parent,t.target.splitter=u.create(-1e3,-1e3)},userSelectedMarkupNode(t,e){fe.cleanup(t,e);const n=t.canvas.findDescendantByKey(e.key);n&&(n.type===tt.SHAPE||n.type===tt.GROUP?(t.target=n,n.select(),t.mode="select",t.label="idle"):n.type===tt.SPLINE?(t.target=n.parent,t.target.placePen(),t.canvas.removeFocus(),t.mode="pen",t.label="idle"):[tt.ANCHOR,tt.HANDLEIN,tt.HANDLEOUT].includes(n.type)&&(t.target=n.parent.parent.parent,t.target.placePen(),n.placePenTip(),t.mode="pen",t.label="idle"))},userChangedMarkup(t,e){const n=t.markupToCanvas(e.value);n&&t.canvas.replaceWith(n)},createDoc(t,e){t.doc.replaceWith(t.buildDoc(t.doc.canvasWidth))},switchDocument(t,e){t.doc.replaceWith(t.objectToDoc(e.data.doc)),fe.cleanup(t,e)},updateDocList(t,e){t.docs.children=[];for(let n of e.data.docIDs){const e=xt.create();e._id=n,t.docs.mount(e)}},toggleMenu(t,e){t.layout.menuVisible?t.layout.menuVisible=!1:t.layout.menuVisible=!0},getPrevious(t,e){window.history.back()},getNext(t,e){window.history.forward()},setSavedMessage(t,e){t.message.text="Saved"},wipeMessage(t,e){t.message.text=""}},pe={init(t){return this.state=ue.create(t),this.modules=[],this},attach(t,e){this.modules[t]=e},compute(t){this.state.input=t;const e=de.get(this.state,t);if(e){this.state.update=e.do,this.state.mode=e.to.mode,this.state.label=e.to.label;const n=fe[e.do];n&&(n(this.state,t),fe.after(this.state,t)),this.publish()}},publish(){for(let t of Object.keys(this.modules))this.modules[t](this.state.description);this.state.snapshots={}},kickoff(){this.compute({type:"go"})}},ge={init(t){return this.name="db",this},bindEvents(t){window.addEventListener("upsertDoc",e=>{const n=new XMLHttpRequest;n.addEventListener("load",()=>{t({source:this.name,type:"docSaved",data:{}})}),n.open("POST","/docs/"+e.detail.props._id),n.send(JSON.stringify(e.detail))}),window.addEventListener("readDoc",e=>{const n=new XMLHttpRequest;n.addEventListener("load",()=>{t({source:this.name,type:"switchDocument",data:{doc:n.response}})}),n.open("GET","/docs/"+e.detail),n.responseType="json",n.send()}),window.addEventListener("loadDocIDs",e=>{const n=new XMLHttpRequest;n.addEventListener("load",()=>{t({source:this.name,type:"updateDocList",data:{docIDs:n.response}})}),n.open("GET","/ids"),n.responseType="json",n.send()})},react(t){if("go"===t.update)window.dispatchEvent(new Event("loadDocIDs"));else if("requestDoc"===t.update)window.dispatchEvent(new CustomEvent("readDoc",{detail:t.input.key}));else if(["release","releasePen","changeMarkup"].includes(t.update)){const t=this.requestSnapshot("plain");window.dispatchEvent(new CustomEvent("upsertDoc",{detail:t.doc}))}}},me={init(){return this.name="hist",this},bindEvents(t){window.addEventListener("popstate",e=>{e.state&&t({source:this.name,type:"switchDocument",data:e.state})})},react(t){if(this.isRelevant(t.update)){const t=this.requestSnapshot("plain");window.history.pushState(t,"entry")}},isRelevant:t=>"release"===t||"releasePen"===t||"go"===t||"changeMarkup"===t},ye={init(){return this.name="keyboard",this},bindEvents(t){window.addEventListener("keydown",e=>{switch(e.keyCode){case 27:t({source:this.name,type:e.type,target:"esc"});break;case 8:t({source:this.name,type:e.type,target:"delete"});break;case 67:t({source:this.name,type:e.type,target:"letterC"});break;case 86:t({source:this.name,type:e.type,target:"letterV"});break;case 83:t({source:this.name,type:e.type,target:"letterS"})}})}},ve=(t,e)=>{t({source:e,type:"resize",width:document.querySelector("#canvas-wrapper").clientWidth})},xe={init(){return this.name="mouse",this.mountPoint=document.querySelector("#canvas"),this},bindEvents(t){this.bindMouseButtonEvents(t),this.bindMouseMoveEvents(t),this.bindViewportEvents(t)},bindViewportEvents(t){window.onresize=()=>ve(t,this.name)},bindMouseButtonEvents(t){const e=["click","dblclick","mousedown","mouseup","mouseout"];for(let n of e){const e={source:this.name,type:n};this.mountPoint.addEventListener(n,r=>{if(["click","mousedown","mouseup"].includes(n)&&r.detail>1)return void r.stopPropagation();const i=document.querySelector("textarea");i&&i.blur(),r.preventDefault(),Object.assign(e,{target:r.target.dataset.type,key:r.target.dataset.key,x:this.coordinates(r).x,y:this.coordinates(r).y}),t(e)})}},bindMouseMoveEvents(t){const e={source:this.name,type:"mousemove"},n={};this.mountPoint.addEventListener("mousemove",t=>{t.preventDefault(),Object.assign(e,{target:t.target.dataset.type,key:t.target.dataset.key,x:this.coordinates(t).x,y:this.coordinates(t).y})});const r=()=>{requestAnimationFrame(r),e.x===n.x&&e.y===n.y||t(e),n.x=e.x,n.y=e.y};requestAnimationFrame(r)},coordinates(t){const e={},n=document.querySelector("svg");if(n){let r=n.createSVGPoint();r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(n.getScreenCTM().inverse()),e.x=r.x,e.y=r.y}return e}},be={init(){this.mountPoint||(this.mountPoint=document.querySelector(`#${this.name}`));const t=this.requestSnapshot("vDOM")[this.name];this.dom=this.createElement(t),this.previousVDOM=t,this.mount()},mount(){this.mountPoint.innerHTML="",this.mountPoint.appendChild(this.dom)},react(t){const e=this.requestSnapshot("vDOM")[this.name];this.reconcile(this.previousVDOM,e,this.dom),this.previousVDOM=e},createElement(t){if("string"==typeof t)return document.createTextNode(t);const e=document.createElement(t.tag);for(let[n,r]of Object.entries(t.props))e.setAttribute(n,r);for(let n of t.children)e.appendChild(this.createElement(n));return e},reconcile(t,e,n){this.patch(this.diff(t,e,n))},diff(t,e,n,r=[]){return t!==e&&("string"==typeof e||t.tag!==e.tag?r.push(()=>n.replaceWith(this.createElement(e))):(this.reconcileProps(t,e,n,r),this.reconcileChildren(t,e,n,r))),r},patch(t){for(let e of t)e()},reconcileProps(t,e,n,r){for(let[i,s]of Object.entries(e.props))t.props[i]!==e.props[i]&&r.push(()=>n.setAttributeNS(null,i,s));for(let[i,s]of Object.entries(t.props))void 0===e.props[i]&&r.push(()=>n.removeAttributeNS(null,i))},reconcileChildren(t,e,n,r){const i=Math.max(t.children.length,e.children.length);for(let s=0;s<i;s+=1){const i=t.children[s],o=e.children[s],l=n.childNodes[s];void 0===o?l&&r.push(()=>l.remove()):void 0===i?r.push(()=>n.appendChild(this.createElement(o))):this.reconcile(i,o,l,r)}}},we=Object.assign(Object.create(be),{init(){return this.name="tools",be.init.bind(this)(),this},bindEvents(t){this.mountPoint.addEventListener("click",e=>{e.preventDefault();const n=document.querySelector("textarea");n&&n.blur(),t({source:this.name,type:e.type,target:e.target.dataset.type,key:e.target.dataset.key}),"docListButton"===e.target.dataset.type&&ve(t,this.name)})}}),Ce=Object.assign(Object.create(be),{init(){return this.name="menu",be.init.bind(this)(),this},bindEvents(t){this.mountPoint.addEventListener("click",e=>{e.preventDefault();const n=document.querySelector("textarea");n&&n.blur(),t({source:this.name,type:e.type,target:e.target.dataset.type,key:e.target.dataset.key})})},react(t){if(t.layout.menuVisible){document.querySelector("main").classList.add("menu-expanded");const t=this.requestSnapshot("vDOM")[this.name];this.reconcile(this.previousVDOM,t,this.dom),this.previousVDOM=t}else document.querySelector("main").classList.remove("menu-expanded")}}),Se=Object.assign(Object.create(be),{init(){return this.name="canvas",be.init.bind(this)(),this},createElement(t){if("string"==typeof t)return document.createTextNode(t);const e=document.createElementNS("http://www.w3.org/2000/svg",t.tag);for(let[n,r]of Object.entries(t.props))"xmlns"===n?e.setAttributeNS("http://www.w3.org/2000/xmlns/",n,r):r&&e.setAttributeNS(null,n,r);for(let n of t.children)e.appendChild(this.createElement(n));return e},coordinates(t){const e={},n=document.querySelector("svg");if(n){let r=n.createSVGPoint();r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(n.getScreenCTM().inverse()),e.x=r.x,e.y=r.y}return e}});let Oe=navigator.userAgent,Te=navigator.platform,Me=/gecko\/\d/i.test(Oe),ke=/MSIE \d/.test(Oe),Ne=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Oe),Le=/Edge\/(\d+)/.exec(Oe),Ae=ke||Ne||Le,_e=Ae&&(ke?document.documentMode||6:+(Le||Ne)[1]),Ee=!Le&&/WebKit\//.test(Oe),De=Ee&&/Qt\/\d+\.\d+/.test(Oe),Pe=!Le&&/Chrome\//.test(Oe),Ie=/Opera\//.test(Oe),ze=/Apple Computer/.test(navigator.vendor),Re=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(Oe),He=/PhantomJS/.test(Oe),Fe=!Le&&/AppleWebKit/.test(Oe)&&/Mobile\/\w+/.test(Oe),We=/Android/.test(Oe),je=Fe||We||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(Oe),Be=Fe||/Mac/.test(Te),Ue=/\bCrOS\b/.test(Oe),Ve=/win/i.test(Te),Ge=Ie&&Oe.match(/Version\/(\d*\.\d*)/);Ge&&(Ge=Number(Ge[1])),Ge&&Ge>=15&&(Ie=!1,Ee=!0);let qe=Be&&(De||Ie&&(null==Ge||Ge<12.11)),Xe=Me||Ae&&_e>=9;function $e(t){return new RegExp("(^|\\s)"+t+"(?:$|\\s)\\s*")}let Ye,Ke=function(t,e){let n=t.className,r=$e(e).exec(n);if(r){let e=n.slice(r.index+r[0].length);t.className=n.slice(0,r.index)+(e?r[1]+e:"")}};function Ze(t){for(let e=t.childNodes.length;e>0;--e)t.removeChild(t.firstChild);return t}function Qe(t,e){return Ze(t).appendChild(e)}function Je(t,e,n,r){let i=document.createElement(t);if(n&&(i.className=n),r&&(i.style.cssText=r),"string"==typeof e)i.appendChild(document.createTextNode(e));else if(e)for(let t=0;t<e.length;++t)i.appendChild(e[t]);return i}function tn(t,e,n,r){let i=Je(t,e,n,r);return i.setAttribute("role","presentation"),i}function en(t,e){if(3==e.nodeType&&(e=e.parentNode),t.contains)return t.contains(e);do{if(11==e.nodeType&&(e=e.host),e==t)return!0}while(e=e.parentNode)}function nn(){let t;try{t=document.activeElement}catch(e){t=document.body||null}for(;t&&t.shadowRoot&&t.shadowRoot.activeElement;)t=t.shadowRoot.activeElement;return t}function rn(t,e){let n=t.className;$e(e).test(n)||(t.className+=(n?" ":"")+e)}function sn(t,e){let n=t.split(" ");for(let t=0;t<n.length;t++)n[t]&&!$e(n[t]).test(e)&&(e+=" "+n[t]);return e}Ye=document.createRange?function(t,e,n,r){let i=document.createRange();return i.setEnd(r||t,n),i.setStart(t,e),i}:function(t,e,n){let r=document.body.createTextRange();try{r.moveToElementText(t.parentNode)}catch(t){return r}return r.collapse(!0),r.moveEnd("character",n),r.moveStart("character",e),r};let on=function(t){t.select()};function ln(t){let e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e)}}function an(t,e,n){e||(e={});for(let r in t)!t.hasOwnProperty(r)||!1===n&&e.hasOwnProperty(r)||(e[r]=t[r]);return e}function cn(t,e,n,r,i){null==e&&-1==(e=t.search(/[^\s\u00a0]/))&&(e=t.length);for(let s=r||0,o=i||0;;){let r=t.indexOf("\t",s);if(r<0||r>=e)return o+(e-s);o+=r-s,o+=n-o%n,s=r+1}}Fe?on=function(t){t.selectionStart=0,t.selectionEnd=t.value.length}:Ae&&(on=function(t){try{t.select()}catch(t){}});class hn{constructor(){this.id=null}set(t,e){clearTimeout(this.id),this.id=setTimeout(e,t)}}function un(t,e){for(let n=0;n<t.length;++n)if(t[n]==e)return n;return-1}let dn=30,fn={toString:function(){return"CodeMirror.Pass"}},pn={scroll:!1},gn={origin:"*mouse"},mn={origin:"+move"};function yn(t,e,n){for(let r=0,i=0;;){let s=t.indexOf("\t",r);-1==s&&(s=t.length);let o=s-r;if(s==t.length||i+o>=e)return r+Math.min(o,e-i);if(i+=s-r,r=s+1,(i+=n-i%n)>=e)return r}}let vn=[""];function xn(t){for(;vn.length<=t;)vn.push(bn(vn)+" ");return vn[t]}function bn(t){return t[t.length-1]}function wn(t,e){let n=[];for(let r=0;r<t.length;r++)n[r]=e(t[r],r);return n}function Cn(){}function Sn(t,e){let n;return Object.create?n=Object.create(t):(Cn.prototype=t,n=new Cn),e&&an(e,n),n}let On=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function Tn(t){return/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||On.test(t))}function Mn(t,e){return e?!!(e.source.indexOf("\\w")>-1&&Tn(t))||e.test(t):Tn(t)}function kn(t){for(let e in t)if(t.hasOwnProperty(e)&&t[e])return!1;return!0}let Nn=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function Ln(t){return t.charCodeAt(0)>=768&&Nn.test(t)}function An(t,e,n){for(;(n<0?e>0:e<t.length)&&Ln(t.charAt(e));)e+=n;return e}function _n(t,e,n){let r=e>n?-1:1;for(;;){if(e==n)return e;let i=(e+n)/2,s=r<0?Math.ceil(i):Math.floor(i);if(s==e)return t(s)?e:n;t(s)?n=s:e=s+r}}let En=null;function Dn(t,e,n){let r;En=null;for(let i=0;i<t.length;++i){let s=t[i];if(s.from<e&&s.to>e)return i;s.to==e&&(s.from!=s.to&&"before"==n?r=i:En=i),s.from==e&&(s.from!=s.to&&"before"!=n?r=i:En=i)}return null!=r?r:En}let Pn=function(){let t="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",e="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";let n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,r=/[stwN]/,i=/[LRr]/,s=/[Lb1n]/,o=/[1n]/;function l(t,e,n){this.level=t,this.from=e,this.to=n}return function(a,c){let h="ltr"==c?"L":"R";if(0==a.length||"ltr"==c&&!n.test(a))return!1;let u=a.length,d=[];for(let n=0;n<u;++n)d.push((f=a.charCodeAt(n))<=247?t.charAt(f):1424<=f&&f<=1524?"R":1536<=f&&f<=1785?e.charAt(f-1536):1774<=f&&f<=2220?"r":8192<=f&&f<=8203?"w":8204==f?"b":"L");var f;for(let t=0,e=h;t<u;++t){let n=d[t];"m"==n?d[t]=e:e=n}for(let t=0,e=h;t<u;++t){let n=d[t];"1"==n&&"r"==e?d[t]="n":i.test(n)&&(e=n,"r"==n&&(d[t]="R"))}for(let t=1,e=d[0];t<u-1;++t){let n=d[t];"+"==n&&"1"==e&&"1"==d[t+1]?d[t]="1":","!=n||e!=d[t+1]||"1"!=e&&"n"!=e||(d[t]=e),e=n}for(let t=0;t<u;++t){let e=d[t];if(","==e)d[t]="N";else if("%"==e){let e;for(e=t+1;e<u&&"%"==d[e];++e);let n=t&&"!"==d[t-1]||e<u&&"1"==d[e]?"1":"N";for(let r=t;r<e;++r)d[r]=n;t=e-1}}for(let t=0,e=h;t<u;++t){let n=d[t];"L"==e&&"1"==n?d[t]="L":i.test(n)&&(e=n)}for(let t=0;t<u;++t)if(r.test(d[t])){let e;for(e=t+1;e<u&&r.test(d[e]);++e);let n="L"==(t?d[t-1]:h),i=n==("L"==(e<u?d[e]:h))?n?"L":"R":h;for(let n=t;n<e;++n)d[n]=i;t=e-1}let p,g=[];for(let t=0;t<u;)if(s.test(d[t])){let e=t;for(++t;t<u&&s.test(d[t]);++t);g.push(new l(0,e,t))}else{let e=t,n=g.length;for(++t;t<u&&"L"!=d[t];++t);for(let r=e;r<t;)if(o.test(d[r])){e<r&&g.splice(n,0,new l(1,e,r));let i=r;for(++r;r<t&&o.test(d[r]);++r);g.splice(n,0,new l(2,i,r)),e=r}else++r;e<t&&g.splice(n,0,new l(1,e,t))}return"ltr"==c&&(1==g[0].level&&(p=a.match(/^\s+/))&&(g[0].from=p[0].length,g.unshift(new l(0,0,p[0].length))),1==bn(g).level&&(p=a.match(/\s+$/))&&(bn(g).to-=p[0].length,g.push(new l(0,u-p[0].length,u)))),"rtl"==c?g.reverse():g}}();function In(t,e){let n=t.order;return null==n&&(n=t.order=Pn(t.text,e)),n}const zn=[];let Rn=function(t,e,n){if(t.addEventListener)t.addEventListener(e,n,!1);else if(t.attachEvent)t.attachEvent("on"+e,n);else{let r=t._handlers||(t._handlers={});r[e]=(r[e]||zn).concat(n)}};function Hn(t,e){return t._handlers&&t._handlers[e]||zn}function Fn(t,e,n){if(t.removeEventListener)t.removeEventListener(e,n,!1);else if(t.detachEvent)t.detachEvent("on"+e,n);else{let r=t._handlers,i=r&&r[e];if(i){let t=un(i,n);t>-1&&(r[e]=i.slice(0,t).concat(i.slice(t+1)))}}}function Wn(t,e){let n=Hn(t,e);if(!n.length)return;let r=Array.prototype.slice.call(arguments,2);for(let t=0;t<n.length;++t)n[t].apply(null,r)}function jn(t,e,n){return"string"==typeof e&&(e={type:e,preventDefault:function(){this.defaultPrevented=!0}}),Wn(t,n||e.type,t,e),Xn(e)||e.codemirrorIgnore}function Bn(t){let e=t._handlers&&t._handlers.cursorActivity;if(!e)return;let n=t.curOp.cursorActivityHandlers||(t.curOp.cursorActivityHandlers=[]);for(let t=0;t<e.length;++t)-1==un(n,e[t])&&n.push(e[t])}function Un(t,e){return Hn(t,e).length>0}function Vn(t){t.prototype.on=function(t,e){Rn(this,t,e)},t.prototype.off=function(t,e){Fn(this,t,e)}}function Gn(t){t.preventDefault?t.preventDefault():t.returnValue=!1}function qn(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function Xn(t){return null!=t.defaultPrevented?t.defaultPrevented:0==t.returnValue}function $n(t){Gn(t),qn(t)}function Yn(t){return t.target||t.srcElement}function Kn(t){let e=t.which;return null==e&&(1&t.button?e=1:2&t.button?e=3:4&t.button&&(e=2)),Be&&t.ctrlKey&&1==e&&(e=3),e}let Zn,Qn,Jn=function(){if(Ae&&_e<9)return!1;let t=Je("div");return"draggable"in t||"dragDrop"in t}();function tr(t){if(null==Zn){let e=Je("span","​");Qe(t,Je("span",[e,document.createTextNode("x")])),0!=t.firstChild.offsetHeight&&(Zn=e.offsetWidth<=1&&e.offsetHeight>2&&!(Ae&&_e<8))}let e=Zn?Je("span","​"):Je("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return e.setAttribute("cm-text",""),e}function er(t){if(null!=Qn)return Qn;let e=Qe(t,document.createTextNode("AخA")),n=Ye(e,0,1).getBoundingClientRect(),r=Ye(e,1,2).getBoundingClientRect();return Ze(t),!(!n||n.left==n.right)&&(Qn=r.right-n.right<3)}let nr=3!="\n\nb".split(/\n/).length?t=>{let e=0,n=[],r=t.length;for(;e<=r;){let r=t.indexOf("\n",e);-1==r&&(r=t.length);let i=t.slice(e,"\r"==t.charAt(r-1)?r-1:r),s=i.indexOf("\r");-1!=s?(n.push(i.slice(0,s)),e+=s+1):(n.push(i),e=r+1)}return n}:t=>t.split(/\r\n?|\n/),rr=window.getSelection?t=>{try{return t.selectionStart!=t.selectionEnd}catch(t){return!1}}:t=>{let e;try{e=t.ownerDocument.selection.createRange()}catch(t){}return!(!e||e.parentElement()!=t)&&0!=e.compareEndPoints("StartToEnd",e)},ir=(()=>{let t=Je("div");return"oncopy"in t||(t.setAttribute("oncopy","return;"),"function"==typeof t.oncopy)})(),sr=null;let or={},lr={};function ar(t,e){arguments.length>2&&(e.dependencies=Array.prototype.slice.call(arguments,2)),or[t]=e}function cr(t){if("string"==typeof t&&lr.hasOwnProperty(t))t=lr[t];else if(t&&"string"==typeof t.name&&lr.hasOwnProperty(t.name)){let e=lr[t.name];"string"==typeof e&&(e={name:e}),(t=Sn(e,t)).name=e.name}else{if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return cr("application/xml");if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+json$/.test(t))return cr("application/json")}return"string"==typeof t?{name:t}:t||{name:"null"}}function hr(t,e){e=cr(e);let n=or[e.name];if(!n)return hr(t,"text/plain");let r=n(t,e);if(ur.hasOwnProperty(e.name)){let t=ur[e.name];for(let e in t)t.hasOwnProperty(e)&&(r.hasOwnProperty(e)&&(r["_"+e]=r[e]),r[e]=t[e])}if(r.name=e.name,e.helperType&&(r.helperType=e.helperType),e.modeProps)for(let t in e.modeProps)r[t]=e.modeProps[t];return r}let ur={};function dr(t,e){an(e,ur.hasOwnProperty(t)?ur[t]:ur[t]={})}function fr(t,e){if(!0===e)return e;if(t.copyState)return t.copyState(e);let n={};for(let t in e){let r=e[t];r instanceof Array&&(r=r.concat([])),n[t]=r}return n}function pr(t,e){let n;for(;t.innerMode&&(n=t.innerMode(e))&&n.mode!=t;)e=n.state,t=n.mode;return n||{mode:t,state:e}}function gr(t,e,n){return!t.startState||t.startState(e,n)}class mr{constructor(t,e,n){this.pos=this.start=0,this.string=t,this.tabSize=e||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n}eol(){return this.pos>=this.string.length}sol(){return this.pos==this.lineStart}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(t){let e,n=this.string.charAt(this.pos);if(e="string"==typeof t?n==t:n&&(t.test?t.test(n):t(n)))return++this.pos,n}eatWhile(t){let e=this.pos;for(;this.eat(t););return this.pos>e}eatSpace(){let t=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>t}skipToEnd(){this.pos=this.string.length}skipTo(t){let e=this.string.indexOf(t,this.pos);if(e>-1)return this.pos=e,!0}backUp(t){this.pos-=t}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=cn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?cn(this.string,this.lineStart,this.tabSize):0)}indentation(){return cn(this.string,null,this.tabSize)-(this.lineStart?cn(this.string,this.lineStart,this.tabSize):0)}match(t,e,n){if("string"!=typeof t){let n=this.string.slice(this.pos).match(t);return n&&n.index>0?null:(n&&!1!==e&&(this.pos+=n[0].length),n)}{let r=t=>n?t.toLowerCase():t;if(r(this.string.substr(this.pos,t.length))==r(t))return!1!==e&&(this.pos+=t.length),!0}}current(){return this.string.slice(this.start,this.pos)}hideFirstChars(t,e){this.lineStart+=t;try{return e()}finally{this.lineStart-=t}}lookAhead(t){let e=this.lineOracle;return e&&e.lookAhead(t)}baseToken(){let t=this.lineOracle;return t&&t.baseToken(this.pos)}}function yr(t,e){if((e-=t.first)<0||e>=t.size)throw new Error("There is no line "+(e+t.first)+" in the document.");let n=t;for(;!n.lines;)for(let t=0;;++t){let r=n.children[t],i=r.chunkSize();if(e<i){n=r;break}e-=i}return n.lines[e]}function vr(t,e,n){let r=[],i=e.line;return t.iter(e.line,n.line+1,t=>{let s=t.text;i==n.line&&(s=s.slice(0,n.ch)),i==e.line&&(s=s.slice(e.ch)),r.push(s),++i}),r}function xr(t,e,n){let r=[];return t.iter(e,n,t=>{r.push(t.text)}),r}function br(t,e){let n=e-t.height;if(n)for(let e=t;e;e=e.parent)e.height+=n}function wr(t){if(null==t.parent)return null;let e=t.parent,n=un(e.lines,t);for(let t=e.parent;t;e=t,t=t.parent)for(let r=0;t.children[r]!=e;++r)n+=t.children[r].chunkSize();return n+e.first}function Cr(t,e){let n=t.first;t:do{for(let r=0;r<t.children.length;++r){let i=t.children[r],s=i.height;if(e<s){t=i;continue t}e-=s,n+=i.chunkSize()}return n}while(!t.lines);let r=0;for(;r<t.lines.length;++r){let n=t.lines[r].height;if(e<n)break;e-=n}return n+r}function Sr(t,e){return e>=t.first&&e<t.first+t.size}function Or(t,e){return String(t.lineNumberFormatter(e+t.firstLineNumber))}function Tr(t,e,n=null){if(!(this instanceof Tr))return new Tr(t,e,n);this.line=t,this.ch=e,this.sticky=n}function Mr(t,e){return t.line-e.line||t.ch-e.ch}function kr(t,e){return t.sticky==e.sticky&&0==Mr(t,e)}function Nr(t){return Tr(t.line,t.ch)}function Lr(t,e){return Mr(t,e)<0?e:t}function Ar(t,e){return Mr(t,e)<0?t:e}function _r(t,e){return Math.max(t.first,Math.min(e,t.first+t.size-1))}function Er(t,e){if(e.line<t.first)return Tr(t.first,0);let n=t.first+t.size-1;return e.line>n?Tr(n,yr(t,n).text.length):function(t,e){let n=t.ch;return null==n||n>e?Tr(t.line,e):n<0?Tr(t.line,0):t}(e,yr(t,e.line).text.length)}function Dr(t,e){let n=[];for(let r=0;r<e.length;r++)n[r]=Er(t,e[r]);return n}class Pr{constructor(t,e){this.state=t,this.lookAhead=e}}class Ir{constructor(t,e,n,r){this.state=e,this.doc=t,this.line=n,this.maxLookAhead=r||0,this.baseTokens=null,this.baseTokenPos=1}lookAhead(t){let e=this.doc.getLine(this.line+t);return null!=e&&t>this.maxLookAhead&&(this.maxLookAhead=t),e}baseToken(t){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=t;)this.baseTokenPos+=2;let e=this.baseTokens[this.baseTokenPos+1];return{type:e&&e.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-t}}nextLine(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--}static fromSaved(t,e,n){return e instanceof Pr?new Ir(t,fr(t.mode,e.state),n,e.lookAhead):new Ir(t,fr(t.mode,e),n)}save(t){let e=!1!==t?fr(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new Pr(e,this.maxLookAhead):e}}function zr(t,e,n,r){let i=[t.state.modeGen],s={};Gr(t,e.text,t.doc.mode,n,(t,e)=>i.push(t,e),s,r);let o=n.state;for(let r=0;r<t.state.overlays.length;++r){n.baseTokens=i;let l=t.state.overlays[r],a=1,c=0;n.state=!0,Gr(t,e.text,l.mode,n,(t,e)=>{let n=a;for(;c<t;){let e=i[a];e>t&&i.splice(a,1,t,i[a+1],e),a+=2,c=Math.min(t,e)}if(e)if(l.opaque)i.splice(n,a-n,t,"overlay "+e),a=n+2;else for(;n<a;n+=2){let t=i[n+1];i[n+1]=(t?t+" ":"")+"overlay "+e}},s),n.state=o,n.baseTokens=null,n.baseTokenPos=1}return{styles:i,classes:s.bgClass||s.textClass?s:null}}function Rr(t,e,n){if(!e.styles||e.styles[0]!=t.state.modeGen){let r=Hr(t,wr(e)),i=e.text.length>t.options.maxHighlightLength&&fr(t.doc.mode,r.state),s=zr(t,e,r);i&&(r.state=i),e.stateAfter=r.save(!i),e.styles=s.styles,s.classes?e.styleClasses=s.classes:e.styleClasses&&(e.styleClasses=null),n===t.doc.highlightFrontier&&(t.doc.modeFrontier=Math.max(t.doc.modeFrontier,++t.doc.highlightFrontier))}return e.styles}function Hr(t,e,n){let r=t.doc,i=t.display;if(!r.mode.startState)return new Ir(r,!0,e);let s=function(t,e,n){let r,i,s=t.doc,o=n?-1:e-(t.doc.mode.innerMode?1e3:100);for(let l=e;l>o;--l){if(l<=s.first)return s.first;let e=yr(s,l-1),o=e.stateAfter;if(o&&(!n||l+(o instanceof Pr?o.lookAhead:0)<=s.modeFrontier))return l;let a=cn(e.text,null,t.options.tabSize);(null==i||r>a)&&(i=l-1,r=a)}return i}(t,e,n),o=s>r.first&&yr(r,s-1).stateAfter,l=o?Ir.fromSaved(r,o,s):new Ir(r,gr(r.mode),s);return r.iter(s,e,n=>{Fr(t,n.text,l);let r=l.line;n.stateAfter=r==e-1||r%5==0||r>=i.viewFrom&&r<i.viewTo?l.save():null,l.nextLine()}),n&&(r.modeFrontier=l.line),l}function Fr(t,e,n,r){let i=t.doc.mode,s=new mr(e,t.options.tabSize,n);for(s.start=s.pos=r||0,""==e&&Wr(i,n.state);!s.eol();)jr(i,s,n.state),s.start=s.pos}function Wr(t,e){if(t.blankLine)return t.blankLine(e);if(!t.innerMode)return;let n=pr(t,e);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}function jr(t,e,n,r){for(let i=0;i<10;i++){r&&(r[0]=pr(t,n).mode);let i=t.token(e,n);if(e.pos>e.start)return i}throw new Error("Mode "+t.name+" failed to advance stream.")}class Br{constructor(t,e,n){this.start=t.start,this.end=t.pos,this.string=t.current(),this.type=e||null,this.state=n}}function Ur(t,e,n,r){let i,s,o=t.doc,l=o.mode,a=yr(o,(e=Er(o,e)).line),c=Hr(t,e.line,n),h=new mr(a.text,t.options.tabSize,c);for(r&&(s=[]);(r||h.pos<e.ch)&&!h.eol();)h.start=h.pos,i=jr(l,h,c.state),r&&s.push(new Br(h,i,fr(o.mode,c.state)));return r?s:new Br(h,i,c.state)}function Vr(t,e){if(t)for(;;){let n=t.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!n)break;t=t.slice(0,n.index)+t.slice(n.index+n[0].length);let r=n[1]?"bgClass":"textClass";null==e[r]?e[r]=n[2]:new RegExp("(?:^|s)"+n[2]+"(?:$|s)").test(e[r])||(e[r]+=" "+n[2])}return t}function Gr(t,e,n,r,i,s,o){let l=n.flattenSpans;null==l&&(l=t.options.flattenSpans);let a,c=0,h=null,u=new mr(e,t.options.tabSize,r),d=t.options.addModeClass&&[null];for(""==e&&Vr(Wr(n,r.state),s);!u.eol();){if(u.pos>t.options.maxHighlightLength?(l=!1,o&&Fr(t,e,r,u.pos),u.pos=e.length,a=null):a=Vr(jr(n,u,r.state,d),s),d){let t=d[0].name;t&&(a="m-"+(a?t+" "+a:t))}if(!l||h!=a){for(;c<u.start;)i(c=Math.min(u.start,c+5e3),h);h=a}u.start=u.pos}for(;c<u.pos;){let t=Math.min(u.pos,c+5e3);i(t,h),c=t}}let qr=!1,Xr=!1;function $r(t,e,n){this.marker=t,this.from=e,this.to=n}function Yr(t,e){if(t)for(let n=0;n<t.length;++n){let r=t[n];if(r.marker==e)return r}}function Kr(t,e){let n;for(let r=0;r<t.length;++r)t[r]!=e&&(n||(n=[])).push(t[r]);return n}function Zr(t,e){if(e.full)return null;let n=Sr(t,e.from.line)&&yr(t,e.from.line).markedSpans,r=Sr(t,e.to.line)&&yr(t,e.to.line).markedSpans;if(!n&&!r)return null;let i=e.from.ch,s=e.to.ch,o=0==Mr(e.from,e.to),l=function(t,e,n){let r;if(t)for(let i=0;i<t.length;++i){let s=t[i],o=s.marker;if(null==s.from||(o.inclusiveLeft?s.from<=e:s.from<e)||s.from==e&&"bookmark"==o.type&&(!n||!s.marker.insertLeft)){let t=null==s.to||(o.inclusiveRight?s.to>=e:s.to>e);(r||(r=[])).push(new $r(o,s.from,t?null:s.to))}}return r}(n,i,o),a=function(t,e,n){let r;if(t)for(let i=0;i<t.length;++i){let s=t[i],o=s.marker;if(null==s.to||(o.inclusiveRight?s.to>=e:s.to>e)||s.from==e&&"bookmark"==o.type&&(!n||s.marker.insertLeft)){let t=null==s.from||(o.inclusiveLeft?s.from<=e:s.from<e);(r||(r=[])).push(new $r(o,t?null:s.from-e,null==s.to?null:s.to-e))}}return r}(r,s,o),c=1==e.text.length,h=bn(e.text).length+(c?i:0);if(l)for(let t=0;t<l.length;++t){let e=l[t];if(null==e.to){let t=Yr(a,e.marker);t?c&&(e.to=null==t.to?null:t.to+h):e.to=i}}if(a)for(let t=0;t<a.length;++t){let e=a[t];if(null!=e.to&&(e.to+=h),null==e.from){Yr(l,e.marker)||(e.from=h,c&&(l||(l=[])).push(e))}else e.from+=h,c&&(l||(l=[])).push(e)}l&&(l=Qr(l)),a&&a!=l&&(a=Qr(a));let u=[l];if(!c){let t,n=e.text.length-2;if(n>0&&l)for(let e=0;e<l.length;++e)null==l[e].to&&(t||(t=[])).push(new $r(l[e].marker,null,null));for(let e=0;e<n;++e)u.push(t);u.push(a)}return u}function Qr(t){for(let e=0;e<t.length;++e){let n=t[e];null!=n.from&&n.from==n.to&&!1!==n.marker.clearWhenEmpty&&t.splice(e--,1)}return t.length?t:null}function Jr(t){let e=t.markedSpans;if(e){for(let n=0;n<e.length;++n)e[n].marker.detachLine(t);t.markedSpans=null}}function ti(t,e){if(e){for(let n=0;n<e.length;++n)e[n].marker.attachLine(t);t.markedSpans=e}}function ei(t){return t.inclusiveLeft?-1:0}function ni(t){return t.inclusiveRight?1:0}function ri(t,e){let n=t.lines.length-e.lines.length;if(0!=n)return n;let r=t.find(),i=e.find(),s=Mr(r.from,i.from)||ei(t)-ei(e);if(s)return-s;let o=Mr(r.to,i.to)||ni(t)-ni(e);return o||e.id-t.id}function ii(t,e){let n,r=Xr&&t.markedSpans;if(r)for(let t,i=0;i<r.length;++i)(t=r[i]).marker.collapsed&&null==(e?t.from:t.to)&&(!n||ri(n,t.marker)<0)&&(n=t.marker);return n}function si(t){return ii(t,!0)}function oi(t){return ii(t,!1)}function li(t,e){let n,r=Xr&&t.markedSpans;if(r)for(let t=0;t<r.length;++t){let i=r[t];i.marker.collapsed&&(null==i.from||i.from<e)&&(null==i.to||i.to>e)&&(!n||ri(n,i.marker)<0)&&(n=i.marker)}return n}function ai(t,e,n,r,i){let s=yr(t,e),o=Xr&&s.markedSpans;if(o)for(let t=0;t<o.length;++t){let e=o[t];if(!e.marker.collapsed)continue;let s=e.marker.find(0),l=Mr(s.from,n)||ei(e.marker)-ei(i),a=Mr(s.to,r)||ni(e.marker)-ni(i);if(!(l>=0&&a<=0||l<=0&&a>=0)&&(l<=0&&(e.marker.inclusiveRight&&i.inclusiveLeft?Mr(s.to,n)>=0:Mr(s.to,n)>0)||l>=0&&(e.marker.inclusiveRight&&i.inclusiveLeft?Mr(s.from,r)<=0:Mr(s.from,r)<0)))return!0}}function ci(t){let e;for(;e=si(t);)t=e.find(-1,!0).line;return t}function hi(t,e){let n=yr(t,e),r=ci(n);return n==r?e:wr(r)}function ui(t,e){if(e>t.lastLine())return e;let n,r=yr(t,e);if(!di(t,r))return e;for(;n=oi(r);)r=n.find(1,!0).line;return wr(r)+1}function di(t,e){let n=Xr&&e.markedSpans;if(n)for(let r,i=0;i<n.length;++i)if((r=n[i]).marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&fi(t,e,r))return!0}}function fi(t,e,n){if(null==n.to){let e=n.marker.find(1,!0);return fi(t,e.line,Yr(e.line.markedSpans,n.marker))}if(n.marker.inclusiveRight&&n.to==e.text.length)return!0;for(let r,i=0;i<e.markedSpans.length;++i)if((r=e.markedSpans[i]).marker.collapsed&&!r.marker.widgetNode&&r.from==n.to&&(null==r.to||r.to!=n.from)&&(r.marker.inclusiveLeft||n.marker.inclusiveRight)&&fi(t,e,r))return!0}function pi(t){let e=0,n=(t=ci(t)).parent;for(let r=0;r<n.lines.length;++r){let i=n.lines[r];if(i==t)break;e+=i.height}for(let t=n.parent;t;t=(n=t).parent)for(let r=0;r<t.children.length;++r){let i=t.children[r];if(i==n)break;e+=i.height}return e}function gi(t){if(0==t.height)return 0;let e,n=t.text.length,r=t;for(;e=si(r);){let t=e.find(0,!0);r=t.from.line,n+=t.from.ch-t.to.ch}for(r=t;e=oi(r);){let t=e.find(0,!0);n-=r.text.length-t.from.ch,n+=(r=t.to.line).text.length-t.to.ch}return n}function mi(t){let e=t.display,n=t.doc;e.maxLine=yr(n,n.first),e.maxLineLength=gi(e.maxLine),e.maxLineChanged=!0,n.iter(t=>{let n=gi(t);n>e.maxLineLength&&(e.maxLineLength=n,e.maxLine=t)})}class yi{constructor(t,e,n){this.text=t,ti(this,e),this.height=n?n(this):1}lineNo(){return wr(this)}}function vi(t){t.parent=null,Jr(t)}Vn(yi);let xi={},bi={};function wi(t,e){if(!t||/^\s*$/.test(t))return null;let n=e.addModeClass?bi:xi;return n[t]||(n[t]=t.replace(/\S+/g,"cm-$&"))}function Ci(t,e){let n=tn("span",null,null,Ee?"padding-right: .1px":null),r={pre:tn("pre",[n],"CodeMirror-line"),content:n,col:0,pos:0,cm:t,trailingSpace:!1,splitSpaces:t.getOption("lineWrapping")};e.measure={};for(let n=0;n<=(e.rest?e.rest.length:0);n++){let i,s=n?e.rest[n-1]:e.line;r.pos=0,r.addToken=Oi,er(t.display.measure)&&(i=In(s,t.doc.direction))&&(r.addToken=Ti(r.addToken,i)),r.map=[],ki(s,r,Rr(t,s,e!=t.display.externalMeasured&&wr(s))),s.styleClasses&&(s.styleClasses.bgClass&&(r.bgClass=sn(s.styleClasses.bgClass,r.bgClass||"")),s.styleClasses.textClass&&(r.textClass=sn(s.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(tr(t.display.measure))),0==n?(e.measure.map=r.map,e.measure.cache={}):((e.measure.maps||(e.measure.maps=[])).push(r.map),(e.measure.caches||(e.measure.caches=[])).push({}))}if(Ee){let t=r.content.lastChild;(/\bcm-tab\b/.test(t.className)||t.querySelector&&t.querySelector(".cm-tab"))&&(r.content.className="cm-tab-wrap-hack")}return Wn(t,"renderLine",t,e.line,r.pre),r.pre.className&&(r.textClass=sn(r.pre.className,r.textClass||"")),r}function Si(t){let e=Je("span","•","cm-invalidchar");return e.title="\\u"+t.charCodeAt(0).toString(16),e.setAttribute("aria-label",e.title),e}function Oi(t,e,n,r,i,s,o){if(!e)return;let l,a=t.splitSpaces?function(t,e){if(t.length>1&&!/  /.test(t))return t;let n=e,r="";for(let e=0;e<t.length;e++){let i=t.charAt(e);" "!=i||!n||e!=t.length-1&&32!=t.charCodeAt(e+1)||(i=" "),r+=i,n=" "==i}return r}(e,t.trailingSpace):e,c=t.cm.state.specialChars,h=!1;if(c.test(e)){l=document.createDocumentFragment();let n=0;for(;;){c.lastIndex=n;let r,i=c.exec(e),s=i?i.index-n:e.length-n;if(s){let e=document.createTextNode(a.slice(n,n+s));Ae&&_e<9?l.appendChild(Je("span",[e])):l.appendChild(e),t.map.push(t.pos,t.pos+s,e),t.col+=s,t.pos+=s}if(!i)break;if(n+=s+1,"\t"==i[0]){let e=t.cm.options.tabSize,n=e-t.col%e;(r=l.appendChild(Je("span",xn(n),"cm-tab"))).setAttribute("role","presentation"),r.setAttribute("cm-text","\t"),t.col+=n}else"\r"==i[0]||"\n"==i[0]?((r=l.appendChild(Je("span","\r"==i[0]?"␍":"␤","cm-invalidchar"))).setAttribute("cm-text",i[0]),t.col+=1):((r=t.cm.options.specialCharPlaceholder(i[0])).setAttribute("cm-text",i[0]),Ae&&_e<9?l.appendChild(Je("span",[r])):l.appendChild(r),t.col+=1);t.map.push(t.pos,t.pos+1,r),t.pos++}}else t.col+=e.length,l=document.createTextNode(a),t.map.push(t.pos,t.pos+e.length,l),Ae&&_e<9&&(h=!0),t.pos+=e.length;if(t.trailingSpace=32==a.charCodeAt(e.length-1),n||r||i||h||s){let e=n||"";r&&(e+=r),i&&(e+=i);let a=Je("span",[l],e,s);if(o)for(let t in o)o.hasOwnProperty(t)&&"style"!=t&&"class"!=t&&a.setAttribute(t,o[t]);return t.content.appendChild(a)}t.content.appendChild(l)}function Ti(t,e){return(n,r,i,s,o,l,a)=>{i=i?i+" cm-force-border":"cm-force-border";let c=n.pos,h=c+r.length;for(;;){let u;for(let t=0;t<e.length&&!((u=e[t]).to>c&&u.from<=c);t++);if(u.to>=h)return t(n,r,i,s,o,l,a);t(n,r.slice(0,u.to-c),i,s,null,l,a),s=null,r=r.slice(u.to-c),c=u.to}}}function Mi(t,e,n,r){let i=!r&&n.widgetNode;i&&t.map.push(t.pos,t.pos+e,i),!r&&t.cm.display.input.needsContentAttribute&&(i||(i=t.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",n.id)),i&&(t.cm.display.input.setUneditable(i),t.content.appendChild(i)),t.pos+=e,t.trailingSpace=!1}function ki(t,e,n){let r=t.markedSpans,i=t.text,s=0;if(!r){for(let t=1;t<n.length;t+=2)e.addToken(e,i.slice(s,s=n[t]),wi(n[t+1],e.cm.options));return}let o,l,a,c,h,u,d,f=i.length,p=0,g=1,m="",y=0;for(;;){if(y==p){a=c=h=l="",d=null,u=null,y=1/0;let t,n=[];for(let e=0;e<r.length;++e){let i=r[e],s=i.marker;if("bookmark"==s.type&&i.from==p&&s.widgetNode)n.push(s);else if(i.from<=p&&(null==i.to||i.to>p||s.collapsed&&i.to==p&&i.from==p)){if(null!=i.to&&i.to!=p&&y>i.to&&(y=i.to,c=""),s.className&&(a+=" "+s.className),s.css&&(l=(l?l+";":"")+s.css),s.startStyle&&i.from==p&&(h+=" "+s.startStyle),s.endStyle&&i.to==y&&(t||(t=[])).push(s.endStyle,i.to),s.title&&((d||(d={})).title=s.title),s.attributes)for(let t in s.attributes)(d||(d={}))[t]=s.attributes[t];s.collapsed&&(!u||ri(u.marker,s)<0)&&(u=i)}else i.from>p&&y>i.from&&(y=i.from)}if(t)for(let e=0;e<t.length;e+=2)t[e+1]==y&&(c+=" "+t[e]);if(!u||u.from==p)for(let t=0;t<n.length;++t)Mi(e,0,n[t]);if(u&&(u.from||0)==p){if(Mi(e,(null==u.to?f+1:u.to)-p,u.marker,null==u.from),null==u.to)return;u.to==p&&(u=!1)}}if(p>=f)break;let t=Math.min(f,y);for(;;){if(m){let n=p+m.length;if(!u){let r=n>t?m.slice(0,t-p):m;e.addToken(e,r,o?o+a:a,h,p+r.length==y?c:"",l,d)}if(n>=t){m=m.slice(t-p),p=t;break}p=n,h=""}m=i.slice(s,s=n[g++]),o=wi(n[g++],e.cm.options)}}}function Ni(t,e,n){this.line=e,this.rest=function(t){let e,n;for(;e=oi(t);)t=e.find(1,!0).line,(n||(n=[])).push(t);return n}(e),this.size=this.rest?wr(bn(this.rest))-n+1:1,this.node=this.text=null,this.hidden=di(t,e)}function Li(t,e,n){let r,i=[];for(let s=e;s<n;s=r){let e=new Ni(t.doc,yr(t.doc,s),s);r=s+e.size,i.push(e)}return i}let Ai=null;let _i=null;function Ei(t,e){let n=Hn(t,e);if(!n.length)return;let r,i=Array.prototype.slice.call(arguments,2);Ai?r=Ai.delayedCallbacks:_i?r=_i:(r=_i=[],setTimeout(Di,0));for(let t=0;t<n.length;++t)r.push(()=>n[t].apply(null,i))}function Di(){let t=_i;_i=null;for(let e=0;e<t.length;++e)t[e]()}function Pi(t,e,n,r){for(let i=0;i<e.changes.length;i++){let s=e.changes[i];"text"==s?Ri(t,e):"gutter"==s?Fi(t,e,n,r):"class"==s?Hi(t,e):"widget"==s&&Wi(t,e,r)}e.changes=null}function Ii(t){return t.node==t.text&&(t.node=Je("div",null,null,"position: relative"),t.text.parentNode&&t.text.parentNode.replaceChild(t.node,t.text),t.node.appendChild(t.text),Ae&&_e<8&&(t.node.style.zIndex=2)),t.node}function zi(t,e){let n=t.display.externalMeasured;return n&&n.line==e.line?(t.display.externalMeasured=null,e.measure=n.measure,n.built):Ci(t,e)}function Ri(t,e){let n=e.text.className,r=zi(t,e);e.text==e.node&&(e.node=r.pre),e.text.parentNode.replaceChild(r.pre,e.text),e.text=r.pre,r.bgClass!=e.bgClass||r.textClass!=e.textClass?(e.bgClass=r.bgClass,e.textClass=r.textClass,Hi(t,e)):n&&(e.text.className=n)}function Hi(t,e){!function(t,e){let n=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(n&&(n+=" CodeMirror-linebackground"),e.background)n?e.background.className=n:(e.background.parentNode.removeChild(e.background),e.background=null);else if(n){let r=Ii(e);e.background=r.insertBefore(Je("div",null,n),r.firstChild),t.display.input.setUneditable(e.background)}}(t,e),e.line.wrapClass?Ii(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");let n=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=n||""}function Fi(t,e,n,r){if(e.gutter&&(e.node.removeChild(e.gutter),e.gutter=null),e.gutterBackground&&(e.node.removeChild(e.gutterBackground),e.gutterBackground=null),e.line.gutterClass){let n=Ii(e);e.gutterBackground=Je("div",null,"CodeMirror-gutter-background "+e.line.gutterClass,`left: ${t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth}px; width: ${r.gutterTotalWidth}px`),t.display.input.setUneditable(e.gutterBackground),n.insertBefore(e.gutterBackground,e.text)}let i=e.line.gutterMarkers;if(t.options.lineNumbers||i){let s=Ii(e),o=e.gutter=Je("div",null,"CodeMirror-gutter-wrapper",`left: ${t.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth}px`);if(t.display.input.setUneditable(o),s.insertBefore(o,e.text),e.line.gutterClass&&(o.className+=" "+e.line.gutterClass),!t.options.lineNumbers||i&&i["CodeMirror-linenumbers"]||(e.lineNumber=o.appendChild(Je("div",Or(t.options,n),"CodeMirror-linenumber CodeMirror-gutter-elt",`left: ${r.gutterLeft["CodeMirror-linenumbers"]}px; width: ${t.display.lineNumInnerWidth}px`))),i)for(let e=0;e<t.display.gutterSpecs.length;++e){let n=t.display.gutterSpecs[e].className,s=i.hasOwnProperty(n)&&i[n];s&&o.appendChild(Je("div",[s],"CodeMirror-gutter-elt",`left: ${r.gutterLeft[n]}px; width: ${r.gutterWidth[n]}px`))}}}function Wi(t,e,n){e.alignable&&(e.alignable=null);for(let t,n=e.node.firstChild;n;n=t)t=n.nextSibling,"CodeMirror-linewidget"==n.className&&e.node.removeChild(n);Bi(t,e,n)}function ji(t,e,n,r){let i=zi(t,e);return e.text=e.node=i.pre,i.bgClass&&(e.bgClass=i.bgClass),i.textClass&&(e.textClass=i.textClass),Hi(t,e),Fi(t,e,n,r),Bi(t,e,r),e.node}function Bi(t,e,n){if(Ui(t,e.line,e,n,!0),e.rest)for(let r=0;r<e.rest.length;r++)Ui(t,e.rest[r],e,n,!1)}function Ui(t,e,n,r,i){if(!e.widgets)return;let s=Ii(n);for(let o=0,l=e.widgets;o<l.length;++o){let e=l[o],a=Je("div",[e.node],"CodeMirror-linewidget");e.handleMouseEvents||a.setAttribute("cm-ignore-events","true"),Vi(e,a,n,r),t.display.input.setUneditable(a),i&&e.above?s.insertBefore(a,n.gutter||n.text):s.appendChild(a),Ei(e,"redraw")}}function Vi(t,e,n,r){if(t.noHScroll){(n.alignable||(n.alignable=[])).push(e);let i=r.wrapperWidth;e.style.left=r.fixedPos+"px",t.coverGutter||(i-=r.gutterTotalWidth,e.style.paddingLeft=r.gutterTotalWidth+"px"),e.style.width=i+"px"}t.coverGutter&&(e.style.zIndex=5,e.style.position="relative",t.noHScroll||(e.style.marginLeft=-r.gutterTotalWidth+"px"))}function Gi(t){if(null!=t.height)return t.height;let e=t.doc.cm;if(!e)return 0;if(!en(document.body,t.node)){let n="position: relative;";t.coverGutter&&(n+="margin-left: -"+e.display.gutters.offsetWidth+"px;"),t.noHScroll&&(n+="width: "+e.display.wrapper.clientWidth+"px;"),Qe(e.display.measure,Je("div",[t.node],null,n))}return t.height=t.node.parentNode.offsetHeight}function qi(t,e){for(let n=Yn(e);n!=t.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==t.sizer&&n!=t.mover)return!0}function Xi(t){return t.lineSpace.offsetTop}function $i(t){return t.mover.offsetHeight-t.lineSpace.offsetHeight}function Yi(t){if(t.cachedPaddingH)return t.cachedPaddingH;let e=Qe(t.measure,Je("pre","x")),n=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,r={left:parseInt(n.paddingLeft),right:parseInt(n.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(t.cachedPaddingH=r),r}function Ki(t){return dn-t.display.nativeBarWidth}function Zi(t){return t.display.scroller.clientWidth-Ki(t)-t.display.barWidth}function Qi(t){return t.display.scroller.clientHeight-Ki(t)-t.display.barHeight}function Ji(t,e,n){if(t.line==e)return{map:t.measure.map,cache:t.measure.cache};for(let n=0;n<t.rest.length;n++)if(t.rest[n]==e)return{map:t.measure.maps[n],cache:t.measure.caches[n]};for(let e=0;e<t.rest.length;e++)if(wr(t.rest[e])>n)return{map:t.measure.maps[e],cache:t.measure.caches[e],before:!0}}function ts(t,e,n,r){return rs(t,ns(t,e),n,r)}function es(t,e){if(e>=t.display.viewFrom&&e<t.display.viewTo)return t.display.view[Ps(t,e)];let n=t.display.externalMeasured;return n&&e>=n.lineN&&e<n.lineN+n.size?n:void 0}function ns(t,e){let n=wr(e),r=es(t,n);r&&!r.text?r=null:r&&r.changes&&(Pi(t,r,n,Ls(t)),t.curOp.forceUpdate=!0),r||(r=function(t,e){let n=wr(e=ci(e)),r=t.display.externalMeasured=new Ni(t.doc,e,n);r.lineN=n;let i=r.built=Ci(t,r);return r.text=i.pre,Qe(t.display.lineMeasure,i.pre),r}(t,e));let i=Ji(r,e,n);return{line:e,view:r,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function rs(t,e,n,r,i){e.before&&(n=-1);let s,o=n+(r||"");return e.cache.hasOwnProperty(o)?s=e.cache[o]:(e.rect||(e.rect=e.view.text.getBoundingClientRect()),e.hasHeights||(!function(t,e,n){let r=t.options.lineWrapping,i=r&&Zi(t);if(!e.measure.heights||r&&e.measure.width!=i){let t=e.measure.heights=[];if(r){e.measure.width=i;let r=e.text.firstChild.getClientRects();for(let e=0;e<r.length-1;e++){let i=r[e],s=r[e+1];Math.abs(i.bottom-s.bottom)>2&&t.push((i.bottom+s.top)/2-n.top)}}t.push(n.bottom-n.top)}}(t,e.view,e.rect),e.hasHeights=!0),(s=function(t,e,n,r){let i,s=os(e.map,n,r),o=s.node,l=s.start,a=s.end,c=s.collapse;if(3==o.nodeType){for(let t=0;t<4;t++){for(;l&&Ln(e.line.text.charAt(s.coverStart+l));)--l;for(;s.coverStart+a<s.coverEnd&&Ln(e.line.text.charAt(s.coverStart+a));)++a;if((i=Ae&&_e<9&&0==l&&a==s.coverEnd-s.coverStart?o.parentNode.getBoundingClientRect():ls(Ye(o,l,a).getClientRects(),r)).left||i.right||0==l)break;a=l,l-=1,c="right"}Ae&&_e<11&&(i=function(t,e){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!function(t){if(null!=sr)return sr;let e=Qe(t,Je("span","x")),n=e.getBoundingClientRect(),r=Ye(e,0,1).getBoundingClientRect();return sr=Math.abs(n.left-r.left)>1}(t))return e;let n=screen.logicalXDPI/screen.deviceXDPI,r=screen.logicalYDPI/screen.deviceYDPI;return{left:e.left*n,right:e.right*n,top:e.top*r,bottom:e.bottom*r}}(t.display.measure,i))}else{let e;l>0&&(c=r="right"),i=t.options.lineWrapping&&(e=o.getClientRects()).length>1?e["right"==r?e.length-1:0]:o.getBoundingClientRect()}if(Ae&&_e<9&&!l&&(!i||!i.left&&!i.right)){let e=o.parentNode.getClientRects()[0];i=e?{left:e.left,right:e.left+Ns(t.display),top:e.top,bottom:e.bottom}:ss}let h=i.top-e.rect.top,u=i.bottom-e.rect.top,d=(h+u)/2,f=e.view.measure.heights,p=0;for(;p<f.length-1&&!(d<f[p]);p++);let g=p?f[p-1]:0,m=f[p],y={left:("right"==c?i.right:i.left)-e.rect.left,right:("left"==c?i.left:i.right)-e.rect.left,top:g,bottom:m};i.left||i.right||(y.bogus=!0);t.options.singleCursorHeightPerLine||(y.rtop=h,y.rbottom=u);return y}(t,e,n,r)).bogus||(e.cache[o]=s)),{left:s.left,right:s.right,top:i?s.rtop:s.top,bottom:i?s.rbottom:s.bottom}}let is,ss={left:0,right:0,top:0,bottom:0};function os(t,e,n){let r,i,s,o,l,a;for(let c=0;c<t.length;c+=3)if(l=t[c],a=t[c+1],e<l?(i=0,s=1,o="left"):e<a?s=(i=e-l)+1:(c==t.length-3||e==a&&t[c+3]>e)&&(i=(s=a-l)-1,e>=a&&(o="right")),null!=i){if(r=t[c+2],l==a&&n==(r.insertLeft?"left":"right")&&(o=n),"left"==n&&0==i)for(;c&&t[c-2]==t[c-3]&&t[c-1].insertLeft;)r=t[2+(c-=3)],o="left";if("right"==n&&i==a-l)for(;c<t.length-3&&t[c+3]==t[c+4]&&!t[c+5].insertLeft;)r=t[(c+=3)+2],o="right";break}return{node:r,start:i,end:s,collapse:o,coverStart:l,coverEnd:a}}function ls(t,e){let n=ss;if("left"==e)for(let e=0;e<t.length&&(n=t[e]).left==n.right;e++);else for(let e=t.length-1;e>=0&&(n=t[e]).left==n.right;e--);return n}function as(t){if(t.measure&&(t.measure.cache={},t.measure.heights=null,t.rest))for(let e=0;e<t.rest.length;e++)t.measure.caches[e]={}}function cs(t){t.display.externalMeasure=null,Ze(t.display.lineMeasure);for(let e=0;e<t.display.view.length;e++)as(t.display.view[e])}function hs(t){cs(t),t.display.cachedCharWidth=t.display.cachedTextHeight=t.display.cachedPaddingH=null,t.options.lineWrapping||(t.display.maxLineChanged=!0),t.display.lineNumChars=null}function us(){return Pe&&We?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function ds(){return Pe&&We?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function fs(t){let e=0;if(t.widgets)for(let n=0;n<t.widgets.length;++n)t.widgets[n].above&&(e+=Gi(t.widgets[n]));return e}function ps(t,e,n,r,i){if(!i){let t=fs(e);n.top+=t,n.bottom+=t}if("line"==r)return n;r||(r="local");let s=pi(e);if("local"==r?s+=Xi(t.display):s-=t.display.viewOffset,"page"==r||"window"==r){let e=t.display.lineSpace.getBoundingClientRect();s+=e.top+("window"==r?0:ds());let i=e.left+("window"==r?0:us());n.left+=i,n.right+=i}return n.top+=s,n.bottom+=s,n}function gs(t,e,n){if("div"==n)return e;let r=e.left,i=e.top;if("page"==n)r-=us(),i-=ds();else if("local"==n||!n){let e=t.display.sizer.getBoundingClientRect();r+=e.left,i+=e.top}let s=t.display.lineSpace.getBoundingClientRect();return{left:r-s.left,top:i-s.top}}function ms(t,e,n,r,i){return r||(r=yr(t.doc,e.line)),ps(t,r,ts(t,r,e.ch,i),n)}function ys(t,e,n,r,i,s){function o(e,o){let l=rs(t,i,e,o?"right":"left",s);return o?l.left=l.right:l.right=l.left,ps(t,r,l,n)}r=r||yr(t.doc,e.line),i||(i=ns(t,r));let l=In(r,t.doc.direction),a=e.ch,c=e.sticky;if(a>=r.text.length?(a=r.text.length,c="before"):a<=0&&(a=0,c="after"),!l)return o("before"==c?a-1:a,"before"==c);function h(t,e,n){return o(n?t-1:t,1==l[e].level!=n)}let u=Dn(l,a,c),d=En,f=h(a,u,"before"==c);return null!=d&&(f.other=h(a,d,"before"!=c)),f}function vs(t,e){let n=0;e=Er(t.doc,e),t.options.lineWrapping||(n=Ns(t.display)*e.ch);let r=yr(t.doc,e.line),i=pi(r)+Xi(t.display);return{left:n,right:n,top:i,bottom:i+r.height}}function xs(t,e,n,r,i){let s=Tr(t,e,n);return s.xRel=i,r&&(s.outside=!0),s}function bs(t,e,n){let r=t.doc;if((n+=t.display.viewOffset)<0)return xs(r.first,0,null,!0,-1);let i=Cr(r,n),s=r.first+r.size-1;if(i>s)return xs(r.first+r.size-1,yr(r,s).text.length,null,!0,1);e<0&&(e=0);let o=yr(r,i);for(;;){let s=Os(t,o,i,e,n),l=li(o,s.ch+(s.xRel>0?1:0));if(!l)return s;let a=l.find(1);if(a.line==i)return a;o=yr(r,i=a.line)}}function ws(t,e,n,r){r-=fs(e);let i=e.text.length,s=_n(e=>rs(t,n,e-1).bottom<=r,i,0);return{begin:s,end:i=_n(e=>rs(t,n,e).top>r,s,i)}}function Cs(t,e,n,r){return n||(n=ns(t,e)),ws(t,e,n,ps(t,e,rs(t,n,r),"line").top)}function Ss(t,e,n,r){return!(t.bottom<=n)&&(t.top>n||(r?t.left:t.right)>e)}function Os(t,e,n,r,i){i-=pi(e);let s=ns(t,e),o=fs(e),l=0,a=e.text.length,c=!0,h=In(e,t.doc.direction);if(h){let o=(t.options.lineWrapping?Ms:Ts)(t,e,n,s,h,r,i);l=(c=1!=o.level)?o.from:o.to-1,a=c?o.to:o.from-1}let u,d,f=null,p=null,g=_n(e=>{let n=rs(t,s,e);return n.top+=o,n.bottom+=o,!!Ss(n,r,i,!1)&&(n.top<=i&&n.left<=r&&(f=e,p=n),!0)},l,a),m=!1;if(p){let t=r-p.left<p.right-r,e=t==c;g=f+(e?0:1),d=e?"after":"before",u=t?p.left:p.right}else{c||g!=a&&g!=l||g++,d=0==g?"after":g==e.text.length?"before":rs(t,s,g-(c?1:0)).bottom+o<=i==c?"after":"before";let r=ys(t,Tr(n,g,d),"line",e,s);u=r.left,m=i<r.top||i>=r.bottom}return xs(n,g=An(e.text,g,1),d,m,r-u)}function Ts(t,e,n,r,i,s,o){let l=_n(l=>{let a=i[l],c=1!=a.level;return Ss(ys(t,Tr(n,c?a.to:a.from,c?"before":"after"),"line",e,r),s,o,!0)},0,i.length-1),a=i[l];if(l>0){let c=1!=a.level,h=ys(t,Tr(n,c?a.from:a.to,c?"after":"before"),"line",e,r);Ss(h,s,o,!0)&&h.top>o&&(a=i[l-1])}return a}function Ms(t,e,n,r,i,s,o){let{begin:l,end:a}=ws(t,e,r,o);/\s/.test(e.text.charAt(a-1))&&a--;let c=null,h=null;for(let e=0;e<i.length;e++){let n=i[e];if(n.from>=a||n.to<=l)continue;let o=rs(t,r,1!=n.level?Math.min(a,n.to)-1:Math.max(l,n.from)).right,u=o<s?s-o+1e9:o-s;(!c||h>u)&&(c=n,h=u)}return c||(c=i[i.length-1]),c.from<l&&(c={from:l,to:c.to,level:c.level}),c.to>a&&(c={from:c.from,to:a,level:c.level}),c}function ks(t){if(null!=t.cachedTextHeight)return t.cachedTextHeight;if(null==is){is=Je("pre");for(let t=0;t<49;++t)is.appendChild(document.createTextNode("x")),is.appendChild(Je("br"));is.appendChild(document.createTextNode("x"))}Qe(t.measure,is);let e=is.offsetHeight/50;return e>3&&(t.cachedTextHeight=e),Ze(t.measure),e||1}function Ns(t){if(null!=t.cachedCharWidth)return t.cachedCharWidth;let e=Je("span","xxxxxxxxxx"),n=Je("pre",[e]);Qe(t.measure,n);let r=e.getBoundingClientRect(),i=(r.right-r.left)/10;return i>2&&(t.cachedCharWidth=i),i||10}function Ls(t){let e=t.display,n={},r={},i=e.gutters.clientLeft;for(let s=e.gutters.firstChild,o=0;s;s=s.nextSibling,++o){let e=t.display.gutterSpecs[o].className;n[e]=s.offsetLeft+s.clientLeft+i,r[e]=s.clientWidth}return{fixedPos:As(e),gutterTotalWidth:e.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:e.wrapper.clientWidth}}function As(t){return t.scroller.getBoundingClientRect().left-t.sizer.getBoundingClientRect().left}function _s(t){let e=ks(t.display),n=t.options.lineWrapping,r=n&&Math.max(5,t.display.scroller.clientWidth/Ns(t.display)-3);return i=>{if(di(t.doc,i))return 0;let s=0;if(i.widgets)for(let t=0;t<i.widgets.length;t++)i.widgets[t].height&&(s+=i.widgets[t].height);return n?s+(Math.ceil(i.text.length/r)||1)*e:s+e}}function Es(t){let e=t.doc,n=_s(t);e.iter(t=>{let e=n(t);e!=t.height&&br(t,e)})}function Ds(t,e,n,r){let i=t.display;if(!n&&"true"==Yn(e).getAttribute("cm-not-content"))return null;let s,o,l=i.lineSpace.getBoundingClientRect();try{s=e.clientX-l.left,o=e.clientY-l.top}catch(e){return null}let a,c=bs(t,s,o);if(r&&1==c.xRel&&(a=yr(t.doc,c.line).text).length==c.ch){let e=cn(a,a.length,t.options.tabSize)-a.length;c=Tr(c.line,Math.max(0,Math.round((s-Yi(t.display).left)/Ns(t.display))-e))}return c}function Ps(t,e){if(e>=t.display.viewTo)return null;if((e-=t.display.viewFrom)<0)return null;let n=t.display.view;for(let t=0;t<n.length;t++)if((e-=n[t].size)<0)return t}function Is(t,e,n,r){null==e&&(e=t.doc.first),null==n&&(n=t.doc.first+t.doc.size),r||(r=0);let i=t.display;if(r&&n<i.viewTo&&(null==i.updateLineNumbers||i.updateLineNumbers>e)&&(i.updateLineNumbers=e),t.curOp.viewChanged=!0,e>=i.viewTo)Xr&&hi(t.doc,e)<i.viewTo&&Rs(t);else if(n<=i.viewFrom)Xr&&ui(t.doc,n+r)>i.viewFrom?Rs(t):(i.viewFrom+=r,i.viewTo+=r);else if(e<=i.viewFrom&&n>=i.viewTo)Rs(t);else if(e<=i.viewFrom){let e=Hs(t,n,n+r,1);e?(i.view=i.view.slice(e.index),i.viewFrom=e.lineN,i.viewTo+=r):Rs(t)}else if(n>=i.viewTo){let n=Hs(t,e,e,-1);n?(i.view=i.view.slice(0,n.index),i.viewTo=n.lineN):Rs(t)}else{let s=Hs(t,e,e,-1),o=Hs(t,n,n+r,1);s&&o?(i.view=i.view.slice(0,s.index).concat(Li(t,s.lineN,o.lineN)).concat(i.view.slice(o.index)),i.viewTo+=r):Rs(t)}let s=i.externalMeasured;s&&(n<s.lineN?s.lineN+=r:e<s.lineN+s.size&&(i.externalMeasured=null))}function zs(t,e,n){t.curOp.viewChanged=!0;let r=t.display,i=t.display.externalMeasured;if(i&&e>=i.lineN&&e<i.lineN+i.size&&(r.externalMeasured=null),e<r.viewFrom||e>=r.viewTo)return;let s=r.view[Ps(t,e)];if(null==s.node)return;let o=s.changes||(s.changes=[]);-1==un(o,n)&&o.push(n)}function Rs(t){t.display.viewFrom=t.display.viewTo=t.doc.first,t.display.view=[],t.display.viewOffset=0}function Hs(t,e,n,r){let i,s=Ps(t,e),o=t.display.view;if(!Xr||n==t.doc.first+t.doc.size)return{index:s,lineN:n};let l=t.display.viewFrom;for(let t=0;t<s;t++)l+=o[t].size;if(l!=e){if(r>0){if(s==o.length-1)return null;i=l+o[s].size-e,s++}else i=l-e;e+=i,n+=i}for(;hi(t.doc,n)!=n;){if(s==(r<0?0:o.length-1))return null;n+=r*o[s-(r<0?1:0)].size,s+=r}return{index:s,lineN:n}}function Fs(t){let e=t.display.view,n=0;for(let t=0;t<e.length;t++){let r=e[t];r.hidden||r.node&&!r.changes||++n}return n}function Ws(t){t.display.input.showSelection(t.display.input.prepareSelection())}function js(t,e=!0){let n=t.doc,r={},i=r.cursors=document.createDocumentFragment(),s=r.selection=document.createDocumentFragment();for(let r=0;r<n.sel.ranges.length;r++){if(!e&&r==n.sel.primIndex)continue;let o=n.sel.ranges[r];if(o.from().line>=t.display.viewTo||o.to().line<t.display.viewFrom)continue;let l=o.empty();(l||t.options.showCursorWhenSelecting)&&Bs(t,o.head,i),l||Vs(t,o,s)}return r}function Bs(t,e,n){let r=ys(t,e,"div",null,null,!t.options.singleCursorHeightPerLine),i=n.appendChild(Je("div"," ","CodeMirror-cursor"));if(i.style.left=r.left+"px",i.style.top=r.top+"px",i.style.height=Math.max(0,r.bottom-r.top)*t.options.cursorHeight+"px",r.other){let t=n.appendChild(Je("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));t.style.display="",t.style.left=r.other.left+"px",t.style.top=r.other.top+"px",t.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function Us(t,e){return t.top-e.top||t.left-e.left}function Vs(t,e,n){let r=t.display,i=t.doc,s=document.createDocumentFragment(),o=Yi(t.display),l=o.left,a=Math.max(r.sizerWidth,Zi(t)-r.sizer.offsetLeft)-o.right,c="ltr"==i.direction;function h(t,e,n,r){e<0&&(e=0),e=Math.round(e),r=Math.round(r),s.appendChild(Je("div",null,"CodeMirror-selected",`position: absolute; left: ${t}px;\n                             top: ${e}px; width: ${null==n?a-t:n}px;\n                             height: ${r-e}px`))}function u(e,n,r){let s,o,u=yr(i,e),d=u.text.length;function f(n,r){return ms(t,Tr(e,n),"div",u,r)}function p(e,n,r){let i=Cs(t,u,null,e),s="ltr"==n==("after"==r)?"left":"right";return f("after"==r?i.begin:i.end-(/\s/.test(u.text.charAt(i.end-1))?2:1),s)[s]}let g=In(u,i.direction);return function(t,e,n,r){if(!t)return r(e,n,"ltr",0);let i=!1;for(let s=0;s<t.length;++s){let o=t[s];(o.from<n&&o.to>e||e==n&&o.to==e)&&(r(Math.max(o.from,e),Math.min(o.to,n),1==o.level?"rtl":"ltr",s),i=!0)}i||r(e,n,"ltr")}(g,n||0,null==r?d:r,(t,e,i,u)=>{let m="ltr"==i,y=f(t,m?"left":"right"),v=f(e-1,m?"right":"left"),x=null==n&&0==t,b=null==r&&e==d,w=0==u,C=!g||u==g.length-1;if(v.top-y.top<=3){let t=(c?b:x)&&C,e=(c?x:b)&&w?l:(m?y:v).left,n=t?a:(m?v:y).right;h(e,y.top,n-e,y.bottom)}else{let n,r,s,o;m?(n=c&&x&&w?l:y.left,r=c?a:p(t,i,"before"),s=c?l:p(e,i,"after"),o=c&&b&&C?a:v.right):(n=c?p(t,i,"before"):l,r=!c&&x&&w?a:y.right,s=!c&&b&&C?l:v.left,o=c?p(e,i,"after"):a),h(n,y.top,r-n,y.bottom),y.bottom<v.top&&h(l,y.bottom,null,v.top),h(s,v.top,o-s,v.bottom)}(!s||Us(y,s)<0)&&(s=y),Us(v,s)<0&&(s=v),(!o||Us(y,o)<0)&&(o=y),Us(v,o)<0&&(o=v)}),{start:s,end:o}}let d=e.from(),f=e.to();if(d.line==f.line)u(d.line,d.ch,f.ch);else{let t=yr(i,d.line),e=yr(i,f.line),n=ci(t)==ci(e),r=u(d.line,d.ch,n?t.text.length+1:null).end,s=u(f.line,n?0:null,f.ch).start;n&&(r.top<s.top-2?(h(r.right,r.top,null,r.bottom),h(l,s.top,s.left,s.bottom)):h(r.right,r.top,s.left-r.right,r.bottom)),r.bottom<s.top&&h(l,r.bottom,null,s.top)}n.appendChild(s)}function Gs(t){if(!t.state.focused)return;let e=t.display;clearInterval(e.blinker);let n=!0;e.cursorDiv.style.visibility="",t.options.cursorBlinkRate>0?e.blinker=setInterval(()=>e.cursorDiv.style.visibility=(n=!n)?"":"hidden",t.options.cursorBlinkRate):t.options.cursorBlinkRate<0&&(e.cursorDiv.style.visibility="hidden")}function qs(t){t.state.focused||(t.display.input.focus(),$s(t))}function Xs(t){t.state.delayingBlurEvent=!0,setTimeout(()=>{t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1,Ys(t))},100)}function $s(t,e){t.state.delayingBlurEvent&&(t.state.delayingBlurEvent=!1),"nocursor"!=t.options.readOnly&&(t.state.focused||(Wn(t,"focus",t,e),t.state.focused=!0,rn(t.display.wrapper,"CodeMirror-focused"),t.curOp||t.display.selForContextMenu==t.doc.sel||(t.display.input.reset(),Ee&&setTimeout(()=>t.display.input.reset(!0),20)),t.display.input.receivedFocus()),Gs(t))}function Ys(t,e){t.state.delayingBlurEvent||(t.state.focused&&(Wn(t,"blur",t,e),t.state.focused=!1,Ke(t.display.wrapper,"CodeMirror-focused")),clearInterval(t.display.blinker),setTimeout(()=>{t.state.focused||(t.display.shift=!1)},150))}function Ks(t){let e=t.display,n=e.lineDiv.offsetTop;for(let r=0;r<e.view.length;r++){let i,s=e.view[r],o=t.options.lineWrapping,l=0;if(s.hidden)continue;if(Ae&&_e<8){let t=s.node.offsetTop+s.node.offsetHeight;i=t-n,n=t}else{let t=s.node.getBoundingClientRect();i=t.bottom-t.top,!o&&s.text.firstChild&&(l=s.text.firstChild.getBoundingClientRect().right-t.left-1)}let a=s.line.height-i;if((a>.005||a<-.005)&&(br(s.line,i),Zs(s.line),s.rest))for(let t=0;t<s.rest.length;t++)Zs(s.rest[t]);if(l>t.display.sizerWidth){let e=Math.ceil(l/Ns(t.display));e>t.display.maxLineLength&&(t.display.maxLineLength=e,t.display.maxLine=s.line,t.display.maxLineChanged=!0)}}}function Zs(t){if(t.widgets)for(let e=0;e<t.widgets.length;++e){let n=t.widgets[e],r=n.node.parentNode;r&&(n.height=r.offsetHeight)}}function Qs(t,e,n){let r=n&&null!=n.top?Math.max(0,n.top):t.scroller.scrollTop;r=Math.floor(r-Xi(t));let i=n&&null!=n.bottom?n.bottom:r+t.wrapper.clientHeight,s=Cr(e,r),o=Cr(e,i);if(n&&n.ensure){let r=n.ensure.from.line,i=n.ensure.to.line;r<s?(s=r,o=Cr(e,pi(yr(e,r))+t.wrapper.clientHeight)):Math.min(i,e.lastLine())>=o&&(s=Cr(e,pi(yr(e,i))-t.wrapper.clientHeight),o=i)}return{from:s,to:Math.max(o,s+1)}}function Js(t,e){let n=t.display,r=ks(t.display);e.top<0&&(e.top=0);let i=t.curOp&&null!=t.curOp.scrollTop?t.curOp.scrollTop:n.scroller.scrollTop,s=Qi(t),o={};e.bottom-e.top>s&&(e.bottom=e.top+s);let l=t.doc.height+$i(n),a=e.top<r,c=e.bottom>l-r;if(e.top<i)o.scrollTop=a?0:e.top;else if(e.bottom>i+s){let t=Math.min(e.top,(c?l:e.bottom)-s);t!=i&&(o.scrollTop=t)}let h=t.curOp&&null!=t.curOp.scrollLeft?t.curOp.scrollLeft:n.scroller.scrollLeft,u=Zi(t)-(t.options.fixedGutter?n.gutters.offsetWidth:0),d=e.right-e.left>u;return d&&(e.right=e.left+u),e.left<10?o.scrollLeft=0:e.left<h?o.scrollLeft=Math.max(0,e.left-(d?0:10)):e.right>u+h-3&&(o.scrollLeft=e.right+(d?0:10)-u),o}function to(t,e){null!=e&&(ro(t),t.curOp.scrollTop=(null==t.curOp.scrollTop?t.doc.scrollTop:t.curOp.scrollTop)+e)}function eo(t){ro(t);let e=t.getCursor();t.curOp.scrollToPos={from:e,to:e,margin:t.options.cursorScrollMargin}}function no(t,e,n){null==e&&null==n||ro(t),null!=e&&(t.curOp.scrollLeft=e),null!=n&&(t.curOp.scrollTop=n)}function ro(t){let e=t.curOp.scrollToPos;if(e){t.curOp.scrollToPos=null,io(t,vs(t,e.from),vs(t,e.to),e.margin)}}function io(t,e,n,r){let i=Js(t,{left:Math.min(e.left,n.left),top:Math.min(e.top,n.top)-r,right:Math.max(e.right,n.right),bottom:Math.max(e.bottom,n.bottom)+r});no(t,i.scrollLeft,i.scrollTop)}function so(t,e){Math.abs(t.doc.scrollTop-e)<2||(Me||Ao(t,{top:e}),oo(t,e,!0),Me&&Ao(t),To(t,100))}function oo(t,e,n){e=Math.min(t.display.scroller.scrollHeight-t.display.scroller.clientHeight,e),(t.display.scroller.scrollTop!=e||n)&&(t.doc.scrollTop=e,t.display.scrollbars.setScrollTop(e),t.display.scroller.scrollTop!=e&&(t.display.scroller.scrollTop=e))}function lo(t,e,n,r){e=Math.min(e,t.display.scroller.scrollWidth-t.display.scroller.clientWidth),(n?e==t.doc.scrollLeft:Math.abs(t.doc.scrollLeft-e)<2)&&!r||(t.doc.scrollLeft=e,Do(t),t.display.scroller.scrollLeft!=e&&(t.display.scroller.scrollLeft=e),t.display.scrollbars.setScrollLeft(e))}function ao(t){let e=t.display,n=e.gutters.offsetWidth,r=Math.round(t.doc.height+$i(t.display));return{clientHeight:e.scroller.clientHeight,viewHeight:e.wrapper.clientHeight,scrollWidth:e.scroller.scrollWidth,clientWidth:e.scroller.clientWidth,viewWidth:e.wrapper.clientWidth,barLeft:t.options.fixedGutter?n:0,docHeight:r,scrollHeight:r+Ki(t)+e.barHeight,nativeBarWidth:e.nativeBarWidth,gutterWidth:n}}function co(t,e){e||(e=ao(t));let n=t.display.barWidth,r=t.display.barHeight;ho(t,e);for(let e=0;e<4&&n!=t.display.barWidth||r!=t.display.barHeight;e++)n!=t.display.barWidth&&t.options.lineWrapping&&Ks(t),ho(t,ao(t)),n=t.display.barWidth,r=t.display.barHeight}function ho(t,e){let n=t.display,r=n.scrollbars.update(e);n.sizer.style.paddingRight=(n.barWidth=r.right)+"px",n.sizer.style.paddingBottom=(n.barHeight=r.bottom)+"px",n.heightForcer.style.borderBottom=r.bottom+"px solid transparent",r.right&&r.bottom?(n.scrollbarFiller.style.display="block",n.scrollbarFiller.style.height=r.bottom+"px",n.scrollbarFiller.style.width=r.right+"px"):n.scrollbarFiller.style.display="",r.bottom&&t.options.coverGutterNextToScrollbar&&t.options.fixedGutter?(n.gutterFiller.style.display="block",n.gutterFiller.style.height=r.bottom+"px",n.gutterFiller.style.width=e.gutterWidth+"px"):n.gutterFiller.style.display=""}let uo={native:class{constructor(t,e,n){this.cm=n;let r=this.vert=Je("div",[Je("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i=this.horiz=Je("div",[Je("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");r.tabIndex=i.tabIndex=-1,t(r),t(i),Rn(r,"scroll",()=>{r.clientHeight&&e(r.scrollTop,"vertical")}),Rn(i,"scroll",()=>{i.clientWidth&&e(i.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,Ae&&_e<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")}update(t){let e=t.scrollWidth>t.clientWidth+1,n=t.scrollHeight>t.clientHeight+1,r=t.nativeBarWidth;if(n){this.vert.style.display="block",this.vert.style.bottom=e?r+"px":"0";let n=t.viewHeight-(e?r:0);this.vert.firstChild.style.height=Math.max(0,t.scrollHeight-t.clientHeight+n)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(e){this.horiz.style.display="block",this.horiz.style.right=n?r+"px":"0",this.horiz.style.left=t.barLeft+"px";let e=t.viewWidth-t.barLeft-(n?r:0);this.horiz.firstChild.style.width=Math.max(0,t.scrollWidth-t.clientWidth+e)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&t.clientHeight>0&&(0==r&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:n?r:0,bottom:e?r:0}}setScrollLeft(t){this.horiz.scrollLeft!=t&&(this.horiz.scrollLeft=t),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}setScrollTop(t){this.vert.scrollTop!=t&&(this.vert.scrollTop=t),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}zeroWidthHack(){let t=Be&&!Re?"12px":"18px";this.horiz.style.height=this.vert.style.width=t,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new hn,this.disableVert=new hn}enableZeroWidthBar(t,e,n){t.style.pointerEvents="auto",e.set(1e3,function r(){let i=t.getBoundingClientRect();("vert"==n?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1))!=t?t.style.pointerEvents="none":e.set(1e3,r)})}clear(){let t=this.horiz.parentNode;t.removeChild(this.horiz),t.removeChild(this.vert)}},null:class{update(){return{bottom:0,right:0}}setScrollLeft(){}setScrollTop(){}clear(){}}};function fo(t){t.display.scrollbars&&(t.display.scrollbars.clear(),t.display.scrollbars.addClass&&Ke(t.display.wrapper,t.display.scrollbars.addClass)),t.display.scrollbars=new uo[t.options.scrollbarStyle](e=>{t.display.wrapper.insertBefore(e,t.display.scrollbarFiller),Rn(e,"mousedown",()=>{t.state.focused&&setTimeout(()=>t.display.input.focus(),0)}),e.setAttribute("cm-not-content","true")},(e,n)=>{"horizontal"==n?lo(t,e):so(t,e)},t),t.display.scrollbars.addClass&&rn(t.display.wrapper,t.display.scrollbars.addClass)}let po=0;function go(t){var e;t.curOp={cm:t,viewChanged:!1,startHeight:t.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++po},e=t.curOp,Ai?Ai.ops.push(e):e.ownsGroup=Ai={ops:[e],delayedCallbacks:[]}}function mo(t){let e=t.curOp;e&&function(t,e){let n=t.ownsGroup;if(n)try{!function(t){let e=t.delayedCallbacks,n=0;do{for(;n<e.length;n++)e[n].call(null);for(let e=0;e<t.ops.length;e++){let n=t.ops[e];if(n.cursorActivityHandlers)for(;n.cursorActivityCalled<n.cursorActivityHandlers.length;)n.cursorActivityHandlers[n.cursorActivityCalled++].call(null,n.cm)}}while(n<e.length)}(n)}finally{Ai=null,e(n)}}(e,t=>{for(let e=0;e<t.ops.length;e++)t.ops[e].cm.curOp=null;!function(t){let e=t.ops;for(let t=0;t<e.length;t++)yo(e[t]);for(let t=0;t<e.length;t++)n=e[t],n.updatedDisplay=n.mustUpdate&&No(n.cm,n.update);var n;for(let t=0;t<e.length;t++)vo(e[t]);for(let t=0;t<e.length;t++)xo(e[t]);for(let t=0;t<e.length;t++)bo(e[t])}(t)})}function yo(t){let e=t.cm,n=e.display;!function(t){let e=t.display;!e.scrollbarsClipped&&e.scroller.offsetWidth&&(e.nativeBarWidth=e.scroller.offsetWidth-e.scroller.clientWidth,e.heightForcer.style.height=Ki(t)+"px",e.sizer.style.marginBottom=-e.nativeBarWidth+"px",e.sizer.style.borderRightWidth=Ki(t)+"px",e.scrollbarsClipped=!0)}(e),t.updateMaxLine&&mi(e),t.mustUpdate=t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<n.viewFrom||t.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&e.options.lineWrapping,t.update=t.mustUpdate&&new ko(e,t.mustUpdate&&{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate)}function vo(t){let e=t.cm,n=e.display;t.updatedDisplay&&Ks(e),t.barMeasure=ao(e),n.maxLineChanged&&!e.options.lineWrapping&&(t.adjustWidthTo=ts(e,n.maxLine,n.maxLine.text.length).left+3,e.display.sizerWidth=t.adjustWidthTo,t.barMeasure.scrollWidth=Math.max(n.scroller.clientWidth,n.sizer.offsetLeft+t.adjustWidthTo+Ki(e)+e.display.barWidth),t.maxScrollLeft=Math.max(0,n.sizer.offsetLeft+t.adjustWidthTo-Zi(e))),(t.updatedDisplay||t.selectionChanged)&&(t.preparedSelection=n.input.prepareSelection())}function xo(t){let e=t.cm;null!=t.adjustWidthTo&&(e.display.sizer.style.minWidth=t.adjustWidthTo+"px",t.maxScrollLeft<e.doc.scrollLeft&&lo(e,Math.min(e.display.scroller.scrollLeft,t.maxScrollLeft),!0),e.display.maxLineChanged=!1);let n=t.focus&&t.focus==nn();t.preparedSelection&&e.display.input.showSelection(t.preparedSelection,n),(t.updatedDisplay||t.startHeight!=e.doc.height)&&co(e,t.barMeasure),t.updatedDisplay&&Eo(e,t.barMeasure),t.selectionChanged&&Gs(e),e.state.focused&&t.updateInput&&e.display.input.reset(t.typing),n&&qs(t.cm)}function bo(t){let e=t.cm,n=e.display,r=e.doc;if(t.updatedDisplay&&Lo(e,t.update),null==n.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=t.scrollTop&&oo(e,t.scrollTop,t.forceScroll),null!=t.scrollLeft&&lo(e,t.scrollLeft,!0,!0),t.scrollToPos){!function(t,e){if(jn(t,"scrollCursorIntoView"))return;let n=t.display,r=n.sizer.getBoundingClientRect(),i=null;if(e.top+r.top<0?i=!0:e.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(i=!1),null!=i&&!He){let r=Je("div","​",null,`position: absolute;\n                         top: ${e.top-n.viewOffset-Xi(t.display)}px;\n                         height: ${e.bottom-e.top+Ki(t)+n.barHeight}px;\n                         left: ${e.left}px; width: ${Math.max(2,e.right-e.left)}px;`);t.display.lineSpace.appendChild(r),r.scrollIntoView(i),t.display.lineSpace.removeChild(r)}}(e,function(t,e,n,r){let i;null==r&&(r=0),t.options.lineWrapping||e!=n||(n="before"==(e=e.ch?Tr(e.line,"before"==e.sticky?e.ch-1:e.ch,"after"):e).sticky?Tr(e.line,e.ch+1,"before"):e);for(let s=0;s<5;s++){let s=!1,o=ys(t,e),l=n&&n!=e?ys(t,n):o,a=Js(t,i={left:Math.min(o.left,l.left),top:Math.min(o.top,l.top)-r,right:Math.max(o.left,l.left),bottom:Math.max(o.bottom,l.bottom)+r}),c=t.doc.scrollTop,h=t.doc.scrollLeft;if(null!=a.scrollTop&&(so(t,a.scrollTop),Math.abs(t.doc.scrollTop-c)>1&&(s=!0)),null!=a.scrollLeft&&(lo(t,a.scrollLeft),Math.abs(t.doc.scrollLeft-h)>1&&(s=!0)),!s)break}return i}(e,Er(r,t.scrollToPos.from),Er(r,t.scrollToPos.to),t.scrollToPos.margin))}let i=t.maybeHiddenMarkers,s=t.maybeUnhiddenMarkers;if(i)for(let t=0;t<i.length;++t)i[t].lines.length||Wn(i[t],"hide");if(s)for(let t=0;t<s.length;++t)s[t].lines.length&&Wn(s[t],"unhide");n.wrapper.offsetHeight&&(r.scrollTop=e.display.scroller.scrollTop),t.changeObjs&&Wn(e,"changes",e,t.changeObjs),t.update&&t.update.finish()}function wo(t,e){if(t.curOp)return e();go(t);try{return e()}finally{mo(t)}}function Co(t,e){return function(){if(t.curOp)return e.apply(t,arguments);go(t);try{return e.apply(t,arguments)}finally{mo(t)}}}function So(t){return function(){if(this.curOp)return t.apply(this,arguments);go(this);try{return t.apply(this,arguments)}finally{mo(this)}}}function Oo(t){return function(){let e=this.cm;if(!e||e.curOp)return t.apply(this,arguments);go(e);try{return t.apply(this,arguments)}finally{mo(e)}}}function To(t,e){t.doc.highlightFrontier<t.display.viewTo&&t.state.highlight.set(e,ln(Mo,t))}function Mo(t){let e=t.doc;if(e.highlightFrontier>=t.display.viewTo)return;let n=+new Date+t.options.workTime,r=Hr(t,e.highlightFrontier),i=[];e.iter(r.line,Math.min(e.first+e.size,t.display.viewTo+500),s=>{if(r.line>=t.display.viewFrom){let n=s.styles,o=s.text.length>t.options.maxHighlightLength?fr(e.mode,r.state):null,l=zr(t,s,r,!0);o&&(r.state=o),s.styles=l.styles;let a=s.styleClasses,c=l.classes;c?s.styleClasses=c:a&&(s.styleClasses=null);let h=!n||n.length!=s.styles.length||a!=c&&(!a||!c||a.bgClass!=c.bgClass||a.textClass!=c.textClass);for(let t=0;!h&&t<n.length;++t)h=n[t]!=s.styles[t];h&&i.push(r.line),s.stateAfter=r.save(),r.nextLine()}else s.text.length<=t.options.maxHighlightLength&&Fr(t,s.text,r),s.stateAfter=r.line%5==0?r.save():null,r.nextLine();if(+new Date>n)return To(t,t.options.workDelay),!0}),e.highlightFrontier=r.line,e.modeFrontier=Math.max(e.modeFrontier,r.line),i.length&&wo(t,()=>{for(let e=0;e<i.length;e++)zs(t,i[e],"text")})}class ko{constructor(t,e,n){let r=t.display;this.viewport=e,this.visible=Qs(r,t.doc,e),this.editorIsHidden=!r.wrapper.offsetWidth,this.wrapperHeight=r.wrapper.clientHeight,this.wrapperWidth=r.wrapper.clientWidth,this.oldDisplayWidth=Zi(t),this.force=n,this.dims=Ls(t),this.events=[]}signal(t,e){Un(t,e)&&this.events.push(arguments)}finish(){for(let t=0;t<this.events.length;t++)Wn.apply(null,this.events[t])}}function No(t,e){let n=t.display,r=t.doc;if(e.editorIsHidden)return Rs(t),!1;if(!e.force&&e.visible.from>=n.viewFrom&&e.visible.to<=n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo)&&n.renderedView==n.view&&0==Fs(t))return!1;Po(t)&&(Rs(t),e.dims=Ls(t));let i=r.first+r.size,s=Math.max(e.visible.from-t.options.viewportMargin,r.first),o=Math.min(i,e.visible.to+t.options.viewportMargin);n.viewFrom<s&&s-n.viewFrom<20&&(s=Math.max(r.first,n.viewFrom)),n.viewTo>o&&n.viewTo-o<20&&(o=Math.min(i,n.viewTo)),Xr&&(s=hi(t.doc,s),o=ui(t.doc,o));let l=s!=n.viewFrom||o!=n.viewTo||n.lastWrapHeight!=e.wrapperHeight||n.lastWrapWidth!=e.wrapperWidth;!function(t,e,n){let r=t.display;0==r.view.length||e>=r.viewTo||n<=r.viewFrom?(r.view=Li(t,e,n),r.viewFrom=e):(r.viewFrom>e?r.view=Li(t,e,r.viewFrom).concat(r.view):r.viewFrom<e&&(r.view=r.view.slice(Ps(t,e))),r.viewFrom=e,r.viewTo<n?r.view=r.view.concat(Li(t,r.viewTo,n)):r.viewTo>n&&(r.view=r.view.slice(0,Ps(t,n)))),r.viewTo=n}(t,s,o),n.viewOffset=pi(yr(t.doc,n.viewFrom)),t.display.mover.style.top=n.viewOffset+"px";let a=Fs(t);if(!l&&0==a&&!e.force&&n.renderedView==n.view&&(null==n.updateLineNumbers||n.updateLineNumbers>=n.viewTo))return!1;let c=function(t){if(t.hasFocus())return null;let e=nn();if(!e||!en(t.display.lineDiv,e))return null;let n={activeElt:e};if(window.getSelection){let e=window.getSelection();e.anchorNode&&e.extend&&en(t.display.lineDiv,e.anchorNode)&&(n.anchorNode=e.anchorNode,n.anchorOffset=e.anchorOffset,n.focusNode=e.focusNode,n.focusOffset=e.focusOffset)}return n}(t);return a>4&&(n.lineDiv.style.display="none"),function(t,e,n){let r=t.display,i=t.options.lineNumbers,s=r.lineDiv,o=s.firstChild;function l(e){let n=e.nextSibling;return Ee&&Be&&t.display.currentWheelTarget==e?e.style.display="none":e.parentNode.removeChild(e),n}let a=r.view,c=r.viewFrom;for(let r=0;r<a.length;r++){let h=a[r];if(h.hidden);else if(h.node&&h.node.parentNode==s){for(;o!=h.node;)o=l(o);let r=i&&null!=e&&e<=c&&h.lineNumber;h.changes&&(un(h.changes,"gutter")>-1&&(r=!1),Pi(t,h,c,n)),r&&(Ze(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(Or(t.options,c)))),o=h.node.nextSibling}else{let e=ji(t,h,c,n);s.insertBefore(e,o)}c+=h.size}for(;o;)o=l(o)}(t,n.updateLineNumbers,e.dims),a>4&&(n.lineDiv.style.display=""),n.renderedView=n.view,function(t){if(t&&t.activeElt&&t.activeElt!=nn()&&(t.activeElt.focus(),t.anchorNode&&en(document.body,t.anchorNode)&&en(document.body,t.focusNode))){let e=window.getSelection(),n=document.createRange();n.setEnd(t.anchorNode,t.anchorOffset),n.collapse(!1),e.removeAllRanges(),e.addRange(n),e.extend(t.focusNode,t.focusOffset)}}(c),Ze(n.cursorDiv),Ze(n.selectionDiv),n.gutters.style.height=n.sizer.style.minHeight=0,l&&(n.lastWrapHeight=e.wrapperHeight,n.lastWrapWidth=e.wrapperWidth,To(t,400)),n.updateLineNumbers=null,!0}function Lo(t,e){let n=e.viewport;for(let r=!0;(r&&t.options.lineWrapping&&e.oldDisplayWidth!=Zi(t)||(n&&null!=n.top&&(n={top:Math.min(t.doc.height+$i(t.display)-Qi(t),n.top)}),e.visible=Qs(t.display,t.doc,n),!(e.visible.from>=t.display.viewFrom&&e.visible.to<=t.display.viewTo)))&&No(t,e);r=!1){Ks(t);let n=ao(t);Ws(t),co(t,n),Eo(t,n),e.force=!1}e.signal(t,"update",t),t.display.viewFrom==t.display.reportedViewFrom&&t.display.viewTo==t.display.reportedViewTo||(e.signal(t,"viewportChange",t,t.display.viewFrom,t.display.viewTo),t.display.reportedViewFrom=t.display.viewFrom,t.display.reportedViewTo=t.display.viewTo)}function Ao(t,e){let n=new ko(t,e);if(No(t,n)){Ks(t),Lo(t,n);let e=ao(t);Ws(t),co(t,e),Eo(t,e),n.finish()}}function _o(t){let e=t.gutters.offsetWidth;t.sizer.style.marginLeft=e+"px"}function Eo(t,e){t.display.sizer.style.minHeight=e.docHeight+"px",t.display.heightForcer.style.top=e.docHeight+"px",t.display.gutters.style.height=e.docHeight+t.display.barHeight+Ki(t)+"px"}function Do(t){let e=t.display,n=e.view;if(!(e.alignWidgets||e.gutters.firstChild&&t.options.fixedGutter))return;let r=As(e)-e.scroller.scrollLeft+t.doc.scrollLeft,i=e.gutters.offsetWidth,s=r+"px";for(let e=0;e<n.length;e++)if(!n[e].hidden){t.options.fixedGutter&&(n[e].gutter&&(n[e].gutter.style.left=s),n[e].gutterBackground&&(n[e].gutterBackground.style.left=s));let r=n[e].alignable;if(r)for(let t=0;t<r.length;t++)r[t].style.left=s}t.options.fixedGutter&&(e.gutters.style.left=r+i+"px")}function Po(t){if(!t.options.lineNumbers)return!1;let e=t.doc,n=Or(t.options,e.first+e.size-1),r=t.display;if(n.length!=r.lineNumChars){let e=r.measure.appendChild(Je("div",[Je("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),i=e.firstChild.offsetWidth,s=e.offsetWidth-i;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(i,r.lineGutter.offsetWidth-s)+1,r.lineNumWidth=r.lineNumInnerWidth+s,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",_o(t.display),!0}return!1}function Io(t,e){let n=[],r=!1;for(let i=0;i<t.length;i++){let s=t[i],o=null;if("string"!=typeof s&&(o=s.style,s=s.className),"CodeMirror-linenumbers"==s){if(!e)continue;r=!0}n.push({className:s,style:o})}return e&&!r&&n.push({className:"CodeMirror-linenumbers",style:null}),n}function zo(t){let e=t.gutters,n=t.gutterSpecs;Ze(e),t.lineGutter=null;for(let r=0;r<n.length;++r){let{className:i,style:s}=n[r],o=e.appendChild(Je("div",null,"CodeMirror-gutter "+i));s&&(o.style.cssText=s),"CodeMirror-linenumbers"==i&&(t.lineGutter=o,o.style.width=(t.lineNumWidth||1)+"px")}e.style.display=n.length?"":"none",_o(t)}function Ro(t){zo(t.display),Is(t),Do(t)}function Ho(t,e,n,r){let i=this;this.input=n,i.scrollbarFiller=Je("div",null,"CodeMirror-scrollbar-filler"),i.scrollbarFiller.setAttribute("cm-not-content","true"),i.gutterFiller=Je("div",null,"CodeMirror-gutter-filler"),i.gutterFiller.setAttribute("cm-not-content","true"),i.lineDiv=tn("div",null,"CodeMirror-code"),i.selectionDiv=Je("div",null,null,"position: relative; z-index: 1"),i.cursorDiv=Je("div",null,"CodeMirror-cursors"),i.measure=Je("div",null,"CodeMirror-measure"),i.lineMeasure=Je("div",null,"CodeMirror-measure"),i.lineSpace=tn("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none");let s=tn("div",[i.lineSpace],"CodeMirror-lines");i.mover=Je("div",[s],null,"position: relative"),i.sizer=Je("div",[i.mover],"CodeMirror-sizer"),i.sizerWidth=null,i.heightForcer=Je("div",null,null,"position: absolute; height: "+dn+"px; width: 1px;"),i.gutters=Je("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=Je("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=Je("div",[i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),Ae&&_e<8&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),Ee||Me&&je||(i.scroller.draggable=!0),t&&(t.appendChild?t.appendChild(i.wrapper):t(i.wrapper)),i.viewFrom=i.viewTo=e.first,i.reportedViewFrom=i.reportedViewTo=e.first,i.view=[],i.renderedView=null,i.externalMeasured=null,i.viewOffset=0,i.lastWrapHeight=i.lastWrapWidth=0,i.updateLineNumbers=null,i.nativeBarWidth=i.barHeight=i.barWidth=0,i.scrollbarsClipped=!1,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.alignWidgets=!1,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i.shift=!1,i.selForContextMenu=null,i.activeTouch=null,i.gutterSpecs=Io(r.gutters,r.lineNumbers),zo(i),n.init(i)}let Fo=0,Wo=null;function jo(t){let e=t.wheelDeltaX,n=t.wheelDeltaY;return null==e&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(e=t.detail),null==n&&t.detail&&t.axis==t.VERTICAL_AXIS?n=t.detail:null==n&&(n=t.wheelDelta),{x:e,y:n}}function Bo(t){let e=jo(t);return e.x*=Wo,e.y*=Wo,e}function Uo(t,e){let n=jo(e),r=n.x,i=n.y,s=t.display,o=s.scroller,l=o.scrollWidth>o.clientWidth,a=o.scrollHeight>o.clientHeight;if(r&&l||i&&a){if(i&&Be&&Ee)t:for(let n=e.target,r=s.view;n!=o;n=n.parentNode)for(let e=0;e<r.length;e++)if(r[e].node==n){t.display.currentWheelTarget=n;break t}if(r&&!Me&&!Ie&&null!=Wo)return i&&a&&so(t,Math.max(0,o.scrollTop+i*Wo)),lo(t,Math.max(0,o.scrollLeft+r*Wo)),(!i||i&&a)&&Gn(e),void(s.wheelStartX=null);if(i&&null!=Wo){let e=i*Wo,n=t.doc.scrollTop,r=n+s.wrapper.clientHeight;e<0?n=Math.max(0,n+e-50):r=Math.min(t.doc.height,r+e+50),Ao(t,{top:n,bottom:r})}Fo<20&&(null==s.wheelStartX?(s.wheelStartX=o.scrollLeft,s.wheelStartY=o.scrollTop,s.wheelDX=r,s.wheelDY=i,setTimeout(()=>{if(null==s.wheelStartX)return;let t=o.scrollLeft-s.wheelStartX,e=o.scrollTop-s.wheelStartY,n=e&&s.wheelDY&&e/s.wheelDY||t&&s.wheelDX&&t/s.wheelDX;s.wheelStartX=s.wheelStartY=null,n&&(Wo=(Wo*Fo+n)/(Fo+1),++Fo)},200)):(s.wheelDX+=r,s.wheelDY+=i))}}Ae?Wo=-.53:Me?Wo=15:Pe?Wo=-.7:ze&&(Wo=-1/3);class Vo{constructor(t,e){this.ranges=t,this.primIndex=e}primary(){return this.ranges[this.primIndex]}equals(t){if(t==this)return!0;if(t.primIndex!=this.primIndex||t.ranges.length!=this.ranges.length)return!1;for(let e=0;e<this.ranges.length;e++){let n=this.ranges[e],r=t.ranges[e];if(!kr(n.anchor,r.anchor)||!kr(n.head,r.head))return!1}return!0}deepCopy(){let t=[];for(let e=0;e<this.ranges.length;e++)t[e]=new Go(Nr(this.ranges[e].anchor),Nr(this.ranges[e].head));return new Vo(t,this.primIndex)}somethingSelected(){for(let t=0;t<this.ranges.length;t++)if(!this.ranges[t].empty())return!0;return!1}contains(t,e){e||(e=t);for(let n=0;n<this.ranges.length;n++){let r=this.ranges[n];if(Mr(e,r.from())>=0&&Mr(t,r.to())<=0)return n}return-1}}class Go{constructor(t,e){this.anchor=t,this.head=e}from(){return Ar(this.anchor,this.head)}to(){return Lr(this.anchor,this.head)}empty(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}}function qo(t,e,n){let r=t&&t.options.selectionsMayTouch,i=e[n];e.sort((t,e)=>Mr(t.from(),e.from())),n=un(e,i);for(let t=1;t<e.length;t++){let i=e[t],s=e[t-1],o=Mr(s.to(),i.from());if(r&&!i.empty()?o>0:o>=0){let r=Ar(s.from(),i.from()),o=Lr(s.to(),i.to()),l=s.empty()?i.from()==i.head:s.from()==s.head;t<=n&&--n,e.splice(--t,2,new Go(l?o:r,l?r:o))}}return new Vo(e,n)}function Xo(t,e){return new Vo([new Go(t,e||t)],0)}function $o(t){return t.text?Tr(t.from.line+t.text.length-1,bn(t.text).length+(1==t.text.length?t.from.ch:0)):t.to}function Yo(t,e){if(Mr(t,e.from)<0)return t;if(Mr(t,e.to)<=0)return $o(e);let n=t.line+e.text.length-(e.to.line-e.from.line)-1,r=t.ch;return t.line==e.to.line&&(r+=$o(e).ch-e.to.ch),Tr(n,r)}function Ko(t,e){let n=[];for(let r=0;r<t.sel.ranges.length;r++){let i=t.sel.ranges[r];n.push(new Go(Yo(i.anchor,e),Yo(i.head,e)))}return qo(t.cm,n,t.sel.primIndex)}function Zo(t,e,n){return t.line==e.line?Tr(n.line,t.ch-e.ch+n.ch):Tr(n.line+(t.line-e.line),t.ch)}function Qo(t){t.doc.mode=hr(t.options,t.doc.modeOption),Jo(t)}function Jo(t){t.doc.iter(t=>{t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),t.doc.modeFrontier=t.doc.highlightFrontier=t.doc.first,To(t,100),t.state.modeGen++,t.curOp&&Is(t)}function tl(t,e){return 0==e.from.ch&&0==e.to.ch&&""==bn(e.text)&&(!t.cm||t.cm.options.wholeLineUpdateBefore)}function el(t,e,n,r){function i(t){return n?n[t]:null}function s(t,n,i){!function(t,e,n,r){t.text=e,t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null),null!=t.order&&(t.order=null),Jr(t),ti(t,n);let i=r?r(t):1;i!=t.height&&br(t,i)}(t,n,i,r),Ei(t,"change",t,e)}function o(t,e){let n=[];for(let s=t;s<e;++s)n.push(new yi(c[s],i(s),r));return n}let l=e.from,a=e.to,c=e.text,h=yr(t,l.line),u=yr(t,a.line),d=bn(c),f=i(c.length-1),p=a.line-l.line;if(e.full)t.insert(0,o(0,c.length)),t.remove(c.length,t.size-c.length);else if(tl(t,e)){let e=o(0,c.length-1);s(u,u.text,f),p&&t.remove(l.line,p),e.length&&t.insert(l.line,e)}else if(h==u)if(1==c.length)s(h,h.text.slice(0,l.ch)+d+h.text.slice(a.ch),f);else{let e=o(1,c.length-1);e.push(new yi(d+h.text.slice(a.ch),f,r)),s(h,h.text.slice(0,l.ch)+c[0],i(0)),t.insert(l.line+1,e)}else if(1==c.length)s(h,h.text.slice(0,l.ch)+c[0]+u.text.slice(a.ch),i(0)),t.remove(l.line+1,p);else{s(h,h.text.slice(0,l.ch)+c[0],i(0)),s(u,d+u.text.slice(a.ch),f);let e=o(1,c.length-1);p>1&&t.remove(l.line+1,p-1),t.insert(l.line+1,e)}Ei(t,"change",t,e)}function nl(t,e,n){!function t(r,i,s){if(r.linked)for(let o=0;o<r.linked.length;++o){let l=r.linked[o];if(l.doc==i)continue;let a=s&&l.sharedHist;n&&!a||(e(l.doc,a),t(l.doc,r,a))}}(t,null,!0)}function rl(t,e){if(e.cm)throw new Error("This document is already in use.");t.doc=e,e.cm=t,Es(t),Qo(t),il(t),t.options.lineWrapping||mi(t),t.options.mode=e.modeOption,Is(t)}function il(t){("rtl"==t.doc.direction?rn:Ke)(t.display.lineDiv,"CodeMirror-rtl")}function sl(t){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=t||1}function ol(t,e){let n={from:Nr(e.from),to:$o(e),text:vr(t,e.from,e.to)};return ul(t,n,e.from.line,e.to.line+1),nl(t,t=>ul(t,n,e.from.line,e.to.line+1),!0),n}function ll(t){for(;t.length;){if(!bn(t).ranges)break;t.pop()}}function al(t,e,n,r){let i=t.history;i.undone.length=0;let s,o,l=+new Date;if((i.lastOp==r||i.lastOrigin==e.origin&&e.origin&&("+"==e.origin.charAt(0)&&i.lastModTime>l-(t.cm?t.cm.options.historyEventDelay:500)||"*"==e.origin.charAt(0)))&&(s=function(t,e){return e?(ll(t.done),bn(t.done)):t.done.length&&!bn(t.done).ranges?bn(t.done):t.done.length>1&&!t.done[t.done.length-2].ranges?(t.done.pop(),bn(t.done)):void 0}(i,i.lastOp==r)))o=bn(s.changes),0==Mr(e.from,e.to)&&0==Mr(e.from,o.to)?o.to=$o(e):s.changes.push(ol(t,e));else{let n=bn(i.done);for(n&&n.ranges||hl(t.sel,i.done),s={changes:[ol(t,e)],generation:i.generation},i.done.push(s);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(n),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=l,i.lastOp=i.lastSelOp=r,i.lastOrigin=i.lastSelOrigin=e.origin,o||Wn(t,"historyAdded")}function cl(t,e,n,r){let i=t.history,s=r&&r.origin;n==i.lastSelOp||s&&i.lastSelOrigin==s&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==s||function(t,e,n,r){let i=e.charAt(0);return"*"==i||"+"==i&&n.ranges.length==r.ranges.length&&n.somethingSelected()==r.somethingSelected()&&new Date-t.history.lastSelTime<=(t.cm?t.cm.options.historyEventDelay:500)}(t,s,bn(i.done),e))?i.done[i.done.length-1]=e:hl(e,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=s,i.lastSelOp=n,r&&!1!==r.clearRedo&&ll(i.undone)}function hl(t,e){let n=bn(e);n&&n.ranges&&n.equals(t)||e.push(t)}function ul(t,e,n,r){let i=e["spans_"+t.id],s=0;t.iter(Math.max(t.first,n),Math.min(t.first+t.size,r),n=>{n.markedSpans&&((i||(i=e["spans_"+t.id]={}))[s]=n.markedSpans),++s})}function dl(t){if(!t)return null;let e;for(let n=0;n<t.length;++n)t[n].marker.explicitlyCleared?e||(e=t.slice(0,n)):e&&e.push(t[n]);return e?e.length?e:null:t}function fl(t,e){let n=function(t,e){let n=e["spans_"+t.id];if(!n)return null;let r=[];for(let t=0;t<e.text.length;++t)r.push(dl(n[t]));return r}(t,e),r=Zr(t,e);if(!n)return r;if(!r)return n;for(let t=0;t<n.length;++t){let e=n[t],i=r[t];if(e&&i)t:for(let t=0;t<i.length;++t){let n=i[t];for(let t=0;t<e.length;++t)if(e[t].marker==n.marker)continue t;e.push(n)}else i&&(n[t]=i)}return n}function pl(t,e,n){let r=[];for(let s=0;s<t.length;++s){let o=t[s];if(o.ranges){r.push(n?Vo.prototype.deepCopy.call(o):o);continue}let l=o.changes,a=[];r.push({changes:a});for(let t=0;t<l.length;++t){let n,r=l[t];if(a.push({from:r.from,to:r.to,text:r.text}),e)for(var i in r)(n=i.match(/^spans_(\d+)$/))&&un(e,Number(n[1]))>-1&&(bn(a)[i]=r[i],delete r[i])}}return r}function gl(t,e,n,r){if(r){let r=t.anchor;if(n){let t=Mr(e,r)<0;t!=Mr(n,r)<0?(r=e,e=n):t!=Mr(e,n)<0&&(e=n)}return new Go(r,e)}return new Go(n||e,e)}function ml(t,e,n,r,i){null==i&&(i=t.cm&&(t.cm.display.shift||t.extend)),wl(t,new Vo([gl(t.sel.primary(),e,n,i)],0),r)}function yl(t,e,n){let r=[],i=t.cm&&(t.cm.display.shift||t.extend);for(let n=0;n<t.sel.ranges.length;n++)r[n]=gl(t.sel.ranges[n],e[n],null,i);wl(t,qo(t.cm,r,t.sel.primIndex),n)}function vl(t,e,n,r){let i=t.sel.ranges.slice(0);i[e]=n,wl(t,qo(t.cm,i,t.sel.primIndex),r)}function xl(t,e,n,r){wl(t,Xo(e,n),r)}function bl(t,e,n){let r=t.history.done,i=bn(r);i&&i.ranges?(r[r.length-1]=e,Cl(t,e,n)):wl(t,e,n)}function wl(t,e,n){Cl(t,e,n),cl(t,t.sel,t.cm?t.cm.curOp.id:NaN,n)}function Cl(t,e,n){(Un(t,"beforeSelectionChange")||t.cm&&Un(t.cm,"beforeSelectionChange"))&&(e=function(t,e,n){let r={ranges:e.ranges,update:function(e){this.ranges=[];for(let n=0;n<e.length;n++)this.ranges[n]=new Go(Er(t,e[n].anchor),Er(t,e[n].head))},origin:n&&n.origin};return Wn(t,"beforeSelectionChange",t,r),t.cm&&Wn(t.cm,"beforeSelectionChange",t.cm,r),r.ranges!=e.ranges?qo(t.cm,r.ranges,r.ranges.length-1):e}(t,e,n));let r=n&&n.bias||(Mr(e.primary().head,t.sel.primary().head)<0?-1:1);Sl(t,Tl(t,e,r,!0)),n&&!1===n.scroll||!t.cm||eo(t.cm)}function Sl(t,e){e.equals(t.sel)||(t.sel=e,t.cm&&(t.cm.curOp.updateInput=1,t.cm.curOp.selectionChanged=!0,Bn(t.cm)),Ei(t,"cursorActivity",t))}function Ol(t){Sl(t,Tl(t,t.sel,null,!1))}function Tl(t,e,n,r){let i;for(let s=0;s<e.ranges.length;s++){let o=e.ranges[s],l=e.ranges.length==t.sel.ranges.length&&t.sel.ranges[s],a=kl(t,o.anchor,l&&l.anchor,n,r),c=kl(t,o.head,l&&l.head,n,r);(i||a!=o.anchor||c!=o.head)&&(i||(i=e.ranges.slice(0,s)),i[s]=new Go(a,c))}return i?qo(t.cm,i,e.primIndex):e}function Ml(t,e,n,r,i){let s=yr(t,e.line);if(s.markedSpans)for(let o=0;o<s.markedSpans.length;++o){let l=s.markedSpans[o],a=l.marker,c="selectLeft"in a?!a.selectLeft:a.inclusiveLeft,h="selectRight"in a?!a.selectRight:a.inclusiveRight;if((null==l.from||(c?l.from<=e.ch:l.from<e.ch))&&(null==l.to||(h?l.to>=e.ch:l.to>e.ch))){if(i&&(Wn(a,"beforeCursorEnter"),a.explicitlyCleared)){if(s.markedSpans){--o;continue}break}if(!a.atomic)continue;if(n){let o,l=a.find(r<0?1:-1);if((r<0?h:c)&&(l=Nl(t,l,-r,l&&l.line==e.line?s:null)),l&&l.line==e.line&&(o=Mr(l,n))&&(r<0?o<0:o>0))return Ml(t,l,e,r,i)}let l=a.find(r<0?-1:1);return(r<0?c:h)&&(l=Nl(t,l,r,l.line==e.line?s:null)),l?Ml(t,l,e,r,i):null}}return e}function kl(t,e,n,r,i){let s=r||1,o=Ml(t,e,n,s,i)||!i&&Ml(t,e,n,s,!0)||Ml(t,e,n,-s,i)||!i&&Ml(t,e,n,-s,!0);return o||(t.cantEdit=!0,Tr(t.first,0))}function Nl(t,e,n,r){return n<0&&0==e.ch?e.line>t.first?Er(t,Tr(e.line-1)):null:n>0&&e.ch==(r||yr(t,e.line)).text.length?e.line<t.first+t.size-1?Tr(e.line+1,0):null:new Tr(e.line,e.ch+n)}function Ll(t){t.setSelection(Tr(t.firstLine(),0),Tr(t.lastLine()),pn)}function Al(t,e,n){let r={canceled:!1,from:e.from,to:e.to,text:e.text,origin:e.origin,cancel:()=>r.canceled=!0};return n&&(r.update=(e,n,i,s)=>{e&&(r.from=Er(t,e)),n&&(r.to=Er(t,n)),i&&(r.text=i),void 0!==s&&(r.origin=s)}),Wn(t,"beforeChange",t,r),t.cm&&Wn(t.cm,"beforeChange",t.cm,r),r.canceled?(t.cm&&(t.cm.curOp.updateInput=2),null):{from:r.from,to:r.to,text:r.text,origin:r.origin}}function _l(t,e,n){if(t.cm){if(!t.cm.curOp)return Co(t.cm,_l)(t,e,n);if(t.cm.state.suppressEdits)return}if((Un(t,"beforeChange")||t.cm&&Un(t.cm,"beforeChange"))&&!(e=Al(t,e,!0)))return;let r=qr&&!n&&function(t,e,n){let r=null;if(t.iter(e.line,n.line+1,t=>{if(t.markedSpans)for(let e=0;e<t.markedSpans.length;++e){let n=t.markedSpans[e].marker;!n.readOnly||r&&-1!=un(r,n)||(r||(r=[])).push(n)}}),!r)return null;let i=[{from:e,to:n}];for(let t=0;t<r.length;++t){let e=r[t],n=e.find(0);for(let t=0;t<i.length;++t){let r=i[t];if(Mr(r.to,n.from)<0||Mr(r.from,n.to)>0)continue;let s=[t,1],o=Mr(r.from,n.from),l=Mr(r.to,n.to);(o<0||!e.inclusiveLeft&&!o)&&s.push({from:r.from,to:n.from}),(l>0||!e.inclusiveRight&&!l)&&s.push({from:n.to,to:r.to}),i.splice.apply(i,s),t+=s.length-3}}return i}(t,e.from,e.to);if(r)for(let n=r.length-1;n>=0;--n)El(t,{from:r[n].from,to:r[n].to,text:n?[""]:e.text,origin:e.origin});else El(t,e)}function El(t,e){if(1==e.text.length&&""==e.text[0]&&0==Mr(e.from,e.to))return;let n=Ko(t,e);al(t,e,n,t.cm?t.cm.curOp.id:NaN),Il(t,e,n,Zr(t,e));let r=[];nl(t,(t,n)=>{n||-1!=un(r,t.history)||(Fl(t.history,e),r.push(t.history)),Il(t,e,null,Zr(t,e))})}function Dl(t,e,n){let r=t.cm&&t.cm.state.suppressEdits;if(r&&!n)return;let i,s=t.history,o=t.sel,l="undo"==e?s.done:s.undone,a="undo"==e?s.undone:s.done,c=0;for(;c<l.length&&(i=l[c],n?!i.ranges||i.equals(t.sel):i.ranges);c++);if(c==l.length)return;for(s.lastOrigin=s.lastSelOrigin=null;;){if(!(i=l.pop()).ranges){if(r)return void l.push(i);break}if(hl(i,a),n&&!i.equals(t.sel))return void wl(t,i,{clearRedo:!1});o=i}let h=[];hl(o,a),a.push({changes:h,generation:s.generation}),s.generation=i.generation||++s.maxGeneration;let u=Un(t,"beforeChange")||t.cm&&Un(t.cm,"beforeChange");for(let n=i.changes.length-1;n>=0;--n){let r=i.changes[n];if(r.origin=e,u&&!Al(t,r,!1))return void(l.length=0);h.push(ol(t,r));let s=n?Ko(t,r):bn(l);Il(t,r,s,fl(t,r)),!n&&t.cm&&t.cm.scrollIntoView({from:r.from,to:$o(r)});let o=[];nl(t,(t,e)=>{e||-1!=un(o,t.history)||(Fl(t.history,r),o.push(t.history)),Il(t,r,null,fl(t,r))})}}function Pl(t,e){if(0!=e&&(t.first+=e,t.sel=new Vo(wn(t.sel.ranges,t=>new Go(Tr(t.anchor.line+e,t.anchor.ch),Tr(t.head.line+e,t.head.ch))),t.sel.primIndex),t.cm)){Is(t.cm,t.first,t.first-e,e);for(let e=t.cm.display,n=e.viewFrom;n<e.viewTo;n++)zs(t.cm,n,"gutter")}}function Il(t,e,n,r){if(t.cm&&!t.cm.curOp)return Co(t.cm,Il)(t,e,n,r);if(e.to.line<t.first)return void Pl(t,e.text.length-1-(e.to.line-e.from.line));if(e.from.line>t.lastLine())return;if(e.from.line<t.first){let n=e.text.length-1-(t.first-e.from.line);Pl(t,n),e={from:Tr(t.first,0),to:Tr(e.to.line+n,e.to.ch),text:[bn(e.text)],origin:e.origin}}let i=t.lastLine();e.to.line>i&&(e={from:e.from,to:Tr(i,yr(t,i).text.length),text:[e.text[0]],origin:e.origin}),e.removed=vr(t,e.from,e.to),n||(n=Ko(t,e)),t.cm?function(t,e,n){let r=t.doc,i=t.display,s=e.from,o=e.to,l=!1,a=s.line;t.options.lineWrapping||(a=wr(ci(yr(r,s.line))),r.iter(a,o.line+1,t=>{if(t==i.maxLine)return l=!0,!0}));r.sel.contains(e.from,e.to)>-1&&Bn(t);el(r,e,n,_s(t)),t.options.lineWrapping||(r.iter(a,s.line+e.text.length,t=>{let e=gi(t);e>i.maxLineLength&&(i.maxLine=t,i.maxLineLength=e,i.maxLineChanged=!0,l=!1)}),l&&(t.curOp.updateMaxLine=!0));(function(t,e){if(t.modeFrontier=Math.min(t.modeFrontier,e),t.highlightFrontier<e-10)return;let n=t.first;for(let r=e-1;r>n;r--){let i=yr(t,r).stateAfter;if(i&&(!(i instanceof Pr)||r+i.lookAhead<e)){n=r+1;break}}t.highlightFrontier=Math.min(t.highlightFrontier,n)})(r,s.line),To(t,400);let c=e.text.length-(o.line-s.line)-1;e.full?Is(t):s.line!=o.line||1!=e.text.length||tl(t.doc,e)?Is(t,s.line,o.line+1,c):zs(t,s.line,"text");let h=Un(t,"changes"),u=Un(t,"change");if(u||h){let n={from:s,to:o,text:e.text,removed:e.removed,origin:e.origin};u&&Ei(t,"change",t,n),h&&(t.curOp.changeObjs||(t.curOp.changeObjs=[])).push(n)}t.display.selForContextMenu=null}(t.cm,e,r):el(t,e,r),Cl(t,n,pn)}function zl(t,e,n,r,i){r||(r=n),Mr(r,n)<0&&([n,r]=[r,n]),"string"==typeof e&&(e=t.splitLines(e)),_l(t,{from:n,to:r,text:e,origin:i})}function Rl(t,e,n,r){n<t.line?t.line+=r:e<t.line&&(t.line=e,t.ch=0)}function Hl(t,e,n,r){for(let i=0;i<t.length;++i){let s=t[i],o=!0;if(s.ranges){s.copied||((s=t[i]=s.deepCopy()).copied=!0);for(let t=0;t<s.ranges.length;t++)Rl(s.ranges[t].anchor,e,n,r),Rl(s.ranges[t].head,e,n,r)}else{for(let t=0;t<s.changes.length;++t){let i=s.changes[t];if(n<i.from.line)i.from=Tr(i.from.line+r,i.from.ch),i.to=Tr(i.to.line+r,i.to.ch);else if(e<=i.to.line){o=!1;break}}o||(t.splice(0,i+1),i=0)}}}function Fl(t,e){let n=e.from.line,r=e.to.line,i=e.text.length-(r-n)-1;Hl(t.done,n,r,i),Hl(t.undone,n,r,i)}function Wl(t,e,n,r){let i=e,s=e;return"number"==typeof e?s=yr(t,_r(t,e)):i=wr(e),null==i?null:(r(s,i)&&t.cm&&zs(t.cm,i,n),s)}function jl(t){this.lines=t,this.parent=null;let e=0;for(let n=0;n<t.length;++n)t[n].parent=this,e+=t[n].height;this.height=e}function Bl(t){this.children=t;let e=0,n=0;for(let r=0;r<t.length;++r){let i=t[r];e+=i.chunkSize(),n+=i.height,i.parent=this}this.size=e,this.height=n,this.parent=null}jl.prototype={chunkSize(){return this.lines.length},removeInner(t,e){for(let n=t,r=t+e;n<r;++n){let t=this.lines[n];this.height-=t.height,vi(t),Ei(t,"delete")}this.lines.splice(t,e)},collapse(t){t.push.apply(t,this.lines)},insertInner(t,e,n){this.height+=n,this.lines=this.lines.slice(0,t).concat(e).concat(this.lines.slice(t));for(let t=0;t<e.length;++t)e[t].parent=this},iterN(t,e,n){for(let r=t+e;t<r;++t)if(n(this.lines[t]))return!0}},Bl.prototype={chunkSize(){return this.size},removeInner(t,e){this.size-=e;for(let n=0;n<this.children.length;++n){let r=this.children[n],i=r.chunkSize();if(t<i){let s=Math.min(e,i-t),o=r.height;if(r.removeInner(t,s),this.height-=o-r.height,i==s&&(this.children.splice(n--,1),r.parent=null),0==(e-=s))break;t=0}else t-=i}if(this.size-e<25&&(this.children.length>1||!(this.children[0]instanceof jl))){let t=[];this.collapse(t),this.children=[new jl(t)],this.children[0].parent=this}},collapse(t){for(let e=0;e<this.children.length;++e)this.children[e].collapse(t)},insertInner(t,e,n){this.size+=e.length,this.height+=n;for(let r=0;r<this.children.length;++r){let i=this.children[r],s=i.chunkSize();if(t<=s){if(i.insertInner(t,e,n),i.lines&&i.lines.length>50){let t=i.lines.length%25+25;for(let e=t;e<i.lines.length;){let t=new jl(i.lines.slice(e,e+=25));i.height-=t.height,this.children.splice(++r,0,t),t.parent=this}i.lines=i.lines.slice(0,t),this.maybeSpill()}break}t-=s}},maybeSpill(){if(this.children.length<=10)return;let t=this;do{let e=new Bl(t.children.splice(t.children.length-5,5));if(t.parent){t.size-=e.size,t.height-=e.height;let n=un(t.parent.children,t);t.parent.children.splice(n+1,0,e)}else{let n=new Bl(t.children);n.parent=t,t.children=[n,e],t=n}e.parent=t.parent}while(t.children.length>10);t.parent.maybeSpill()},iterN(t,e,n){for(let r=0;r<this.children.length;++r){let i=this.children[r],s=i.chunkSize();if(t<s){let r=Math.min(e,s-t);if(i.iterN(t,r,n))return!0;if(0==(e-=r))break;t=0}else t-=s}}};class Ul{constructor(t,e,n){if(n)for(let t in n)n.hasOwnProperty(t)&&(this[t]=n[t]);this.doc=t,this.node=e}clear(){let t=this.doc.cm,e=this.line.widgets,n=this.line,r=wr(n);if(null==r||!e)return;for(let t=0;t<e.length;++t)e[t]==this&&e.splice(t--,1);e.length||(n.widgets=null);let i=Gi(this);br(n,Math.max(0,n.height-i)),t&&(wo(t,()=>{Vl(t,n,-i),zs(t,r,"widget")}),Ei(t,"lineWidgetCleared",t,this,r))}changed(){let t=this.height,e=this.doc.cm,n=this.line;this.height=null;let r=Gi(this)-t;r&&(di(this.doc,n)||br(n,n.height+r),e&&wo(e,()=>{e.curOp.forceUpdate=!0,Vl(e,n,r),Ei(e,"lineWidgetChanged",e,this,wr(n))}))}}function Vl(t,e,n){pi(e)<(t.curOp&&t.curOp.scrollTop||t.doc.scrollTop)&&to(t,n)}Vn(Ul);let Gl=0;class ql{constructor(t,e){this.lines=[],this.type=e,this.doc=t,this.id=++Gl}clear(){if(this.explicitlyCleared)return;let t=this.doc.cm,e=t&&!t.curOp;if(e&&go(t),Un(this,"clear")){let t=this.find();t&&Ei(this,"clear",t.from,t.to)}let n=null,r=null;for(let e=0;e<this.lines.length;++e){let i=this.lines[e],s=Yr(i.markedSpans,this);t&&!this.collapsed?zs(t,wr(i),"text"):t&&(null!=s.to&&(r=wr(i)),null!=s.from&&(n=wr(i))),i.markedSpans=Kr(i.markedSpans,s),null==s.from&&this.collapsed&&!di(this.doc,i)&&t&&br(i,ks(t.display))}if(t&&this.collapsed&&!t.options.lineWrapping)for(let e=0;e<this.lines.length;++e){let n=ci(this.lines[e]),r=gi(n);r>t.display.maxLineLength&&(t.display.maxLine=n,t.display.maxLineLength=r,t.display.maxLineChanged=!0)}null!=n&&t&&this.collapsed&&Is(t,n,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,t&&Ol(t.doc)),t&&Ei(t,"markerCleared",t,this,n,r),e&&mo(t),this.parent&&this.parent.clear()}find(t,e){let n,r;null==t&&"bookmark"==this.type&&(t=1);for(let i=0;i<this.lines.length;++i){let s=this.lines[i],o=Yr(s.markedSpans,this);if(null!=o.from&&(n=Tr(e?s:wr(s),o.from),-1==t))return n;if(null!=o.to&&(r=Tr(e?s:wr(s),o.to),1==t))return r}return n&&{from:n,to:r}}changed(){let t=this.find(-1,!0),e=this,n=this.doc.cm;t&&n&&wo(n,()=>{let r=t.line,i=wr(t.line),s=es(n,i);if(s&&(as(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!di(e.doc,r)&&null!=e.height){let t=e.height;e.height=null;let n=Gi(e)-t;n&&br(r,r.height+n)}Ei(n,"markerChanged",n,this)})}attachLine(t){if(!this.lines.length&&this.doc.cm){let t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=un(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(t)}detachLine(t){if(this.lines.splice(un(this.lines,t),1),!this.lines.length&&this.doc.cm){let t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}}}function Xl(t,e,n,r,i){if(r&&r.shared)return function(t,e,n,r,i){(r=an(r)).shared=!1;let s=[Xl(t,e,n,r,i)],o=s[0],l=r.widgetNode;return nl(t,t=>{l&&(r.widgetNode=l.cloneNode(!0)),s.push(Xl(t,Er(t,e),Er(t,n),r,i));for(let e=0;e<t.linked.length;++e)if(t.linked[e].isParent)return;o=bn(s)}),new $l(s,o)}(t,e,n,r,i);if(t.cm&&!t.cm.curOp)return Co(t.cm,Xl)(t,e,n,r,i);let s=new ql(t,i),o=Mr(e,n);if(r&&an(r,s,!1),o>0||0==o&&!1!==s.clearWhenEmpty)return s;if(s.replacedWith&&(s.collapsed=!0,s.widgetNode=tn("span",[s.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||s.widgetNode.setAttribute("cm-ignore-events","true"),r.insertLeft&&(s.widgetNode.insertLeft=!0)),s.collapsed){if(ai(t,e.line,e,n,s)||e.line!=n.line&&ai(t,n.line,e,n,s))throw new Error("Inserting collapsed marker partially overlapping an existing one");Xr=!0}s.addToHistory&&al(t,{from:e,to:n,origin:"markText"},t.sel,NaN);let l,a=e.line,c=t.cm;if(t.iter(a,n.line+1,t=>{c&&s.collapsed&&!c.options.lineWrapping&&ci(t)==c.display.maxLine&&(l=!0),s.collapsed&&a!=e.line&&br(t,0),function(t,e){t.markedSpans=t.markedSpans?t.markedSpans.concat([e]):[e],e.marker.attachLine(t)}(t,new $r(s,a==e.line?e.ch:null,a==n.line?n.ch:null)),++a}),s.collapsed&&t.iter(e.line,n.line+1,e=>{di(t,e)&&br(e,0)}),s.clearOnEnter&&Rn(s,"beforeCursorEnter",()=>s.clear()),s.readOnly&&(qr=!0,(t.history.done.length||t.history.undone.length)&&t.clearHistory()),s.collapsed&&(s.id=++Gl,s.atomic=!0),c){if(l&&(c.curOp.updateMaxLine=!0),s.collapsed)Is(c,e.line,n.line+1);else if(s.className||s.startStyle||s.endStyle||s.css||s.attributes||s.title)for(let t=e.line;t<=n.line;t++)zs(c,t,"text");s.atomic&&Ol(c.doc),Ei(c,"markerAdded",c,s)}return s}Vn(ql);class $l{constructor(t,e){this.markers=t,this.primary=e;for(let e=0;e<t.length;++e)t[e].parent=this}clear(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(let t=0;t<this.markers.length;++t)this.markers[t].clear();Ei(this,"clear")}}find(t,e){return this.primary.find(t,e)}}function Yl(t){return t.findMarks(Tr(t.first,0),t.clipPos(Tr(t.lastLine())),t=>t.parent)}function Kl(t){for(let e=0;e<t.length;e++){let n=t[e],r=[n.primary.doc];nl(n.primary.doc,t=>r.push(t));for(let t=0;t<n.markers.length;t++){let e=n.markers[t];-1==un(r,e.doc)&&(e.parent=null,n.markers.splice(t--,1))}}}Vn($l);let Zl=0,Ql=function(t,e,n,r,i){if(!(this instanceof Ql))return new Ql(t,e,n,r,i);null==n&&(n=0),Bl.call(this,[new jl([new yi("",null)])]),this.first=n,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=n;let s=Tr(n,0);this.sel=Xo(s),this.history=new sl(null),this.id=++Zl,this.modeOption=e,this.lineSep=r,this.direction="rtl"==i?"rtl":"ltr",this.extend=!1,"string"==typeof t&&(t=this.splitLines(t)),el(this,{from:s,to:s,text:t}),wl(this,Xo(s),pn)};Ql.prototype=Sn(Bl.prototype,{constructor:Ql,iter:function(t,e,n){n?this.iterN(t-this.first,e-t,n):this.iterN(this.first,this.first+this.size,t)},insert:function(t,e){let n=0;for(let t=0;t<e.length;++t)n+=e[t].height;this.insertInner(t-this.first,e,n)},remove:function(t,e){this.removeInner(t-this.first,e)},getValue:function(t){let e=xr(this,this.first,this.first+this.size);return!1===t?e:e.join(t||this.lineSeparator())},setValue:Oo(function(t){let e=Tr(this.first,0),n=this.first+this.size-1;_l(this,{from:e,to:Tr(n,yr(this,n).text.length),text:this.splitLines(t),origin:"setValue",full:!0},!0),this.cm&&no(this.cm,0,0),wl(this,Xo(e),pn)}),replaceRange:function(t,e,n,r){zl(this,t,e=Er(this,e),n=n?Er(this,n):e,r)},getRange:function(t,e,n){let r=vr(this,Er(this,t),Er(this,e));return!1===n?r:r.join(n||this.lineSeparator())},getLine:function(t){let e=this.getLineHandle(t);return e&&e.text},getLineHandle:function(t){if(Sr(this,t))return yr(this,t)},getLineNumber:function(t){return wr(t)},getLineHandleVisualStart:function(t){return"number"==typeof t&&(t=yr(this,t)),ci(t)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(t){return Er(this,t)},getCursor:function(t){let e,n=this.sel.primary();return e=null==t||"head"==t?n.head:"anchor"==t?n.anchor:"end"==t||"to"==t||!1===t?n.to():n.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Oo(function(t,e,n){xl(this,Er(this,"number"==typeof t?Tr(t,e||0):t),null,n)}),setSelection:Oo(function(t,e,n){xl(this,Er(this,t),Er(this,e||t),n)}),extendSelection:Oo(function(t,e,n){ml(this,Er(this,t),e&&Er(this,e),n)}),extendSelections:Oo(function(t,e){yl(this,Dr(this,t),e)}),extendSelectionsBy:Oo(function(t,e){yl(this,Dr(this,wn(this.sel.ranges,t)),e)}),setSelections:Oo(function(t,e,n){if(!t.length)return;let r=[];for(let e=0;e<t.length;e++)r[e]=new Go(Er(this,t[e].anchor),Er(this,t[e].head));null==e&&(e=Math.min(t.length-1,this.sel.primIndex)),wl(this,qo(this.cm,r,e),n)}),addSelection:Oo(function(t,e,n){let r=this.sel.ranges.slice(0);r.push(new Go(Er(this,t),Er(this,e||t))),wl(this,qo(this.cm,r,r.length-1),n)}),getSelection:function(t){let e,n=this.sel.ranges;for(let t=0;t<n.length;t++){let r=vr(this,n[t].from(),n[t].to());e=e?e.concat(r):r}return!1===t?e:e.join(t||this.lineSeparator())},getSelections:function(t){let e=[],n=this.sel.ranges;for(let r=0;r<n.length;r++){let i=vr(this,n[r].from(),n[r].to());!1!==t&&(i=i.join(t||this.lineSeparator())),e[r]=i}return e},replaceSelection:function(t,e,n){let r=[];for(let e=0;e<this.sel.ranges.length;e++)r[e]=t;this.replaceSelections(r,e,n||"+input")},replaceSelections:Oo(function(t,e,n){let r=[],i=this.sel;for(let e=0;e<i.ranges.length;e++){let s=i.ranges[e];r[e]={from:s.from(),to:s.to(),text:this.splitLines(t[e]),origin:n}}let s=e&&"end"!=e&&function(t,e,n){let r=[],i=Tr(t.first,0),s=i;for(let o=0;o<e.length;o++){let l=e[o],a=Zo(l.from,i,s),c=Zo($o(l),i,s);if(i=l.to,s=c,"around"==n){let e=t.sel.ranges[o],n=Mr(e.head,e.anchor)<0;r[o]=new Go(n?c:a,n?a:c)}else r[o]=new Go(a,a)}return new Vo(r,t.sel.primIndex)}(this,r,e);for(let t=r.length-1;t>=0;t--)_l(this,r[t]);s?bl(this,s):this.cm&&eo(this.cm)}),undo:Oo(function(){Dl(this,"undo")}),redo:Oo(function(){Dl(this,"redo")}),undoSelection:Oo(function(){Dl(this,"undo",!0)}),redoSelection:Oo(function(){Dl(this,"redo",!0)}),setExtending:function(t){this.extend=t},getExtending:function(){return this.extend},historySize:function(){let t=this.history,e=0,n=0;for(let n=0;n<t.done.length;n++)t.done[n].ranges||++e;for(let e=0;e<t.undone.length;e++)t.undone[e].ranges||++n;return{undo:e,redo:n}},clearHistory:function(){this.history=new sl(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(t){return t&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(t){return this.history.generation==(t||this.cleanGeneration)},getHistory:function(){return{done:pl(this.history.done),undone:pl(this.history.undone)}},setHistory:function(t){let e=this.history=new sl(this.history.maxGeneration);e.done=pl(t.done.slice(0),null,!0),e.undone=pl(t.undone.slice(0),null,!0)},setGutterMarker:Oo(function(t,e,n){return Wl(this,t,"gutter",t=>{let r=t.gutterMarkers||(t.gutterMarkers={});return r[e]=n,!n&&kn(r)&&(t.gutterMarkers=null),!0})}),clearGutter:Oo(function(t){this.iter(e=>{e.gutterMarkers&&e.gutterMarkers[t]&&Wl(this,e,"gutter",()=>(e.gutterMarkers[t]=null,kn(e.gutterMarkers)&&(e.gutterMarkers=null),!0))})}),lineInfo:function(t){let e;if("number"==typeof t){if(!Sr(this,t))return null;if(e=t,!(t=yr(this,t)))return null}else if(null==(e=wr(t)))return null;return{line:e,handle:t,text:t.text,gutterMarkers:t.gutterMarkers,textClass:t.textClass,bgClass:t.bgClass,wrapClass:t.wrapClass,widgets:t.widgets}},addLineClass:Oo(function(t,e,n){return Wl(this,t,"gutter"==e?"gutter":"class",t=>{let r="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass";if(t[r]){if($e(n).test(t[r]))return!1;t[r]+=" "+n}else t[r]=n;return!0})}),removeLineClass:Oo(function(t,e,n){return Wl(this,t,"gutter"==e?"gutter":"class",t=>{let r="text"==e?"textClass":"background"==e?"bgClass":"gutter"==e?"gutterClass":"wrapClass",i=t[r];if(!i)return!1;if(null==n)t[r]=null;else{let e=i.match($e(n));if(!e)return!1;let s=e.index+e[0].length;t[r]=i.slice(0,e.index)+(e.index&&s!=i.length?" ":"")+i.slice(s)||null}return!0})}),addLineWidget:Oo(function(t,e,n){return function(t,e,n,r){let i=new Ul(t,n,r),s=t.cm;return s&&i.noHScroll&&(s.display.alignWidgets=!0),Wl(t,e,"widget",e=>{let n=e.widgets||(e.widgets=[]);if(null==i.insertAt?n.push(i):n.splice(Math.min(n.length-1,Math.max(0,i.insertAt)),0,i),i.line=e,s&&!di(t,e)){let n=pi(e)<t.scrollTop;br(e,e.height+Gi(i)),n&&to(s,i.height),s.curOp.forceUpdate=!0}return!0}),s&&Ei(s,"lineWidgetAdded",s,i,"number"==typeof e?e:wr(e)),i}(this,t,e,n)}),removeLineWidget:function(t){t.clear()},markText:function(t,e,n){return Xl(this,Er(this,t),Er(this,e),n,n&&n.type||"range")},setBookmark:function(t,e){let n={replacedWith:e&&(null==e.nodeType?e.widget:e),insertLeft:e&&e.insertLeft,clearWhenEmpty:!1,shared:e&&e.shared,handleMouseEvents:e&&e.handleMouseEvents};return Xl(this,t=Er(this,t),t,n,"bookmark")},findMarksAt:function(t){let e=[],n=yr(this,(t=Er(this,t)).line).markedSpans;if(n)for(let r=0;r<n.length;++r){let i=n[r];(null==i.from||i.from<=t.ch)&&(null==i.to||i.to>=t.ch)&&e.push(i.marker.parent||i.marker)}return e},findMarks:function(t,e,n){t=Er(this,t),e=Er(this,e);let r=[],i=t.line;return this.iter(t.line,e.line+1,s=>{let o=s.markedSpans;if(o)for(let s=0;s<o.length;s++){let l=o[s];null!=l.to&&i==t.line&&t.ch>=l.to||null==l.from&&i!=t.line||null!=l.from&&i==e.line&&l.from>=e.ch||n&&!n(l.marker)||r.push(l.marker.parent||l.marker)}++i}),r},getAllMarks:function(){let t=[];return this.iter(e=>{let n=e.markedSpans;if(n)for(let e=0;e<n.length;++e)null!=n[e].from&&t.push(n[e].marker)}),t},posFromIndex:function(t){let e,n=this.first,r=this.lineSeparator().length;return this.iter(i=>{let s=i.text.length+r;if(s>t)return e=t,!0;t-=s,++n}),Er(this,Tr(n,e))},indexFromPos:function(t){let e=(t=Er(this,t)).ch;if(t.line<this.first||t.ch<0)return 0;let n=this.lineSeparator().length;return this.iter(this.first,t.line,t=>{e+=t.text.length+n}),e},copy:function(t){let e=new Ql(xr(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return e.scrollTop=this.scrollTop,e.scrollLeft=this.scrollLeft,e.sel=this.sel,e.extend=!1,t&&(e.history.undoDepth=this.history.undoDepth,e.setHistory(this.getHistory())),e},linkedDoc:function(t){t||(t={});let e=this.first,n=this.first+this.size;null!=t.from&&t.from>e&&(e=t.from),null!=t.to&&t.to<n&&(n=t.to);let r=new Ql(xr(this,e,n),t.mode||this.modeOption,e,this.lineSep,this.direction);return t.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:t.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:t.sharedHist}],function(t,e){for(let n=0;n<e.length;n++){let r=e[n],i=r.find(),s=t.clipPos(i.from),o=t.clipPos(i.to);if(Mr(s,o)){let e=Xl(t,s,o,r.primary,r.primary.type);r.markers.push(e),e.parent=r}}}(r,Yl(this)),r},unlinkDoc:function(t){if(t instanceof qa&&(t=t.doc),this.linked)for(let e=0;e<this.linked.length;++e){if(this.linked[e].doc==t){this.linked.splice(e,1),t.unlinkDoc(this),Kl(Yl(this));break}}if(t.history==this.history){let e=[t.id];nl(t,t=>e.push(t.id),!0),t.history=new sl(null),t.history.done=pl(this.history.done,e),t.history.undone=pl(this.history.undone,e)}},iterLinkedDocs:function(t){nl(this,t)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(t){return this.lineSep?t.split(this.lineSep):nr(t)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:Oo(function(t){var e;("rtl"!=t&&(t="ltr"),t!=this.direction)&&(this.direction=t,this.iter(t=>t.order=null),this.cm&&wo(e=this.cm,()=>{il(e),Is(e)}))})}),Ql.prototype.eachLine=Ql.prototype.iter;let Jl=0;function ta(t){let e=this;if(ea(e),jn(e,t)||qi(e.display,t))return;Gn(t),Ae&&(Jl=+new Date);let n=Ds(e,t,!0),r=t.dataTransfer.files;if(n&&!e.isReadOnly())if(r&&r.length&&window.FileReader&&window.File){let t=r.length,i=Array(t),s=0,o=(r,o)=>{if(e.options.allowDropFileTypes&&-1==un(e.options.allowDropFileTypes,r.type))return;let l=new FileReader;l.onload=Co(e,()=>{let r=l.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(r)&&(r=""),i[o]=r,++s==t){let t={from:n=Er(e.doc,n),to:n,text:e.doc.splitLines(i.join(e.doc.lineSeparator())),origin:"paste"};_l(e.doc,t),bl(e.doc,Xo(n,$o(t)))}}),l.readAsText(r)};for(let e=0;e<t;++e)o(r[e],e)}else{if(e.state.draggingText&&e.doc.sel.contains(n)>-1)return e.state.draggingText(t),void setTimeout(()=>e.display.input.focus(),20);try{let r=t.dataTransfer.getData("Text");if(r){let t;if(e.state.draggingText&&!e.state.draggingText.copy&&(t=e.listSelections()),Cl(e.doc,Xo(n,n)),t)for(let n=0;n<t.length;++n)zl(e.doc,"",t[n].anchor,t[n].head,"drag");e.replaceSelection(r,"around","paste"),e.display.input.focus()}}catch(t){}}}function ea(t){t.display.dragCursor&&(t.display.lineSpace.removeChild(t.display.dragCursor),t.display.dragCursor=null)}function na(t){if(!document.getElementsByClassName)return;let e=document.getElementsByClassName("CodeMirror"),n=[];for(let t=0;t<e.length;t++){let r=e[t].CodeMirror;r&&n.push(r)}n.length&&n[0].operation(()=>{for(let e=0;e<n.length;e++)t(n[e])})}let ra=!1;function ia(){ra||(!function(){let t;Rn(window,"resize",()=>{null==t&&(t=setTimeout(()=>{t=null,na(sa)},100))}),Rn(window,"blur",()=>na(Ys))}(),ra=!0)}function sa(t){let e=t.display;e.cachedCharWidth=e.cachedTextHeight=e.cachedPaddingH=null,e.scrollbarsClipped=!1,t.setSize()}let oa={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(let t=0;t<10;t++)oa[t+48]=oa[t+96]=String(t);for(let t=65;t<=90;t++)oa[t]=String.fromCharCode(t);for(let t=1;t<=12;t++)oa[t+111]=oa[t+63235]="F"+t;let la={};function aa(t){let e,n,r,i,s=t.split(/-(?!$)/);t=s[s.length-1];for(let t=0;t<s.length-1;t++){let o=s[t];if(/^(cmd|meta|m)$/i.test(o))i=!0;else if(/^a(lt)?$/i.test(o))e=!0;else if(/^(c|ctrl|control)$/i.test(o))n=!0;else{if(!/^s(hift)?$/i.test(o))throw new Error("Unrecognized modifier name: "+o);r=!0}}return e&&(t="Alt-"+t),n&&(t="Ctrl-"+t),i&&(t="Cmd-"+t),r&&(t="Shift-"+t),t}function ca(t){let e={};for(let n in t)if(t.hasOwnProperty(n)){let r=t[n];if(/^(name|fallthrough|(de|at)tach)$/.test(n))continue;if("..."==r){delete t[n];continue}let i=wn(n.split(" "),aa);for(let t=0;t<i.length;t++){let n,s;t==i.length-1?(s=i.join(" "),n=r):(s=i.slice(0,t+1).join(" "),n="...");let o=e[s];if(o){if(o!=n)throw new Error("Inconsistent bindings for "+s)}else e[s]=n}delete t[n]}for(let n in e)t[n]=e[n];return t}function ha(t,e,n,r){let i=(e=pa(e)).call?e.call(t,r):e[t];if(!1===i)return"nothing";if("..."===i)return"multi";if(null!=i&&n(i))return"handled";if(e.fallthrough){if("[object Array]"!=Object.prototype.toString.call(e.fallthrough))return ha(t,e.fallthrough,n,r);for(let i=0;i<e.fallthrough.length;i++){let s=ha(t,e.fallthrough[i],n,r);if(s)return s}}}function ua(t){let e="string"==typeof t?t:oa[t.keyCode];return"Ctrl"==e||"Alt"==e||"Shift"==e||"Mod"==e}function da(t,e,n){let r=t;return e.altKey&&"Alt"!=r&&(t="Alt-"+t),(qe?e.metaKey:e.ctrlKey)&&"Ctrl"!=r&&(t="Ctrl-"+t),(qe?e.ctrlKey:e.metaKey)&&"Cmd"!=r&&(t="Cmd-"+t),!n&&e.shiftKey&&"Shift"!=r&&(t="Shift-"+t),t}function fa(t,e){if(Ie&&34==t.keyCode&&t.char)return!1;let n=oa[t.keyCode];return null!=n&&!t.altGraphKey&&(3==t.keyCode&&t.code&&(n=t.code),da(n,t,e))}function pa(t){return"string"==typeof t?la[t]:t}function ga(t,e){let n=t.doc.sel.ranges,r=[];for(let t=0;t<n.length;t++){let i=e(n[t]);for(;r.length&&Mr(i.from,bn(r).to)<=0;){let t=r.pop();if(Mr(t.from,i.from)<0){i.from=t.from;break}}r.push(i)}wo(t,()=>{for(let e=r.length-1;e>=0;e--)zl(t.doc,"",r[e].from,r[e].to,"+delete");eo(t)})}function ma(t,e,n){let r=An(t.text,e+n,n);return r<0||r>t.text.length?null:r}function ya(t,e,n){let r=ma(t,e.ch,n);return null==r?null:new Tr(e.line,r,n<0?"after":"before")}function va(t,e,n,r,i){if(t){let t=In(n,e.doc.direction);if(t){let s,o=i<0?bn(t):t[0],l=i<0==(1==o.level)?"after":"before";if(o.level>0||"rtl"==e.doc.direction){let t=ns(e,n);s=i<0?n.text.length-1:0;let r=rs(e,t,s).top;s=_n(n=>rs(e,t,n).top==r,i<0==(1==o.level)?o.from:o.to-1,s),"before"==l&&(s=ma(n,s,1))}else s=i<0?o.to:o.from;return new Tr(r,s,l)}}return new Tr(r,i<0?n.text.length:0,i<0?"before":"after")}la.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},la.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},la.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},la.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},la.default=Be?la.macDefault:la.pcDefault;let xa={selectAll:Ll,singleSelection:t=>t.setSelection(t.getCursor("anchor"),t.getCursor("head"),pn),killLine:t=>ga(t,e=>{if(e.empty()){let n=yr(t.doc,e.head.line).text.length;return e.head.ch==n&&e.head.line<t.lastLine()?{from:e.head,to:Tr(e.head.line+1,0)}:{from:e.head,to:Tr(e.head.line,n)}}return{from:e.from(),to:e.to()}}),deleteLine:t=>ga(t,e=>({from:Tr(e.from().line,0),to:Er(t.doc,Tr(e.to().line+1,0))})),delLineLeft:t=>ga(t,t=>({from:Tr(t.from().line,0),to:t.from()})),delWrappedLineLeft:t=>ga(t,e=>{let n=t.charCoords(e.head,"div").top+5;return{from:t.coordsChar({left:0,top:n},"div"),to:e.from()}}),delWrappedLineRight:t=>ga(t,e=>{let n=t.charCoords(e.head,"div").top+5,r=t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:n},"div");return{from:e.from(),to:r}}),undo:t=>t.undo(),redo:t=>t.redo(),undoSelection:t=>t.undoSelection(),redoSelection:t=>t.redoSelection(),goDocStart:t=>t.extendSelection(Tr(t.firstLine(),0)),goDocEnd:t=>t.extendSelection(Tr(t.lastLine())),goLineStart:t=>t.extendSelectionsBy(e=>ba(t,e.head.line),{origin:"+move",bias:1}),goLineStartSmart:t=>t.extendSelectionsBy(e=>wa(t,e.head),{origin:"+move",bias:1}),goLineEnd:t=>t.extendSelectionsBy(e=>(function(t,e){let n=yr(t.doc,e),r=function(t){let e;for(;e=oi(t);)t=e.find(1,!0).line;return t}(n);r!=n&&(e=wr(r));return va(!0,t,n,e,-1)})(t,e.head.line),{origin:"+move",bias:-1}),goLineRight:t=>t.extendSelectionsBy(e=>{let n=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:t.display.lineDiv.offsetWidth+100,top:n},"div")},mn),goLineLeft:t=>t.extendSelectionsBy(e=>{let n=t.cursorCoords(e.head,"div").top+5;return t.coordsChar({left:0,top:n},"div")},mn),goLineLeftSmart:t=>t.extendSelectionsBy(e=>{let n=t.cursorCoords(e.head,"div").top+5,r=t.coordsChar({left:0,top:n},"div");return r.ch<t.getLine(r.line).search(/\S/)?wa(t,e.head):r},mn),goLineUp:t=>t.moveV(-1,"line"),goLineDown:t=>t.moveV(1,"line"),goPageUp:t=>t.moveV(-1,"page"),goPageDown:t=>t.moveV(1,"page"),goCharLeft:t=>t.moveH(-1,"char"),goCharRight:t=>t.moveH(1,"char"),goColumnLeft:t=>t.moveH(-1,"column"),goColumnRight:t=>t.moveH(1,"column"),goWordLeft:t=>t.moveH(-1,"word"),goGroupRight:t=>t.moveH(1,"group"),goGroupLeft:t=>t.moveH(-1,"group"),goWordRight:t=>t.moveH(1,"word"),delCharBefore:t=>t.deleteH(-1,"char"),delCharAfter:t=>t.deleteH(1,"char"),delWordBefore:t=>t.deleteH(-1,"word"),delWordAfter:t=>t.deleteH(1,"word"),delGroupBefore:t=>t.deleteH(-1,"group"),delGroupAfter:t=>t.deleteH(1,"group"),indentAuto:t=>t.indentSelection("smart"),indentMore:t=>t.indentSelection("add"),indentLess:t=>t.indentSelection("subtract"),insertTab:t=>t.replaceSelection("\t"),insertSoftTab:t=>{let e=[],n=t.listSelections(),r=t.options.tabSize;for(let i=0;i<n.length;i++){let s=n[i].from(),o=cn(t.getLine(s.line),s.ch,r);e.push(xn(r-o%r))}t.replaceSelections(e)},defaultTab:t=>{t.somethingSelected()?t.indentSelection("add"):t.execCommand("insertTab")},transposeChars:t=>wo(t,()=>{let e=t.listSelections(),n=[];for(let r=0;r<e.length;r++){if(!e[r].empty())continue;let i=e[r].head,s=yr(t.doc,i.line).text;if(s)if(i.ch==s.length&&(i=new Tr(i.line,i.ch-1)),i.ch>0)i=new Tr(i.line,i.ch+1),t.replaceRange(s.charAt(i.ch-1)+s.charAt(i.ch-2),Tr(i.line,i.ch-2),i,"+transpose");else if(i.line>t.doc.first){let e=yr(t.doc,i.line-1).text;e&&(i=new Tr(i.line,1),t.replaceRange(s.charAt(0)+t.doc.lineSeparator()+e.charAt(e.length-1),Tr(i.line-1,e.length-1),i,"+transpose"))}n.push(new Go(i,i))}t.setSelections(n)}),newlineAndIndent:t=>wo(t,()=>{let e=t.listSelections();for(let n=e.length-1;n>=0;n--)t.replaceRange(t.doc.lineSeparator(),e[n].anchor,e[n].head,"+input");e=t.listSelections();for(let n=0;n<e.length;n++)t.indentLine(e[n].from().line,null,!0);eo(t)}),openLine:t=>t.replaceSelection("\n","start"),toggleOverwrite:t=>t.toggleOverwrite()};function ba(t,e){let n=yr(t.doc,e),r=ci(n);return r!=n&&(e=wr(r)),va(!0,t,r,e,1)}function wa(t,e){let n=ba(t,e.line),r=yr(t.doc,n.line),i=In(r,t.doc.direction);if(!i||0==i[0].level){let t=Math.max(0,r.text.search(/\S/)),i=e.line==n.line&&e.ch<=t&&e.ch;return Tr(n.line,i?0:t,n.sticky)}return n}function Ca(t,e,n){if("string"==typeof e&&!(e=xa[e]))return!1;t.display.input.ensurePolled();let r=t.display.shift,i=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),n&&(t.display.shift=!1),i=e(t)!=fn}finally{t.display.shift=r,t.state.suppressEdits=!1}return i}let Sa=new hn;function Oa(t,e,n,r){let i=t.state.keySeq;if(i){if(ua(e))return"handled";if(/\'$/.test(e)?t.state.keySeq=null:Sa.set(50,()=>{t.state.keySeq==i&&(t.state.keySeq=null,t.display.input.reset())}),Ta(t,i+" "+e,n,r))return!0}return Ta(t,e,n,r)}function Ta(t,e,n,r){let i=function(t,e,n){for(let r=0;r<t.state.keyMaps.length;r++){let i=ha(e,t.state.keyMaps[r],n,t);if(i)return i}return t.options.extraKeys&&ha(e,t.options.extraKeys,n,t)||ha(e,t.options.keyMap,n,t)}(t,e,r);return"multi"==i&&(t.state.keySeq=e),"handled"==i&&Ei(t,"keyHandled",t,e,n),"handled"!=i&&"multi"!=i||(Gn(n),Gs(t)),!!i}function Ma(t,e){let n=fa(e,!0);return!!n&&(e.shiftKey&&!t.state.keySeq?Oa(t,"Shift-"+n,e,e=>Ca(t,e,!0))||Oa(t,n,e,e=>{if("string"==typeof e?/^go[A-Z]/.test(e):e.motion)return Ca(t,e)}):Oa(t,n,e,e=>Ca(t,e)))}let ka=null;function Na(t){let e=this;if(e.curOp.focus=nn(),jn(e,t))return;Ae&&_e<11&&27==t.keyCode&&(t.returnValue=!1);let n=t.keyCode;e.display.shift=16==n||t.shiftKey;let r=Ma(e,t);Ie&&(ka=r?n:null,!r&&88==n&&!ir&&(Be?t.metaKey:t.ctrlKey)&&e.replaceSelection("",null,"cut")),18!=n||/\bCodeMirror-crosshair\b/.test(e.display.lineDiv.className)||function(t){let e=t.display.lineDiv;function n(t){18!=t.keyCode&&t.altKey||(Ke(e,"CodeMirror-crosshair"),Fn(document,"keyup",n),Fn(document,"mouseover",n))}rn(e,"CodeMirror-crosshair"),Rn(document,"keyup",n),Rn(document,"mouseover",n)}(e)}function La(t){16==t.keyCode&&(this.doc.sel.shift=!1),jn(this,t)}function Aa(t){let e=this;if(qi(e.display,t)||jn(e,t)||t.ctrlKey&&!t.altKey||Be&&t.metaKey)return;let n=t.keyCode,r=t.charCode;if(Ie&&n==ka)return ka=null,void Gn(t);if(Ie&&(!t.which||t.which<10)&&Ma(e,t))return;let i=String.fromCharCode(null==r?n:r);"\b"!=i&&(function(t,e,n){return Oa(t,"'"+n+"'",e,e=>Ca(t,e,!0))}(e,t,i)||e.display.input.onKeyPress(t))}const _a=400;class Ea{constructor(t,e,n){this.time=t,this.pos=e,this.button=n}compare(t,e,n){return this.time+_a>t&&0==Mr(e,this.pos)&&n==this.button}}let Da,Pa;function Ia(t){let e=this,n=e.display;if(jn(e,t)||n.activeTouch&&n.input.supportsTouch())return;if(n.input.ensurePolled(),n.shift=t.shiftKey,qi(n,t))return void(Ee||(n.scroller.draggable=!1,setTimeout(()=>n.scroller.draggable=!0,100)));if(Ha(e,t))return;let r=Ds(e,t),i=Kn(t),s=r?function(t,e){let n=+new Date;return Pa&&Pa.compare(n,t,e)?(Da=Pa=null,"triple"):Da&&Da.compare(n,t,e)?(Pa=new Ea(n,t,e),Da=null,"double"):(Da=new Ea(n,t,e),Pa=null,"single")}(r,i):"single";window.focus(),1==i&&e.state.selectingText&&e.state.selectingText(t),r&&function(t,e,n,r,i){let s="Click";"double"==r?s="Double"+s:"triple"==r&&(s="Triple"+s);return Oa(t,da(s=(1==e?"Left":2==e?"Middle":"Right")+s,i),i,e=>{if("string"==typeof e&&(e=xa[e]),!e)return!1;let r=!1;try{t.isReadOnly()&&(t.state.suppressEdits=!0),r=e(t,n)!=fn}finally{t.state.suppressEdits=!1}return r})}(e,i,r,s,t)||(1==i?r?function(t,e,n,r){Ae?setTimeout(ln(qs,t),0):t.curOp.focus=nn();let i,s=function(t,e,n){let r=t.getOption("configureMouse"),i=r?r(t,e,n):{};if(null==i.unit){let t=Ue?n.shiftKey&&n.metaKey:n.altKey;i.unit=t?"rectangle":"single"==e?"char":"double"==e?"word":"line"}(null==i.extend||t.doc.extend)&&(i.extend=t.doc.extend||n.shiftKey);null==i.addNew&&(i.addNew=Be?n.metaKey:n.ctrlKey);null==i.moveOnDrag&&(i.moveOnDrag=!(Be?n.altKey:n.ctrlKey));return i}(t,n,r),o=t.doc.sel;t.options.dragDrop&&Jn&&!t.isReadOnly()&&"single"==n&&(i=o.contains(e))>-1&&(Mr((i=o.ranges[i]).from(),e)<0||e.xRel>0)&&(Mr(i.to(),e)>0||e.xRel<0)?function(t,e,n,r){let i=t.display,s=!1,o=Co(t,e=>{Ee&&(i.scroller.draggable=!1),t.state.draggingText=!1,Fn(i.wrapper.ownerDocument,"mouseup",o),Fn(i.wrapper.ownerDocument,"mousemove",l),Fn(i.scroller,"dragstart",a),Fn(i.scroller,"drop",o),s||(Gn(e),r.addNew||ml(t.doc,n,null,null,r.extend),Ee||Ae&&9==_e?setTimeout(()=>{i.wrapper.ownerDocument.body.focus(),i.input.focus()},20):i.input.focus())}),l=function(t){s=s||Math.abs(e.clientX-t.clientX)+Math.abs(e.clientY-t.clientY)>=10},a=()=>s=!0;Ee&&(i.scroller.draggable=!0);t.state.draggingText=o,o.copy=!r.moveOnDrag,i.scroller.dragDrop&&i.scroller.dragDrop();Rn(i.wrapper.ownerDocument,"mouseup",o),Rn(i.wrapper.ownerDocument,"mousemove",l),Rn(i.scroller,"dragstart",a),Rn(i.scroller,"drop",o),Xs(t),setTimeout(()=>i.input.focus(),20)}(t,r,e,s):function(t,e,n,r){let i=t.display,s=t.doc;Gn(e);let o,l,a=s.sel,c=a.ranges;r.addNew&&!r.extend?(l=s.sel.contains(n),o=l>-1?c[l]:new Go(n,n)):(o=s.sel.primary(),l=s.sel.primIndex);if("rectangle"==r.unit)r.addNew||(o=new Go(n,n)),n=Ds(t,e,!0,!0),l=-1;else{let e=za(t,n,r.unit);o=r.extend?gl(o,e.anchor,e.head,r.extend):e}r.addNew?-1==l?(l=c.length,wl(s,qo(t,c.concat([o]),l),{scroll:!1,origin:"*mouse"})):c.length>1&&c[l].empty()&&"char"==r.unit&&!r.extend?(wl(s,qo(t,c.slice(0,l).concat(c.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),a=s.sel):vl(s,l,o,gn):(l=0,wl(s,new Vo([o],0),gn),a=s.sel);let h=n;function u(e){if(0!=Mr(h,e))if(h=e,"rectangle"==r.unit){let r=[],i=t.options.tabSize,o=cn(yr(s,n.line).text,n.ch,i),c=cn(yr(s,e.line).text,e.ch,i),h=Math.min(o,c),u=Math.max(o,c);for(let o=Math.min(n.line,e.line),l=Math.min(t.lastLine(),Math.max(n.line,e.line));o<=l;o++){let t=yr(s,o).text,e=yn(t,h,i);h==u?r.push(new Go(Tr(o,e),Tr(o,e))):t.length>e&&r.push(new Go(Tr(o,e),Tr(o,yn(t,u,i))))}r.length||r.push(new Go(n,n)),wl(s,qo(t,a.ranges.slice(0,l).concat(r),l),{origin:"*mouse",scroll:!1}),t.scrollIntoView(e)}else{let n,i=o,c=za(t,e,r.unit),h=i.anchor;Mr(c.anchor,h)>0?(n=c.head,h=Ar(i.from(),c.anchor)):(n=c.anchor,h=Lr(i.to(),c.head));let u=a.ranges.slice(0);u[l]=function(t,e){let{anchor:n,head:r}=e,i=yr(t.doc,n.line);if(0==Mr(n,r)&&n.sticky==r.sticky)return e;let s=In(i);if(!s)return e;let o=Dn(s,n.ch,n.sticky),l=s[o];if(l.from!=n.ch&&l.to!=n.ch)return e;let a,c=o+(l.from==n.ch==(1!=l.level)?0:1);if(0==c||c==s.length)return e;if(r.line!=n.line)a=(r.line-n.line)*("ltr"==t.doc.direction?1:-1)>0;else{let t=Dn(s,r.ch,r.sticky),e=t-o||(r.ch-n.ch)*(1==l.level?-1:1);a=t==c-1||t==c?e<0:e>0}let h=s[c+(a?-1:0)],u=a==(1==h.level),d=u?h.from:h.to,f=u?"after":"before";return n.ch==d&&n.sticky==f?e:new Go(new Tr(n.line,d,f),r)}(t,new Go(Er(s,h),n)),wl(s,qo(t,u,l),gn)}}let d=i.wrapper.getBoundingClientRect(),f=0;function p(e){t.state.selectingText=!1,f=1/0,e&&(Gn(e),i.input.focus()),Fn(i.wrapper.ownerDocument,"mousemove",g),Fn(i.wrapper.ownerDocument,"mouseup",m),s.history.lastSelOrigin=null}let g=Co(t,e=>{0!==e.buttons&&Kn(e)?function e(n){let o=++f,l=Ds(t,n,!0,"rectangle"==r.unit);if(l)if(0!=Mr(l,h)){t.curOp.focus=nn(),u(l);let r=Qs(i,s);(l.line>=r.to||l.line<r.from)&&setTimeout(Co(t,()=>{f==o&&e(n)}),150)}else{let r=n.clientY<d.top?-20:n.clientY>d.bottom?20:0;r&&setTimeout(Co(t,()=>{f==o&&(i.scroller.scrollTop+=r,e(n))}),50)}}(e):p(e)}),m=Co(t,p);t.state.selectingText=m,Rn(i.wrapper.ownerDocument,"mousemove",g),Rn(i.wrapper.ownerDocument,"mouseup",m)}(t,r,e,s)}(e,r,s,t):Yn(t)==n.scroller&&Gn(t):2==i?(r&&ml(e.doc,r),setTimeout(()=>n.input.focus(),20)):3==i&&(Xe?e.display.input.onContextMenu(t):Xs(e)))}function za(t,e,n){if("char"==n)return new Go(e,e);if("word"==n)return t.findWordAt(e);if("line"==n)return new Go(Tr(e.line,0),Er(t.doc,Tr(e.line+1,0)));let r=n(t,e);return new Go(r.from,r.to)}function Ra(t,e,n,r){let i,s;if(e.touches)i=e.touches[0].clientX,s=e.touches[0].clientY;else try{i=e.clientX,s=e.clientY}catch(e){return!1}if(i>=Math.floor(t.display.gutters.getBoundingClientRect().right))return!1;r&&Gn(e);let o=t.display,l=o.lineDiv.getBoundingClientRect();if(s>l.bottom||!Un(t,n))return Xn(e);s-=l.top-o.viewOffset;for(let r=0;r<t.display.gutterSpecs.length;++r){let l=o.gutters.childNodes[r];if(l&&l.getBoundingClientRect().right>=i){return Wn(t,n,t,Cr(t.doc,s),t.display.gutterSpecs[r].className,e),Xn(e)}}}function Ha(t,e){return Ra(t,e,"gutterClick",!0)}function Fa(t,e){qi(t.display,e)||function(t,e){return!!Un(t,"gutterContextMenu")&&Ra(t,e,"gutterContextMenu",!1)}(t,e)||jn(t,e,"contextmenu")||Xe||t.display.input.onContextMenu(e)}function Wa(t){t.display.wrapper.className=t.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+t.options.theme.replace(/(^|\s)\s*/g," cm-s-"),hs(t)}let ja={toString:function(){return"CodeMirror.Init"}},Ba={},Ua={};function Va(t,e,n){if(!e!=!(n&&n!=ja)){let n=t.display.dragFunctions,r=e?Rn:Fn;r(t.display.scroller,"dragstart",n.start),r(t.display.scroller,"dragenter",n.enter),r(t.display.scroller,"dragover",n.over),r(t.display.scroller,"dragleave",n.leave),r(t.display.scroller,"drop",n.drop)}}function Ga(t){t.options.lineWrapping?(rn(t.display.wrapper,"CodeMirror-wrap"),t.display.sizer.style.minWidth="",t.display.sizerWidth=null):(Ke(t.display.wrapper,"CodeMirror-wrap"),mi(t)),Es(t),Is(t),hs(t),setTimeout(()=>co(t),100)}function qa(t,e){if(!(this instanceof qa))return new qa(t,e);this.options=e=e?an(e):{},an(Ba,e,!1);let n=e.value;"string"==typeof n?n=new Ql(n,e.mode,null,e.lineSeparator,e.direction):e.mode&&(n.modeOption=e.mode),this.doc=n;let r=new qa.inputStyles[e.inputStyle](this),i=this.display=new Ho(t,n,r,e);i.wrapper.CodeMirror=this,Wa(this),e.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),fo(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new hn,keySeq:null,specialChars:null},e.autofocus&&!je&&i.input.focus(),Ae&&_e<11&&setTimeout(()=>this.display.input.reset(!0),20),function(t){let e=t.display;Rn(e.scroller,"mousedown",Co(t,Ia)),Rn(e.scroller,"dblclick",Ae&&_e<11?Co(t,e=>{if(jn(t,e))return;let n=Ds(t,e);if(!n||Ha(t,e)||qi(t.display,e))return;Gn(e);let r=t.findWordAt(n);ml(t.doc,r.anchor,r.head)}):e=>jn(t,e)||Gn(e));Rn(e.scroller,"contextmenu",e=>Fa(t,e));let n,r={end:0};function i(){e.activeTouch&&(n=setTimeout(()=>e.activeTouch=null,1e3),(r=e.activeTouch).end=+new Date)}function s(t,e){if(null==e.left)return!0;let n=e.left-t.left,r=e.top-t.top;return n*n+r*r>400}Rn(e.scroller,"touchstart",i=>{if(!jn(t,i)&&!function(t){if(1!=t.touches.length)return!1;let e=t.touches[0];return e.radiusX<=1&&e.radiusY<=1}(i)&&!Ha(t,i)){e.input.ensurePolled(),clearTimeout(n);let t=+new Date;e.activeTouch={start:t,moved:!1,prev:t-r.end<=300?r:null},1==i.touches.length&&(e.activeTouch.left=i.touches[0].pageX,e.activeTouch.top=i.touches[0].pageY)}}),Rn(e.scroller,"touchmove",()=>{e.activeTouch&&(e.activeTouch.moved=!0)}),Rn(e.scroller,"touchend",n=>{let r=e.activeTouch;if(r&&!qi(e,n)&&null!=r.left&&!r.moved&&new Date-r.start<300){let i,o=t.coordsChar(e.activeTouch,"page");i=!r.prev||s(r,r.prev)?new Go(o,o):!r.prev.prev||s(r,r.prev.prev)?t.findWordAt(o):new Go(Tr(o.line,0),Er(t.doc,Tr(o.line+1,0))),t.setSelection(i.anchor,i.head),t.focus(),Gn(n)}i()}),Rn(e.scroller,"touchcancel",i),Rn(e.scroller,"scroll",()=>{e.scroller.clientHeight&&(so(t,e.scroller.scrollTop),lo(t,e.scroller.scrollLeft,!0),Wn(t,"scroll",t))}),Rn(e.scroller,"mousewheel",e=>Uo(t,e)),Rn(e.scroller,"DOMMouseScroll",e=>Uo(t,e)),Rn(e.wrapper,"scroll",()=>e.wrapper.scrollTop=e.wrapper.scrollLeft=0),e.dragFunctions={enter:e=>{jn(t,e)||$n(e)},over:e=>{jn(t,e)||(!function(t,e){let n=Ds(t,e);if(!n)return;let r=document.createDocumentFragment();Bs(t,n,r),t.display.dragCursor||(t.display.dragCursor=Je("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),t.display.lineSpace.insertBefore(t.display.dragCursor,t.display.cursorDiv)),Qe(t.display.dragCursor,r)}(t,e),$n(e))},start:e=>(function(t,e){if(Ae&&(!t.state.draggingText||+new Date-Jl<100))$n(e);else if(!jn(t,e)&&!qi(t.display,e)&&(e.dataTransfer.setData("Text",t.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!ze)){let n=Je("img",null,null,"position: fixed; left: 0; top: 0;");n.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Ie&&(n.width=n.height=1,t.display.wrapper.appendChild(n),n._top=n.offsetTop),e.dataTransfer.setDragImage(n,0,0),Ie&&n.parentNode.removeChild(n)}})(t,e),drop:Co(t,ta),leave:e=>{jn(t,e)||ea(t)}};let o=e.input.getField();Rn(o,"keyup",e=>La.call(t,e)),Rn(o,"keydown",Co(t,Na)),Rn(o,"keypress",Co(t,Aa)),Rn(o,"focus",e=>$s(t,e)),Rn(o,"blur",e=>Ys(t,e))}(this),ia(),go(this),this.curOp.forceUpdate=!0,rl(this,n),e.autofocus&&!je||this.hasFocus()?setTimeout(ln($s,this),20):Ys(this);for(let t in Ua)Ua.hasOwnProperty(t)&&Ua[t](this,e[t],ja);Po(this),e.finishInit&&e.finishInit(this);for(let t=0;t<Xa.length;++t)Xa[t](this);mo(this),Ee&&e.lineWrapping&&"optimizelegibility"==getComputedStyle(i.lineDiv).textRendering&&(i.lineDiv.style.textRendering="auto")}qa.defaults=Ba,qa.optionHandlers=Ua;let Xa=[];function $a(t,e,n,r){let i,s=t.doc;null==n&&(n="add"),"smart"==n&&(s.mode.indent?i=Hr(t,e).state:n="prev");let o=t.options.tabSize,l=yr(s,e),a=cn(l.text,null,o);l.stateAfter&&(l.stateAfter=null);let c,h=l.text.match(/^\s*/)[0];if(r||/\S/.test(l.text)){if("smart"==n&&((c=s.mode.indent(i,l.text.slice(h.length),l.text))==fn||c>150)){if(!r)return;n="prev"}}else c=0,n="not";"prev"==n?c=e>s.first?cn(yr(s,e-1).text,null,o):0:"add"==n?c=a+t.options.indentUnit:"subtract"==n?c=a-t.options.indentUnit:"number"==typeof n&&(c=a+n),c=Math.max(0,c);let u="",d=0;if(t.options.indentWithTabs)for(let t=Math.floor(c/o);t;--t)d+=o,u+="\t";if(d<c&&(u+=xn(c-d)),u!=h)return zl(s,u,Tr(e,0),Tr(e,h.length),"+input"),l.stateAfter=null,!0;for(let t=0;t<s.sel.ranges.length;t++){let n=s.sel.ranges[t];if(n.head.line==e&&n.head.ch<h.length){let n=Tr(e,h.length);vl(s,t,new Go(n,n));break}}}qa.defineInitHook=t=>Xa.push(t);let Ya=null;function Ka(t){Ya=t}function Za(t,e,n,r,i){let s=t.doc;t.display.shift=!1,r||(r=s.sel);let o=+new Date-200,l="paste"==i||t.state.pasteIncoming>o,a=nr(e),c=null;if(l&&r.ranges.length>1)if(Ya&&Ya.text.join("\n")==e){if(r.ranges.length%Ya.text.length==0){c=[];for(let t=0;t<Ya.text.length;t++)c.push(s.splitLines(Ya.text[t]))}}else a.length==r.ranges.length&&t.options.pasteLinesPerSelection&&(c=wn(a,t=>[t]));let h=t.curOp.updateInput;for(let h=r.ranges.length-1;h>=0;h--){let u=r.ranges[h],d=u.from(),f=u.to();u.empty()&&(n&&n>0?d=Tr(d.line,d.ch-n):t.state.overwrite&&!l?f=Tr(f.line,Math.min(yr(s,f.line).text.length,f.ch+bn(a).length)):l&&Ya&&Ya.lineWise&&Ya.text.join("\n")==e&&(d=f=Tr(d.line,0)));let p={from:d,to:f,text:c?c[h%c.length]:a,origin:i||(l?"paste":t.state.cutIncoming>o?"cut":"+input")};_l(t.doc,p),Ei(t,"inputRead",t,p)}e&&!l&&Ja(t,e),eo(t),t.curOp.updateInput<2&&(t.curOp.updateInput=h),t.curOp.typing=!0,t.state.pasteIncoming=t.state.cutIncoming=-1}function Qa(t,e){let n=t.clipboardData&&t.clipboardData.getData("Text");if(n)return t.preventDefault(),e.isReadOnly()||e.options.disableInput||wo(e,()=>Za(e,n,0,null,"paste")),!0}function Ja(t,e){if(!t.options.electricChars||!t.options.smartIndent)return;let n=t.doc.sel;for(let r=n.ranges.length-1;r>=0;r--){let i=n.ranges[r];if(i.head.ch>100||r&&n.ranges[r-1].head.line==i.head.line)continue;let s=t.getModeAt(i.head),o=!1;if(s.electricChars){for(let n=0;n<s.electricChars.length;n++)if(e.indexOf(s.electricChars.charAt(n))>-1){o=$a(t,i.head.line,"smart");break}}else s.electricInput&&s.electricInput.test(yr(t.doc,i.head.line).text.slice(0,i.head.ch))&&(o=$a(t,i.head.line,"smart"));o&&Ei(t,"electricInput",t,i.head.line)}}function tc(t){let e=[],n=[];for(let r=0;r<t.doc.sel.ranges.length;r++){let i=t.doc.sel.ranges[r].head.line,s={anchor:Tr(i,0),head:Tr(i+1,0)};n.push(s),e.push(t.getRange(s.anchor,s.head))}return{text:e,ranges:n}}function ec(t,e,n,r){t.setAttribute("autocorrect",n?"":"off"),t.setAttribute("autocapitalize",r?"":"off"),t.setAttribute("spellcheck",!!e)}function nc(){let t=Je("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),e=Je("div",[t],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return Ee?t.style.width="1000px":t.setAttribute("wrap","off"),Fe&&(t.style.border="1px solid black"),ec(t),e}function rc(t,e,n,r,i){let s=e,o=n,l=yr(t,e.line);function a(r){let s;if(null==(s=i?function(t,e,n,r){let i=In(e,t.doc.direction);if(!i)return ya(e,n,r);n.ch>=e.text.length?(n.ch=e.text.length,n.sticky="before"):n.ch<=0&&(n.ch=0,n.sticky="after");let s=Dn(i,n.ch,n.sticky),o=i[s];if("ltr"==t.doc.direction&&o.level%2==0&&(r>0?o.to>n.ch:o.from<n.ch))return ya(e,n,r);let l,a=(t,n)=>ma(e,t instanceof Tr?t.ch:t,n),c=n=>t.options.lineWrapping?(l=l||ns(t,e),Cs(t,e,l,n)):{begin:0,end:e.text.length},h=c("before"==n.sticky?a(n,-1):n.ch);if("rtl"==t.doc.direction||1==o.level){let t=1==o.level==r<0,e=a(n,t?1:-1);if(null!=e&&(t?e<=o.to&&e<=h.end:e>=o.from&&e>=h.begin)){let r=t?"before":"after";return new Tr(n.line,e,r)}}let u=(t,e,r)=>{let s=(t,e)=>e?new Tr(n.line,a(t,1),"before"):new Tr(n.line,t,"after");for(;t>=0&&t<i.length;t+=e){let n=i[t],o=e>0==(1!=n.level),l=o?r.begin:a(r.end,-1);if(n.from<=l&&l<n.to)return s(l,o);if(l=o?n.from:a(n.to,-1),r.begin<=l&&l<r.end)return s(l,o)}},d=u(s+r,r,h);if(d)return d;let f=r>0?h.end:a(h.begin,-1);return null==f||r>0&&f==e.text.length||!(d=u(r>0?0:i.length-1,r,c(f)))?null:d}(t.cm,l,e,n):ya(l,e,n))){if(r||!function(){let r=e.line+n;return!(r<t.first||r>=t.first+t.size)&&(e=new Tr(r,e.ch,e.sticky),l=yr(t,r))}())return!1;e=va(i,t.cm,l,e.line,n)}else e=s;return!0}if("char"==r)a();else if("column"==r)a(!0);else if("word"==r||"group"==r){let i=null,s="group"==r,o=t.cm&&t.cm.getHelper(e,"wordChars");for(let t=!0;!(n<0)||a(!t);t=!1){let r=l.text.charAt(e.ch)||"\n",c=Mn(r,o)?"w":s&&"\n"==r?"n":!s||/\s/.test(r)?null:"p";if(!s||t||c||(c="s"),i&&i!=c){n<0&&(n=1,a(),e.sticky="after");break}if(c&&(i=c),n>0&&!a(!t))break}}let c=kl(t,e,s,o,!0);return kr(s,c)&&(c.hitSide=!0),c}function ic(t,e,n,r){let i,s,o=t.doc,l=e.left;if("page"==r){let r=Math.min(t.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),s=Math.max(r-.5*ks(t.display),3);i=(n>0?e.bottom:e.top)+n*s}else"line"==r&&(i=n>0?e.bottom+3:e.top-3);for(;(s=bs(t,l,i)).outside;){if(n<0?i<=0:i>=o.height){s.hitSide=!0;break}i+=5*n}return s}class sc{constructor(t){this.cm=t,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new hn,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null}init(t){let e=this,n=e.cm,r=e.div=t.lineDiv;function i(t){if(jn(n,t))return;if(n.somethingSelected())Ka({lineWise:!1,text:n.getSelections()}),"cut"==t.type&&n.replaceSelection("",null,"cut");else{if(!n.options.lineWiseCopyCut)return;{let e=tc(n);Ka({lineWise:!0,text:e.text}),"cut"==t.type&&n.operation(()=>{n.setSelections(e.ranges,0,pn),n.replaceSelection("",null,"cut")})}}if(t.clipboardData){t.clipboardData.clearData();let e=Ya.text.join("\n");if(t.clipboardData.setData("Text",e),t.clipboardData.getData("Text")==e)return void t.preventDefault()}let i=nc(),s=i.firstChild;n.display.lineSpace.insertBefore(i,n.display.lineSpace.firstChild),s.value=Ya.text.join("\n");let o=document.activeElement;on(s),setTimeout(()=>{n.display.lineSpace.removeChild(i),o.focus(),o==r&&e.showPrimarySelection()},50)}ec(r,n.options.spellcheck,n.options.autocorrect,n.options.autocapitalize),Rn(r,"paste",t=>{jn(n,t)||Qa(t,n)||_e<=11&&setTimeout(Co(n,()=>this.updateFromDOM()),20)}),Rn(r,"compositionstart",t=>{this.composing={data:t.data,done:!1}}),Rn(r,"compositionupdate",t=>{this.composing||(this.composing={data:t.data,done:!1})}),Rn(r,"compositionend",t=>{this.composing&&(t.data!=this.composing.data&&this.readFromDOMSoon(),this.composing.done=!0)}),Rn(r,"touchstart",()=>e.forceCompositionEnd()),Rn(r,"input",()=>{this.composing||this.readFromDOMSoon()}),Rn(r,"copy",i),Rn(r,"cut",i)}prepareSelection(){let t=js(this.cm,!1);return t.focus=this.cm.state.focused,t}showSelection(t,e){t&&this.cm.display.view.length&&((t.focus||e)&&this.showPrimarySelection(),this.showMultipleSelections(t))}getSelection(){return this.cm.display.wrapper.ownerDocument.getSelection()}showPrimarySelection(){let t=this.getSelection(),e=this.cm,n=e.doc.sel.primary(),r=n.from(),i=n.to();if(e.display.viewTo==e.display.viewFrom||r.line>=e.display.viewTo||i.line<e.display.viewFrom)return void t.removeAllRanges();let s=ac(e,t.anchorNode,t.anchorOffset),o=ac(e,t.focusNode,t.focusOffset);if(s&&!s.bad&&o&&!o.bad&&0==Mr(Ar(s,o),r)&&0==Mr(Lr(s,o),i))return;let l=e.display.view,a=r.line>=e.display.viewFrom&&oc(e,r)||{node:l[0].measure.map[2],offset:0},c=i.line<e.display.viewTo&&oc(e,i);if(!c){let t=l[l.length-1].measure,e=t.maps?t.maps[t.maps.length-1]:t.map;c={node:e[e.length-1],offset:e[e.length-2]-e[e.length-3]}}if(!a||!c)return void t.removeAllRanges();let h,u=t.rangeCount&&t.getRangeAt(0);try{h=Ye(a.node,a.offset,c.offset,c.node)}catch(t){}h&&(!Me&&e.state.focused?(t.collapse(a.node,a.offset),h.collapsed||(t.removeAllRanges(),t.addRange(h))):(t.removeAllRanges(),t.addRange(h)),u&&null==t.anchorNode?t.addRange(u):Me&&this.startGracePeriod()),this.rememberSelection()}startGracePeriod(){clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(()=>{this.gracePeriod=!1,this.selectionChanged()&&this.cm.operation(()=>this.cm.curOp.selectionChanged=!0)},20)}showMultipleSelections(t){Qe(this.cm.display.cursorDiv,t.cursors),Qe(this.cm.display.selectionDiv,t.selection)}rememberSelection(){let t=this.getSelection();this.lastAnchorNode=t.anchorNode,this.lastAnchorOffset=t.anchorOffset,this.lastFocusNode=t.focusNode,this.lastFocusOffset=t.focusOffset}selectionInEditor(){let t=this.getSelection();if(!t.rangeCount)return!1;let e=t.getRangeAt(0).commonAncestorContainer;return en(this.div,e)}focus(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())}blur(){this.div.blur()}getField(){return this.div}supportsTouch(){return!0}receivedFocus(){let t=this;this.selectionInEditor()?this.pollSelection():wo(this.cm,()=>t.cm.curOp.selectionChanged=!0),this.polling.set(this.cm.options.pollInterval,function e(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,e))})}selectionChanged(){let t=this.getSelection();return t.anchorNode!=this.lastAnchorNode||t.anchorOffset!=this.lastAnchorOffset||t.focusNode!=this.lastFocusNode||t.focusOffset!=this.lastFocusOffset}pollSelection(){if(null!=this.readDOMTimeout||this.gracePeriod||!this.selectionChanged())return;let t=this.getSelection(),e=this.cm;if(We&&Pe&&this.cm.display.gutterSpecs.length&&function(t){for(let e=t;e;e=e.parentNode)if(/CodeMirror-gutter-wrapper/.test(e.className))return!0;return!1}(t.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),void this.focus();if(this.composing)return;this.rememberSelection();let n=ac(e,t.anchorNode,t.anchorOffset),r=ac(e,t.focusNode,t.focusOffset);n&&r&&wo(e,()=>{wl(e.doc,Xo(n,r),pn),(n.bad||r.bad)&&(e.curOp.selectionChanged=!0)})}pollContent(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);let t,e,n,r=this.cm,i=r.display,s=r.doc.sel.primary(),o=s.from(),l=s.to();if(0==o.ch&&o.line>r.firstLine()&&(o=Tr(o.line-1,yr(r.doc,o.line-1).length)),l.ch==yr(r.doc,l.line).text.length&&l.line<r.lastLine()&&(l=Tr(l.line+1,0)),o.line<i.viewFrom||l.line>i.viewTo-1)return!1;o.line==i.viewFrom||0==(t=Ps(r,o.line))?(e=wr(i.view[0].line),n=i.view[0].node):(e=wr(i.view[t].line),n=i.view[t-1].node.nextSibling);let a,c,h=Ps(r,l.line);if(h==i.view.length-1?(a=i.viewTo-1,c=i.lineDiv.lastChild):(a=wr(i.view[h+1].line)-1,c=i.view[h+1].node.previousSibling),!n)return!1;let u=r.doc.splitLines(function(t,e,n,r,i){let s="",o=!1,l=t.doc.lineSeparator(),a=!1;function c(){o&&(s+=l,a&&(s+=l),o=a=!1)}function h(t){t&&(c(),s+=t)}function u(e){if(1==e.nodeType){let s=e.getAttribute("cm-text");if(s)return void h(s);let d,f=e.getAttribute("cm-marker");if(f){let e=t.findMarks(Tr(r,0),Tr(i+1,0),(n=+f,t=>t.id==n));return void(e.length&&(d=e[0].find(0))&&h(vr(t.doc,d.from,d.to).join(l)))}if("false"==e.getAttribute("contenteditable"))return;let p=/^(pre|div|p|li|table|br)$/i.test(e.nodeName);if(!/^br$/i.test(e.nodeName)&&0==e.textContent.length)return;p&&c();for(let t=0;t<e.childNodes.length;t++)u(e.childNodes[t]);/^(pre|p)$/i.test(e.nodeName)&&(a=!0),p&&(o=!0)}else 3==e.nodeType&&h(e.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "));var n}for(;u(e),e!=n;)e=e.nextSibling,a=!1;return s}(r,n,c,e,a)),d=vr(r.doc,Tr(e,0),Tr(a,yr(r.doc,a).text.length));for(;u.length>1&&d.length>1;)if(bn(u)==bn(d))u.pop(),d.pop(),a--;else{if(u[0]!=d[0])break;u.shift(),d.shift(),e++}let f=0,p=0,g=u[0],m=d[0],y=Math.min(g.length,m.length);for(;f<y&&g.charCodeAt(f)==m.charCodeAt(f);)++f;let v=bn(u),x=bn(d),b=Math.min(v.length-(1==u.length?f:0),x.length-(1==d.length?f:0));for(;p<b&&v.charCodeAt(v.length-p-1)==x.charCodeAt(x.length-p-1);)++p;if(1==u.length&&1==d.length&&e==o.line)for(;f&&f>o.ch&&v.charCodeAt(v.length-p-1)==x.charCodeAt(x.length-p-1);)f--,p++;u[u.length-1]=v.slice(0,v.length-p).replace(/^\u200b+/,""),u[0]=u[0].slice(f).replace(/\u200b+$/,"");let w=Tr(e,f),C=Tr(a,d.length?bn(d).length-p:0);return u.length>1||u[0]||Mr(w,C)?(zl(r.doc,u,w,C,"+input"),!0):void 0}ensurePolled(){this.forceCompositionEnd()}reset(){this.forceCompositionEnd()}forceCompositionEnd(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())}readFromDOMSoon(){null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(()=>{if(this.readDOMTimeout=null,this.composing){if(!this.composing.done)return;this.composing=null}this.updateFromDOM()},80))}updateFromDOM(){!this.cm.isReadOnly()&&this.pollContent()||wo(this.cm,()=>Is(this.cm))}setUneditable(t){t.contentEditable="false"}onKeyPress(t){0==t.charCode||this.composing||(t.preventDefault(),this.cm.isReadOnly()||Co(this.cm,Za)(this.cm,String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),0))}readOnlyChanged(t){this.div.contentEditable=String("nocursor"!=t)}onContextMenu(){}resetPosition(){}}function oc(t,e){let n=es(t,e.line);if(!n||n.hidden)return null;let r=yr(t.doc,e.line),i=Ji(n,r,e.line),s=In(r,t.doc.direction),o="left";if(s){o=Dn(s,e.ch)%2?"right":"left"}let l=os(i.map,e.ch,o);return l.offset="right"==l.collapse?l.end:l.start,l}function lc(t,e){return e&&(t.bad=!0),t}function ac(t,e,n){let r;if(e==t.display.lineDiv){if(!(r=t.display.lineDiv.childNodes[n]))return lc(t.clipPos(Tr(t.display.viewTo-1)),!0);e=null,n=0}else for(r=e;;r=r.parentNode){if(!r||r==t.display.lineDiv)return null;if(r.parentNode&&r.parentNode==t.display.lineDiv)break}for(let i=0;i<t.display.view.length;i++){let s=t.display.view[i];if(s.node==r)return cc(s,e,n)}}function cc(t,e,n){let r=t.text.firstChild,i=!1;if(!e||!en(r,e))return lc(Tr(wr(t.line),0),!0);if(e==r&&(i=!0,e=r.childNodes[n],n=0,!e)){let e=t.rest?bn(t.rest):t.line;return lc(Tr(wr(e),e.text.length),i)}let s=3==e.nodeType?e:null,o=e;for(s||1!=e.childNodes.length||3!=e.firstChild.nodeType||(s=e.firstChild,n&&(n=s.nodeValue.length));o.parentNode!=r;)o=o.parentNode;let l=t.measure,a=l.maps;function c(e,n,r){for(let i=-1;i<(a?a.length:0);i++){let s=i<0?l.map:a[i];for(let o=0;o<s.length;o+=3){let l=s[o+2];if(l==e||l==n){let n=wr(i<0?t.line:t.rest[i]),a=s[o]+r;return(r<0||l!=e)&&(a=s[o+(r?1:0)]),Tr(n,a)}}}}let h=c(s,o,n);if(h)return lc(h,i);for(let t=o.nextSibling,e=s?s.nodeValue.length-n:0;t;t=t.nextSibling){if(h=c(t,t.firstChild,0))return lc(Tr(h.line,h.ch-e),i);e+=t.textContent.length}for(let t=o.previousSibling,e=n;t;t=t.previousSibling){if(h=c(t,t.firstChild,-1))return lc(Tr(h.line,h.ch+e),i);e+=t.textContent.length}}sc.prototype.needsContentAttribute=!0;class hc{constructor(t){this.cm=t,this.prevInput="",this.pollingFast=!1,this.polling=new hn,this.hasSelection=!1,this.composing=null}init(t){let e=this,n=this.cm;this.createField(t);const r=this.textarea;function i(t){if(!jn(n,t)){if(n.somethingSelected())Ka({lineWise:!1,text:n.getSelections()});else{if(!n.options.lineWiseCopyCut)return;{let i=tc(n);Ka({lineWise:!0,text:i.text}),"cut"==t.type?n.setSelections(i.ranges,null,pn):(e.prevInput="",r.value=i.text.join("\n"),on(r))}}"cut"==t.type&&(n.state.cutIncoming=+new Date)}}t.wrapper.insertBefore(this.wrapper,t.wrapper.firstChild),Fe&&(r.style.width="0px"),Rn(r,"input",()=>{Ae&&_e>=9&&this.hasSelection&&(this.hasSelection=null),e.poll()}),Rn(r,"paste",t=>{jn(n,t)||Qa(t,n)||(n.state.pasteIncoming=+new Date,e.fastPoll())}),Rn(r,"cut",i),Rn(r,"copy",i),Rn(t.scroller,"paste",i=>{if(qi(t,i)||jn(n,i))return;if(!r.dispatchEvent)return n.state.pasteIncoming=+new Date,void e.focus();const s=new Event("paste");s.clipboardData=i.clipboardData,r.dispatchEvent(s)}),Rn(t.lineSpace,"selectstart",e=>{qi(t,e)||Gn(e)}),Rn(r,"compositionstart",()=>{let t=n.getCursor("from");e.composing&&e.composing.range.clear(),e.composing={start:t,range:n.markText(t,n.getCursor("to"),{className:"CodeMirror-composing"})}}),Rn(r,"compositionend",()=>{e.composing&&(e.poll(),e.composing.range.clear(),e.composing=null)})}createField(t){this.wrapper=nc(),this.textarea=this.wrapper.firstChild}prepareSelection(){let t=this.cm,e=t.display,n=t.doc,r=js(t);if(t.options.moveInputWithCursor){let i=ys(t,n.sel.primary().head,"div"),s=e.wrapper.getBoundingClientRect(),o=e.lineDiv.getBoundingClientRect();r.teTop=Math.max(0,Math.min(e.wrapper.clientHeight-10,i.top+o.top-s.top)),r.teLeft=Math.max(0,Math.min(e.wrapper.clientWidth-10,i.left+o.left-s.left))}return r}showSelection(t){let e=this.cm.display;Qe(e.cursorDiv,t.cursors),Qe(e.selectionDiv,t.selection),null!=t.teTop&&(this.wrapper.style.top=t.teTop+"px",this.wrapper.style.left=t.teLeft+"px")}reset(t){if(this.contextMenuPending||this.composing)return;let e=this.cm;if(e.somethingSelected()){this.prevInput="";let t=e.getSelection();this.textarea.value=t,e.state.focused&&on(this.textarea),Ae&&_e>=9&&(this.hasSelection=t)}else t||(this.prevInput=this.textarea.value="",Ae&&_e>=9&&(this.hasSelection=null))}getField(){return this.textarea}supportsTouch(){return!1}focus(){if("nocursor"!=this.cm.options.readOnly&&(!je||nn()!=this.textarea))try{this.textarea.focus()}catch(t){}}blur(){this.textarea.blur()}resetPosition(){this.wrapper.style.top=this.wrapper.style.left=0}receivedFocus(){this.slowPoll()}slowPoll(){this.pollingFast||this.polling.set(this.cm.options.pollInterval,()=>{this.poll(),this.cm.state.focused&&this.slowPoll()})}fastPoll(){let t=!1,e=this;e.pollingFast=!0,e.polling.set(20,function n(){e.poll()||t?(e.pollingFast=!1,e.slowPoll()):(t=!0,e.polling.set(60,n))})}poll(){let t=this.cm,e=this.textarea,n=this.prevInput;if(this.contextMenuPending||!t.state.focused||rr(e)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;let r=e.value;if(r==n&&!t.somethingSelected())return!1;if(Ae&&_e>=9&&this.hasSelection===r||Be&&/[\uf700-\uf7ff]/.test(r))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){let t=r.charCodeAt(0);if(8203!=t||n||(n="​"),8666==t)return this.reset(),this.cm.execCommand("undo")}let i=0,s=Math.min(n.length,r.length);for(;i<s&&n.charCodeAt(i)==r.charCodeAt(i);)++i;return wo(t,()=>{Za(t,r.slice(i),n.length-i,null,this.composing?"*compose":null),r.length>1e3||r.indexOf("\n")>-1?e.value=this.prevInput="":this.prevInput=r,this.composing&&(this.composing.range.clear(),this.composing.range=t.markText(this.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0}ensurePolled(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)}onKeyPress(){Ae&&_e>=9&&(this.hasSelection=null),this.fastPoll()}onContextMenu(t){let e=this,n=e.cm,r=n.display,i=e.textarea;e.contextMenuPending&&e.contextMenuPending();let s=Ds(n,t),o=r.scroller.scrollTop;if(!s||Ie)return;n.options.resetSelectionOnContextMenu&&-1==n.doc.sel.contains(s)&&Co(n,wl)(n.doc,Xo(s),pn);let l,a=i.style.cssText,c=e.wrapper.style.cssText,h=e.wrapper.offsetParent.getBoundingClientRect();function u(){if(null!=i.selectionStart){let t=n.somethingSelected(),s="​"+(t?i.value:"");i.value="⇚",i.value=s,e.prevInput=t?"":"​",i.selectionStart=1,i.selectionEnd=s.length,r.selForContextMenu=n.doc.sel}}function d(){if(e.contextMenuPending==d&&(e.contextMenuPending=!1,e.wrapper.style.cssText=c,i.style.cssText=a,Ae&&_e<9&&r.scrollbars.setScrollTop(r.scroller.scrollTop=o),null!=i.selectionStart)){(!Ae||Ae&&_e<9)&&u();let t=0,s=()=>{r.selForContextMenu==n.doc.sel&&0==i.selectionStart&&i.selectionEnd>0&&"​"==e.prevInput?Co(n,Ll)(n):t++<10?r.detectingSelectAll=setTimeout(s,500):(r.selForContextMenu=null,r.input.reset())};r.detectingSelectAll=setTimeout(s,200)}}if(e.wrapper.style.cssText="position: static",i.style.cssText=`position: absolute; width: 30px; height: 30px;\n      top: ${t.clientY-h.top-5}px; left: ${t.clientX-h.left-5}px;\n      z-index: 1000; background: ${Ae?"rgba(255, 255, 255, .05)":"transparent"};\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`,Ee&&(l=window.scrollY),r.input.focus(),Ee&&window.scrollTo(null,l),r.input.reset(),n.somethingSelected()||(i.value=e.prevInput=" "),e.contextMenuPending=d,r.selForContextMenu=n.doc.sel,clearTimeout(r.detectingSelectAll),Ae&&_e>=9&&u(),Xe){$n(t);let e=()=>{Fn(window,"mouseup",e),setTimeout(d,20)};Rn(window,"mouseup",e)}else setTimeout(d,50)}readOnlyChanged(t){t||this.reset(),this.textarea.disabled="nocursor"==t}setUneditable(){}}hc.prototype.needsContentAttribute=!1,function(t){let e=t.optionHandlers;function n(n,r,i,s){t.defaults[n]=r,i&&(e[n]=s?(t,e,n)=>{n!=ja&&i(t,e,n)}:i)}t.defineOption=n,t.Init=ja,n("value","",(t,e)=>t.setValue(e),!0),n("mode",null,(t,e)=>{t.doc.modeOption=e,Qo(t)},!0),n("indentUnit",2,Qo,!0),n("indentWithTabs",!1),n("smartIndent",!0),n("tabSize",4,t=>{Jo(t),hs(t),Is(t)},!0),n("lineSeparator",null,(t,e)=>{if(t.doc.lineSep=e,!e)return;let n=[],r=t.doc.first;t.doc.iter(t=>{for(let i=0;;){let s=t.text.indexOf(e,i);if(-1==s)break;i=s+e.length,n.push(Tr(r,s))}r++});for(let r=n.length-1;r>=0;r--)zl(t.doc,e,n[r],Tr(n[r].line,n[r].ch+e.length))}),n("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,(t,e,n)=>{t.state.specialChars=new RegExp(e.source+(e.test("\t")?"":"|\t"),"g"),n!=ja&&t.refresh()}),n("specialCharPlaceholder",Si,t=>t.refresh(),!0),n("electricChars",!0),n("inputStyle",je?"contenteditable":"textarea",()=>{throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),n("spellcheck",!1,(t,e)=>t.getInputField().spellcheck=e,!0),n("autocorrect",!1,(t,e)=>t.getInputField().autocorrect=e,!0),n("autocapitalize",!1,(t,e)=>t.getInputField().autocapitalize=e,!0),n("rtlMoveVisually",!Ve),n("wholeLineUpdateBefore",!0),n("theme","default",t=>{Wa(t),Ro(t)},!0),n("keyMap","default",(t,e,n)=>{let r=pa(e),i=n!=ja&&pa(n);i&&i.detach&&i.detach(t,r),r.attach&&r.attach(t,i||null)}),n("extraKeys",null),n("configureMouse",null),n("lineWrapping",!1,Ga,!0),n("gutters",[],(t,e)=>{t.display.gutterSpecs=Io(e,t.options.lineNumbers),Ro(t)},!0),n("fixedGutter",!0,(t,e)=>{t.display.gutters.style.left=e?As(t.display)+"px":"0",t.refresh()},!0),n("coverGutterNextToScrollbar",!1,t=>co(t),!0),n("scrollbarStyle","native",t=>{fo(t),co(t),t.display.scrollbars.setScrollTop(t.doc.scrollTop),t.display.scrollbars.setScrollLeft(t.doc.scrollLeft)},!0),n("lineNumbers",!1,(t,e)=>{t.display.gutterSpecs=Io(t.options.gutters,e),Ro(t)},!0),n("firstLineNumber",1,Ro,!0),n("lineNumberFormatter",t=>t,Ro,!0),n("showCursorWhenSelecting",!1,Ws,!0),n("resetSelectionOnContextMenu",!0),n("lineWiseCopyCut",!0),n("pasteLinesPerSelection",!0),n("selectionsMayTouch",!1),n("readOnly",!1,(t,e)=>{"nocursor"==e&&(Ys(t),t.display.input.blur()),t.display.input.readOnlyChanged(e)}),n("disableInput",!1,(t,e)=>{e||t.display.input.reset()},!0),n("dragDrop",!0,Va),n("allowDropFileTypes",null),n("cursorBlinkRate",530),n("cursorScrollMargin",0),n("cursorHeight",1,Ws,!0),n("singleCursorHeightPerLine",!0,Ws,!0),n("workTime",100),n("workDelay",100),n("flattenSpans",!0,Jo,!0),n("addModeClass",!1,Jo,!0),n("pollInterval",100),n("undoDepth",200,(t,e)=>t.doc.history.undoDepth=e),n("historyEventDelay",1250),n("viewportMargin",10,t=>t.refresh(),!0),n("maxHighlightLength",1e4,Jo,!0),n("moveInputWithCursor",!0,(t,e)=>{e||t.display.input.resetPosition()}),n("tabindex",null,(t,e)=>t.display.input.getField().tabIndex=e||""),n("autofocus",null),n("direction","ltr",(t,e)=>t.doc.setDirection(e),!0),n("phrases",null)}(qa),function(t){let e=t.optionHandlers,n=t.helpers={};t.prototype={constructor:t,focus:function(){window.focus(),this.display.input.focus()},setOption:function(t,n){let r=this.options,i=r[t];r[t]==n&&"mode"!=t||(r[t]=n,e.hasOwnProperty(t)&&Co(this,e[t])(this,n,i),Wn(this,"optionChange",this,t))},getOption:function(t){return this.options[t]},getDoc:function(){return this.doc},addKeyMap:function(t,e){this.state.keyMaps[e?"push":"unshift"](pa(t))},removeKeyMap:function(t){let e=this.state.keyMaps;for(let n=0;n<e.length;++n)if(e[n]==t||e[n].name==t)return e.splice(n,1),!0},addOverlay:So(function(e,n){let r=e.token?e:t.getMode(this.options,e);if(r.startState)throw new Error("Overlays may not be stateful.");!function(t,e,n){let r=0,i=n(e);for(;r<t.length&&n(t[r])<=i;)r++;t.splice(r,0,e)}(this.state.overlays,{mode:r,modeSpec:e,opaque:n&&n.opaque,priority:n&&n.priority||0},t=>t.priority),this.state.modeGen++,Is(this)}),removeOverlay:So(function(t){let e=this.state.overlays;for(let n=0;n<e.length;++n){let r=e[n].modeSpec;if(r==t||"string"==typeof t&&r.name==t)return e.splice(n,1),this.state.modeGen++,void Is(this)}}),indentLine:So(function(t,e,n){"string"!=typeof e&&"number"!=typeof e&&(e=null==e?this.options.smartIndent?"smart":"prev":e?"add":"subtract"),Sr(this.doc,t)&&$a(this,t,e,n)}),indentSelection:So(function(t){let e=this.doc.sel.ranges,n=-1;for(let r=0;r<e.length;r++){let i=e[r];if(i.empty())i.head.line>n&&($a(this,i.head.line,t,!0),n=i.head.line,r==this.doc.sel.primIndex&&eo(this));else{let s=i.from(),o=i.to(),l=Math.max(n,s.line);n=Math.min(this.lastLine(),o.line-(o.ch?0:1))+1;for(let e=l;e<n;++e)$a(this,e,t);let a=this.doc.sel.ranges;0==s.ch&&e.length==a.length&&a[r].from().ch>0&&vl(this.doc,r,new Go(s,a[r].to()),pn)}}}),getTokenAt:function(t,e){return Ur(this,t,e)},getLineTokens:function(t,e){return Ur(this,Tr(t),e,!0)},getTokenTypeAt:function(t){t=Er(this.doc,t);let e,n=Rr(this,yr(this.doc,t.line)),r=0,i=(n.length-1)/2,s=t.ch;if(0==s)e=n[2];else for(;;){let t=r+i>>1;if((t?n[2*t-1]:0)>=s)i=t;else{if(!(n[2*t+1]<s)){e=n[2*t+2];break}r=t+1}}let o=e?e.indexOf("overlay "):-1;return o<0?e:0==o?null:e.slice(0,o-1)},getModeAt:function(e){let n=this.doc.mode;return n.innerMode?t.innerMode(n,this.getTokenAt(e).state).mode:n},getHelper:function(t,e){return this.getHelpers(t,e)[0]},getHelpers:function(t,e){let r=[];if(!n.hasOwnProperty(e))return r;let i=n[e],s=this.getModeAt(t);if("string"==typeof s[e])i[s[e]]&&r.push(i[s[e]]);else if(s[e])for(let t=0;t<s[e].length;t++){let n=i[s[e][t]];n&&r.push(n)}else s.helperType&&i[s.helperType]?r.push(i[s.helperType]):i[s.name]&&r.push(i[s.name]);for(let t=0;t<i._global.length;t++){let e=i._global[t];e.pred(s,this)&&-1==un(r,e.val)&&r.push(e.val)}return r},getStateAfter:function(t,e){let n=this.doc;return Hr(this,(t=_r(n,null==t?n.first+n.size-1:t))+1,e).state},cursorCoords:function(t,e){let n,r=this.doc.sel.primary();return ys(this,n=null==t?r.head:"object"==typeof t?Er(this.doc,t):t?r.from():r.to(),e||"page")},charCoords:function(t,e){return ms(this,Er(this.doc,t),e||"page")},coordsChar:function(t,e){return bs(this,(t=gs(this,t,e||"page")).left,t.top)},lineAtHeight:function(t,e){return t=gs(this,{top:t,left:0},e||"page").top,Cr(this.doc,t+this.display.viewOffset)},heightAtLine:function(t,e,n){let r,i=!1;if("number"==typeof t){let e=this.doc.first+this.doc.size-1;t<this.doc.first?t=this.doc.first:t>e&&(t=e,i=!0),r=yr(this.doc,t)}else r=t;return ps(this,r,{top:0,left:0},e||"page",n||i).top+(i?this.doc.height-pi(r):0)},defaultTextHeight:function(){return ks(this.display)},defaultCharWidth:function(){return Ns(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(t,e,n,r,i){let s=this.display,o=(t=ys(this,Er(this.doc,t))).bottom,l=t.left;if(e.style.position="absolute",e.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(e),s.sizer.appendChild(e),"over"==r)o=t.top;else if("above"==r||"near"==r){let n=Math.max(s.wrapper.clientHeight,this.doc.height),i=Math.max(s.sizer.clientWidth,s.lineSpace.clientWidth);("above"==r||t.bottom+e.offsetHeight>n)&&t.top>e.offsetHeight?o=t.top-e.offsetHeight:t.bottom+e.offsetHeight<=n&&(o=t.bottom),l+e.offsetWidth>i&&(l=i-e.offsetWidth)}e.style.top=o+"px",e.style.left=e.style.right="","right"==i?(l=s.sizer.clientWidth-e.offsetWidth,e.style.right="0px"):("left"==i?l=0:"middle"==i&&(l=(s.sizer.clientWidth-e.offsetWidth)/2),e.style.left=l+"px"),n&&function(t,e){let n=Js(t,e);null!=n.scrollTop&&so(t,n.scrollTop),null!=n.scrollLeft&&lo(t,n.scrollLeft)}(this,{left:l,top:o,right:l+e.offsetWidth,bottom:o+e.offsetHeight})},triggerOnKeyDown:So(Na),triggerOnKeyPress:So(Aa),triggerOnKeyUp:La,triggerOnMouseDown:So(Ia),execCommand:function(t){if(xa.hasOwnProperty(t))return xa[t].call(null,this)},triggerElectric:So(function(t){Ja(this,t)}),findPosH:function(t,e,n,r){let i=1;e<0&&(i=-1,e=-e);let s=Er(this.doc,t);for(let t=0;t<e&&!(s=rc(this.doc,s,i,n,r)).hitSide;++t);return s},moveH:So(function(t,e){this.extendSelectionsBy(n=>this.display.shift||this.doc.extend||n.empty()?rc(this.doc,n.head,t,e,this.options.rtlMoveVisually):t<0?n.from():n.to(),mn)}),deleteH:So(function(t,e){let n=this.doc.sel,r=this.doc;n.somethingSelected()?r.replaceSelection("",null,"+delete"):ga(this,n=>{let i=rc(r,n.head,t,e,!1);return t<0?{from:i,to:n.head}:{from:n.head,to:i}})}),findPosV:function(t,e,n,r){let i=1,s=r;e<0&&(i=-1,e=-e);let o=Er(this.doc,t);for(let t=0;t<e;++t){let t=ys(this,o,"div");if(null==s?s=t.left:t.left=s,(o=ic(this,t,i,n)).hitSide)break}return o},moveV:So(function(t,e){let n=this.doc,r=[],i=!this.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(s=>{if(i)return t<0?s.from():s.to();let o=ys(this,s.head,"div");null!=s.goalColumn&&(o.left=s.goalColumn),r.push(o.left);let l=ic(this,o,t,e);return"page"==e&&s==n.sel.primary()&&to(this,ms(this,l,"div").top-o.top),l},mn),r.length)for(let t=0;t<n.sel.ranges.length;t++)n.sel.ranges[t].goalColumn=r[t]}),findWordAt:function(t){let e=yr(this.doc,t.line).text,n=t.ch,r=t.ch;if(e){let i=this.getHelper(t,"wordChars");"before"!=t.sticky&&r!=e.length||!n?++r:--n;let s=e.charAt(n),o=Mn(s,i)?t=>Mn(t,i):/\s/.test(s)?t=>/\s/.test(t):t=>!/\s/.test(t)&&!Mn(t);for(;n>0&&o(e.charAt(n-1));)--n;for(;r<e.length&&o(e.charAt(r));)++r}return new Go(Tr(t.line,n),Tr(t.line,r))},toggleOverwrite:function(t){null!=t&&t==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?rn(this.display.cursorDiv,"CodeMirror-overwrite"):Ke(this.display.cursorDiv,"CodeMirror-overwrite"),Wn(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==nn()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:So(function(t,e){no(this,t,e)}),getScrollInfo:function(){let t=this.display.scroller;return{left:t.scrollLeft,top:t.scrollTop,height:t.scrollHeight-Ki(this)-this.display.barHeight,width:t.scrollWidth-Ki(this)-this.display.barWidth,clientHeight:Qi(this),clientWidth:Zi(this)}},scrollIntoView:So(function(t,e){null==t?(t={from:this.doc.sel.primary().head,to:null},null==e&&(e=this.options.cursorScrollMargin)):"number"==typeof t?t={from:Tr(t,0),to:null}:null==t.from&&(t={from:t,to:null}),t.to||(t.to=t.from),t.margin=e||0,null!=t.from.line?function(t,e){ro(t),t.curOp.scrollToPos=e}(this,t):io(this,t.from,t.to,t.margin)}),setSize:So(function(t,e){let n=t=>"number"==typeof t||/^\d+$/.test(String(t))?t+"px":t;null!=t&&(this.display.wrapper.style.width=n(t)),null!=e&&(this.display.wrapper.style.height=n(e)),this.options.lineWrapping&&cs(this);let r=this.display.viewFrom;this.doc.iter(r,this.display.viewTo,t=>{if(t.widgets)for(let e=0;e<t.widgets.length;e++)if(t.widgets[e].noHScroll){zs(this,r,"widget");break}++r}),this.curOp.forceUpdate=!0,Wn(this,"refresh",this)}),operation:function(t){return wo(this,t)},startOperation:function(){return go(this)},endOperation:function(){return mo(this)},refresh:So(function(){let t=this.display.cachedTextHeight;Is(this),this.curOp.forceUpdate=!0,hs(this),no(this,this.doc.scrollLeft,this.doc.scrollTop),_o(this.display),(null==t||Math.abs(t-ks(this.display))>.5)&&Es(this),Wn(this,"refresh",this)}),swapDoc:So(function(t){let e=this.doc;return e.cm=null,this.state.selectingText&&this.state.selectingText(),rl(this,t),hs(this),this.display.input.reset(),no(this,t.scrollLeft,t.scrollTop),this.curOp.forceScroll=!0,Ei(this,"swapDoc",this,e),e}),phrase:function(t){let e=this.options.phrases;return e&&Object.prototype.hasOwnProperty.call(e,t)?e[t]:t},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Vn(t),t.registerHelper=function(e,r,i){n.hasOwnProperty(e)||(n[e]=t[e]={_global:[]}),n[e][r]=i},t.registerGlobalHelper=function(e,r,i,s){t.registerHelper(e,r,s),n[e]._global.push({pred:i,val:s})}}(qa);let uc="iter insert remove copy getEditor constructor".split(" ");for(let t in Ql.prototype)Ql.prototype.hasOwnProperty(t)&&un(uc,t)<0&&(qa.prototype[t]=function(t){return function(){return t.apply(this.doc,arguments)}}(Ql.prototype[t]));var dc;Vn(Ql),qa.inputStyles={textarea:hc,contenteditable:sc},qa.defineMode=function(t){qa.defaults.mode||"null"==t||(qa.defaults.mode=t),ar.apply(this,arguments)},qa.defineMIME=function(t,e){lr[t]=e},qa.defineMode("null",()=>({token:t=>t.skipToEnd()})),qa.defineMIME("text/plain","null"),qa.defineExtension=(t,e)=>{qa.prototype[t]=e},qa.defineDocExtension=(t,e)=>{Ql.prototype[t]=e},qa.fromTextArea=function(t,e){if((e=e?an(e):{}).value=t.value,!e.tabindex&&t.tabIndex&&(e.tabindex=t.tabIndex),!e.placeholder&&t.placeholder&&(e.placeholder=t.placeholder),null==e.autofocus){let n=nn();e.autofocus=n==t||null!=t.getAttribute("autofocus")&&n==document.body}function n(){t.value=i.getValue()}let r;if(t.form&&(Rn(t.form,"submit",n),!e.leaveSubmitMethodAlone)){let e=t.form;r=e.submit;try{let t=e.submit=()=>{n(),e.submit=r,e.submit(),e.submit=t}}catch(t){}}e.finishInit=e=>{e.save=n,e.getTextArea=()=>t,e.toTextArea=()=>{e.toTextArea=isNaN,n(),t.parentNode.removeChild(e.getWrapperElement()),t.style.display="",t.form&&(Fn(t.form,"submit",n),"function"==typeof t.form.submit&&(t.form.submit=r))}},t.style.display="none";let i=qa(e=>t.parentNode.insertBefore(e,t.nextSibling),e);return i},function(t){t.off=Fn,t.on=Rn,t.wheelEventPixels=Bo,t.Doc=Ql,t.splitLines=nr,t.countColumn=cn,t.findColumn=yn,t.isWordChar=Tn,t.Pass=fn,t.signal=Wn,t.Line=yi,t.changeEnd=$o,t.scrollbarModel=uo,t.Pos=Tr,t.cmpPos=Mr,t.modes=or,t.mimeModes=lr,t.resolveMode=cr,t.getMode=hr,t.modeExtensions=ur,t.extendMode=dr,t.copyState=fr,t.startState=gr,t.innerMode=pr,t.commands=xa,t.keyMap=la,t.keyName=fa,t.isModifierKey=ua,t.lookupKey=ha,t.normalizeKeyMap=ca,t.StringStream=mr,t.SharedTextMarker=$l,t.TextMarker=ql,t.LineWidget=Ul,t.e_preventDefault=Gn,t.e_stopPropagation=qn,t.e_stop=$n,t.addClass=rn,t.contains=en,t.rmClass=Ke,t.keyNames=oa}(qa),qa.version="5.48.0",dc=function(t){var e={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},n={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};t.defineMode("xml",function(r,i){var s,o,l=r.indentUnit,a={},c=i.htmlMode?e:n;for(var h in c)a[h]=c[h];for(var h in i)a[h]=i[h];function u(t,e){function n(n){return e.tokenize=n,n(t,e)}var r=t.next();return"<"==r?t.eat("!")?t.eat("[")?t.match("CDATA[")?n(f("atom","]]>")):null:t.match("--")?n(f("comment","--\x3e")):t.match("DOCTYPE",!0,!0)?(t.eatWhile(/[\w\._\-]/),n(function t(e){return function(n,r){for(var i;null!=(i=n.next());){if("<"==i)return r.tokenize=t(e+1),r.tokenize(n,r);if(">"==i){if(1==e){r.tokenize=u;break}return r.tokenize=t(e-1),r.tokenize(n,r)}}return"meta"}}(1))):null:t.eat("?")?(t.eatWhile(/[\w\._\-]/),e.tokenize=f("meta","?>"),"meta"):(s=t.eat("/")?"closeTag":"openTag",e.tokenize=d,"tag bracket"):"&"==r?(t.eat("#")?t.eat("x")?t.eatWhile(/[a-fA-F\d]/)&&t.eat(";"):t.eatWhile(/[\d]/)&&t.eat(";"):t.eatWhile(/[\w\.\-:]/)&&t.eat(";"))?"atom":"error":(t.eatWhile(/[^&<]/),null)}function d(t,e){var n,r,i=t.next();if(">"==i||"/"==i&&t.eat(">"))return e.tokenize=u,s=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return s="equals",null;if("<"==i){e.tokenize=u,e.state=y,e.tagName=e.tagStart=null;var o=e.tokenize(t,e);return o?o+" tag error":"tag error"}return/[\'\"]/.test(i)?(e.tokenize=(n=i,(r=function(t,e){for(;!t.eol();)if(t.next()==n){e.tokenize=d;break}return"string"}).isInAttribute=!0,r),e.stringStartCol=t.column(),e.tokenize(t,e)):(t.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function f(t,e){return function(n,r){for(;!n.eol();){if(n.match(e)){r.tokenize=u;break}n.next()}return t}}function p(t,e,n){this.prev=t.context,this.tagName=e,this.indent=t.indented,this.startOfLine=n,(a.doNotIndent.hasOwnProperty(e)||t.context&&t.context.noIndent)&&(this.noIndent=!0)}function g(t){t.context&&(t.context=t.context.prev)}function m(t,e){for(var n;;){if(!t.context)return;if(n=t.context.tagName,!a.contextGrabbers.hasOwnProperty(n)||!a.contextGrabbers[n].hasOwnProperty(e))return;g(t)}}function y(t,e,n){return"openTag"==t?(n.tagStart=e.column(),v):"closeTag"==t?x:y}function v(t,e,n){return"word"==t?(n.tagName=e.current(),o="tag",C):a.allowMissingTagName&&"endTag"==t?(o="tag bracket",C(t,0,n)):(o="error",v)}function x(t,e,n){if("word"==t){var r=e.current();return n.context&&n.context.tagName!=r&&a.implicitlyClosed.hasOwnProperty(n.context.tagName)&&g(n),n.context&&n.context.tagName==r||!1===a.matchClosing?(o="tag",b):(o="tag error",w)}return a.allowMissingTagName&&"endTag"==t?(o="tag bracket",b(t,0,n)):(o="error",w)}function b(t,e,n){return"endTag"!=t?(o="error",b):(g(n),y)}function w(t,e,n){return o="error",b(t,0,n)}function C(t,e,n){if("word"==t)return o="attribute",S;if("endTag"==t||"selfcloseTag"==t){var r=n.tagName,i=n.tagStart;return n.tagName=n.tagStart=null,"selfcloseTag"==t||a.autoSelfClosers.hasOwnProperty(r)?m(n,r):(m(n,r),n.context=new p(n,r,i==n.indented)),y}return o="error",C}function S(t,e,n){return"equals"==t?O:(a.allowMissing||(o="error"),C(t,0,n))}function O(t,e,n){return"string"==t?T:"word"==t&&a.allowUnquoted?(o="string",C):(o="error",C(t,0,n))}function T(t,e,n){return"string"==t?T:C(t,0,n)}return u.isInText=!0,{startState:function(t){var e={tokenize:u,state:y,indented:t||0,tagName:null,tagStart:null,context:null};return null!=t&&(e.baseIndent=t),e},token:function(t,e){if(!e.tagName&&t.sol()&&(e.indented=t.indentation()),t.eatSpace())return null;s=null;var n=e.tokenize(t,e);return(n||s)&&"comment"!=n&&(o=null,e.state=e.state(s||n,t,e),o&&(n="error"==o?n+" error":o)),n},indent:function(e,n,r){var i=e.context;if(e.tokenize.isInAttribute)return e.tagStart==e.indented?e.stringStartCol+1:e.indented+l;if(i&&i.noIndent)return t.Pass;if(e.tokenize!=d&&e.tokenize!=u)return r?r.match(/^(\s*)/)[0].length:0;if(e.tagName)return!1!==a.multilineTagIndentPastTag?e.tagStart+e.tagName.length+2:e.tagStart+l*(a.multilineTagIndentFactor||1);if(a.alignCDATA&&/<!\[CDATA\[/.test(n))return 0;var s=n&&/^<(\/)?([\w_:\.-]*)/.exec(n);if(s&&s[1])for(;i;){if(i.tagName==s[2]){i=i.prev;break}if(!a.implicitlyClosed.hasOwnProperty(i.tagName))break;i=i.prev}else if(s)for(;i;){var o=a.contextGrabbers[i.tagName];if(!o||!o.hasOwnProperty(s[2]))break;i=i.prev}for(;i&&i.prev&&!i.startOfLine;)i=i.prev;return i?i.indent+l:e.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"\x3c!--",blockCommentEnd:"--\x3e",configuration:a.htmlMode?"html":"xml",helperType:a.htmlMode?"html":"xml",skipAttribute:function(t){t.state==O&&(t.state=C)}}}),t.defineMIME("text/xml","xml"),t.defineMIME("application/xml","xml"),t.mimeModes.hasOwnProperty("text/html")||t.defineMIME("text/html",{name:"xml",htmlMode:!0})},"object"==typeof exports&&"object"==typeof module?dc(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],dc):dc(qa);var fc=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32};fc.Diff=function(t,e){this[0]=t,this[1]=e},fc.Diff.prototype.length=2,fc.Diff.prototype.toString=function(){return this[0]+","+this[1]},fc.prototype.diff_main=function(t,e,n,r){void 0===r&&(r=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var i=r;if(null==t||null==e)throw new Error("Null input. (diff_main)");if(t==e)return t?[new fc.Diff(0,t)]:[];void 0===n&&(n=!0);var s=n,o=this.diff_commonPrefix(t,e),l=t.substring(0,o);t=t.substring(o),e=e.substring(o),o=this.diff_commonSuffix(t,e);var a=t.substring(t.length-o);t=t.substring(0,t.length-o),e=e.substring(0,e.length-o);var c=this.diff_compute_(t,e,s,i);return l&&c.unshift(new fc.Diff(0,l)),a&&c.push(new fc.Diff(0,a)),this.diff_cleanupMerge(c),c},fc.prototype.diff_compute_=function(t,e,n,r){var i;if(!t)return[new fc.Diff(1,e)];if(!e)return[new fc.Diff(-1,t)];var s=t.length>e.length?t:e,o=t.length>e.length?e:t,l=s.indexOf(o);if(-1!=l)return i=[new fc.Diff(1,s.substring(0,l)),new fc.Diff(0,o),new fc.Diff(1,s.substring(l+o.length))],t.length>e.length&&(i[0][0]=i[2][0]=-1),i;if(1==o.length)return[new fc.Diff(-1,t),new fc.Diff(1,e)];var a=this.diff_halfMatch_(t,e);if(a){var c=a[0],h=a[1],u=a[2],d=a[3],f=a[4],p=this.diff_main(c,u,n,r),g=this.diff_main(h,d,n,r);return p.concat([new fc.Diff(0,f)],g)}return n&&t.length>100&&e.length>100?this.diff_lineMode_(t,e,r):this.diff_bisect_(t,e,r)},fc.prototype.diff_lineMode_=function(t,e,n){var r=this.diff_linesToChars_(t,e);t=r.chars1,e=r.chars2;var i=r.lineArray,s=this.diff_main(t,e,!1,n);this.diff_charsToLines_(s,i),this.diff_cleanupSemantic(s),s.push(new fc.Diff(0,""));for(var o=0,l=0,a=0,c="",h="";o<s.length;){switch(s[o][0]){case 1:a++,h+=s[o][1];break;case-1:l++,c+=s[o][1];break;case 0:if(l>=1&&a>=1){s.splice(o-l-a,l+a),o=o-l-a;for(var u=this.diff_main(c,h,!1,n),d=u.length-1;d>=0;d--)s.splice(o,0,u[d]);o+=u.length}a=0,l=0,c="",h=""}o++}return s.pop(),s},fc.prototype.diff_bisect_=function(t,e,n){for(var r=t.length,i=e.length,s=Math.ceil((r+i)/2),o=s,l=2*s,a=new Array(l),c=new Array(l),h=0;h<l;h++)a[h]=-1,c[h]=-1;a[o+1]=0,c[o+1]=0;for(var u=r-i,d=u%2!=0,f=0,p=0,g=0,m=0,y=0;y<s&&!((new Date).getTime()>n);y++){for(var v=-y+f;v<=y-p;v+=2){for(var x=o+v,b=(T=v==-y||v!=y&&a[x-1]<a[x+1]?a[x+1]:a[x-1]+1)-v;T<r&&b<i&&t.charAt(T)==e.charAt(b);)T++,b++;if(a[x]=T,T>r)p+=2;else if(b>i)f+=2;else if(d){if((S=o+u-v)>=0&&S<l&&-1!=c[S])if(T>=(C=r-c[S]))return this.diff_bisectSplit_(t,e,T,b,n)}}for(var w=-y+g;w<=y-m;w+=2){for(var C,S=o+w,O=(C=w==-y||w!=y&&c[S-1]<c[S+1]?c[S+1]:c[S-1]+1)-w;C<r&&O<i&&t.charAt(r-C-1)==e.charAt(i-O-1);)C++,O++;if(c[S]=C,C>r)m+=2;else if(O>i)g+=2;else if(!d){if((x=o+u-w)>=0&&x<l&&-1!=a[x]){var T;b=o+(T=a[x])-x;if(T>=(C=r-C))return this.diff_bisectSplit_(t,e,T,b,n)}}}}return[new fc.Diff(-1,t),new fc.Diff(1,e)]},fc.prototype.diff_bisectSplit_=function(t,e,n,r,i){var s=t.substring(0,n),o=e.substring(0,r),l=t.substring(n),a=e.substring(r),c=this.diff_main(s,o,!1,i),h=this.diff_main(l,a,!1,i);return c.concat(h)},fc.prototype.diff_linesToChars_=function(t,e){var n=[],r={};function i(t){for(var e="",i=0,o=-1,l=n.length;o<t.length-1;){-1==(o=t.indexOf("\n",i))&&(o=t.length-1);var a=t.substring(i,o+1);(r.hasOwnProperty?r.hasOwnProperty(a):void 0!==r[a])?e+=String.fromCharCode(r[a]):(l==s&&(a=t.substring(i),o=t.length),e+=String.fromCharCode(l),r[a]=l,n[l++]=a),i=o+1}return e}n[0]="";var s=4e4,o=i(t);return s=65535,{chars1:o,chars2:i(e),lineArray:n}},fc.prototype.diff_charsToLines_=function(t,e){for(var n=0;n<t.length;n++){for(var r=t[n][1],i=[],s=0;s<r.length;s++)i[s]=e[r.charCodeAt(s)];t[n][1]=i.join("")}},fc.prototype.diff_commonPrefix=function(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,s=0;n<i;)t.substring(s,i)==e.substring(s,i)?s=n=i:r=i,i=Math.floor((r-n)/2+n);return i},fc.prototype.diff_commonSuffix=function(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,r=Math.min(t.length,e.length),i=r,s=0;n<i;)t.substring(t.length-i,t.length-s)==e.substring(e.length-i,e.length-s)?s=n=i:r=i,i=Math.floor((r-n)/2+n);return i},fc.prototype.diff_commonOverlap_=function(t,e){var n=t.length,r=e.length;if(0==n||0==r)return 0;n>r?t=t.substring(n-r):n<r&&(e=e.substring(0,n));var i=Math.min(n,r);if(t==e)return i;for(var s=0,o=1;;){var l=t.substring(i-o),a=e.indexOf(l);if(-1==a)return s;o+=a,0!=a&&t.substring(i-o)!=e.substring(0,o)||(s=o,o++)}},fc.prototype.diff_halfMatch_=function(t,e){if(this.Diff_Timeout<=0)return null;var n=t.length>e.length?t:e,r=t.length>e.length?e:t;if(n.length<4||2*r.length<n.length)return null;var i=this;function s(t,e,n){for(var r,s,o,l,a=t.substring(n,n+Math.floor(t.length/4)),c=-1,h="";-1!=(c=e.indexOf(a,c+1));){var u=i.diff_commonPrefix(t.substring(n),e.substring(c)),d=i.diff_commonSuffix(t.substring(0,n),e.substring(0,c));h.length<d+u&&(h=e.substring(c-d,c)+e.substring(c,c+u),r=t.substring(0,n-d),s=t.substring(n+u),o=e.substring(0,c-d),l=e.substring(c+u))}return 2*h.length>=t.length?[r,s,o,l,h]:null}var o,l,a,c,h,u=s(n,r,Math.ceil(n.length/4)),d=s(n,r,Math.ceil(n.length/2));return u||d?(o=d?u&&u[4].length>d[4].length?u:d:u,t.length>e.length?(l=o[0],a=o[1],c=o[2],h=o[3]):(c=o[0],h=o[1],l=o[2],a=o[3]),[l,a,c,h,o[4]]):null},fc.prototype.diff_cleanupSemantic=function(t){for(var e=!1,n=[],r=0,i=null,s=0,o=0,l=0,a=0,c=0;s<t.length;)0==t[s][0]?(n[r++]=s,o=a,l=c,a=0,c=0,i=t[s][1]):(1==t[s][0]?a+=t[s][1].length:c+=t[s][1].length,i&&i.length<=Math.max(o,l)&&i.length<=Math.max(a,c)&&(t.splice(n[r-1],0,new fc.Diff(-1,i)),t[n[r-1]+1][0]=1,r--,s=--r>0?n[r-1]:-1,o=0,l=0,a=0,c=0,i=null,e=!0)),s++;for(e&&this.diff_cleanupMerge(t),this.diff_cleanupSemanticLossless(t),s=1;s<t.length;){if(-1==t[s-1][0]&&1==t[s][0]){var h=t[s-1][1],u=t[s][1],d=this.diff_commonOverlap_(h,u),f=this.diff_commonOverlap_(u,h);d>=f?(d>=h.length/2||d>=u.length/2)&&(t.splice(s,0,new fc.Diff(0,u.substring(0,d))),t[s-1][1]=h.substring(0,h.length-d),t[s+1][1]=u.substring(d),s++):(f>=h.length/2||f>=u.length/2)&&(t.splice(s,0,new fc.Diff(0,h.substring(0,f))),t[s-1][0]=1,t[s-1][1]=u.substring(0,u.length-f),t[s+1][0]=-1,t[s+1][1]=h.substring(f),s++),s++}s++}},fc.prototype.diff_cleanupSemanticLossless=function(t){function e(t,e){if(!t||!e)return 6;var n=t.charAt(t.length-1),r=e.charAt(0),i=n.match(fc.nonAlphaNumericRegex_),s=r.match(fc.nonAlphaNumericRegex_),o=i&&n.match(fc.whitespaceRegex_),l=s&&r.match(fc.whitespaceRegex_),a=o&&n.match(fc.linebreakRegex_),c=l&&r.match(fc.linebreakRegex_),h=a&&t.match(fc.blanklineEndRegex_),u=c&&e.match(fc.blanklineStartRegex_);return h||u?5:a||c?4:i&&!o&&l?3:o||l?2:i||s?1:0}for(var n=1;n<t.length-1;){if(0==t[n-1][0]&&0==t[n+1][0]){var r=t[n-1][1],i=t[n][1],s=t[n+1][1],o=this.diff_commonSuffix(r,i);if(o){var l=i.substring(i.length-o);r=r.substring(0,r.length-o),i=l+i.substring(0,i.length-o),s=l+s}for(var a=r,c=i,h=s,u=e(r,i)+e(i,s);i.charAt(0)===s.charAt(0);){r+=i.charAt(0),i=i.substring(1)+s.charAt(0),s=s.substring(1);var d=e(r,i)+e(i,s);d>=u&&(u=d,a=r,c=i,h=s)}t[n-1][1]!=a&&(a?t[n-1][1]=a:(t.splice(n-1,1),n--),t[n][1]=c,h?t[n+1][1]=h:(t.splice(n+1,1),n--))}n++}},fc.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,fc.whitespaceRegex_=/\s/,fc.linebreakRegex_=/[\r\n]/,fc.blanklineEndRegex_=/\n\r?\n$/,fc.blanklineStartRegex_=/^\r?\n\r?\n/,fc.prototype.diff_cleanupEfficiency=function(t){for(var e=!1,n=[],r=0,i=null,s=0,o=!1,l=!1,a=!1,c=!1;s<t.length;)0==t[s][0]?(t[s][1].length<this.Diff_EditCost&&(a||c)?(n[r++]=s,o=a,l=c,i=t[s][1]):(r=0,i=null),a=c=!1):(-1==t[s][0]?c=!0:a=!0,i&&(o&&l&&a&&c||i.length<this.Diff_EditCost/2&&o+l+a+c==3)&&(t.splice(n[r-1],0,new fc.Diff(-1,i)),t[n[r-1]+1][0]=1,r--,i=null,o&&l?(a=c=!0,r=0):(s=--r>0?n[r-1]:-1,a=c=!1),e=!0)),s++;e&&this.diff_cleanupMerge(t)},fc.prototype.diff_cleanupMerge=function(t){t.push(new fc.Diff(0,""));for(var e,n=0,r=0,i=0,s="",o="";n<t.length;)switch(t[n][0]){case 1:i++,o+=t[n][1],n++;break;case-1:r++,s+=t[n][1],n++;break;case 0:r+i>1?(0!==r&&0!==i&&(0!==(e=this.diff_commonPrefix(o,s))&&(n-r-i>0&&0==t[n-r-i-1][0]?t[n-r-i-1][1]+=o.substring(0,e):(t.splice(0,0,new fc.Diff(0,o.substring(0,e))),n++),o=o.substring(e),s=s.substring(e)),0!==(e=this.diff_commonSuffix(o,s))&&(t[n][1]=o.substring(o.length-e)+t[n][1],o=o.substring(0,o.length-e),s=s.substring(0,s.length-e))),n-=r+i,t.splice(n,r+i),s.length&&(t.splice(n,0,new fc.Diff(-1,s)),n++),o.length&&(t.splice(n,0,new fc.Diff(1,o)),n++),n++):0!==n&&0==t[n-1][0]?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,i=0,r=0,s="",o=""}""===t[t.length-1][1]&&t.pop();var l=!1;for(n=1;n<t.length-1;)0==t[n-1][0]&&0==t[n+1][0]&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),l=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),l=!0)),n++;l&&this.diff_cleanupMerge(t)},fc.prototype.diff_xIndex=function(t,e){var n,r=0,i=0,s=0,o=0;for(n=0;n<t.length&&(1!==t[n][0]&&(r+=t[n][1].length),-1!==t[n][0]&&(i+=t[n][1].length),!(r>e));n++)s=r,o=i;return t.length!=n&&-1===t[n][0]?o:o+(e-s)},fc.prototype.diff_prettyHtml=function(t){for(var e=[],n=/&/g,r=/</g,i=/>/g,s=/\n/g,o=0;o<t.length;o++){var l=t[o][0],a=t[o][1].replace(n,"&amp;").replace(r,"&lt;").replace(i,"&gt;").replace(s,"&para;<br>");switch(l){case 1:e[o]='<ins style="background:#e6ffe6;">'+a+"</ins>";break;case-1:e[o]='<del style="background:#ffe6e6;">'+a+"</del>";break;case 0:e[o]="<span>"+a+"</span>"}}return e.join("")},fc.prototype.diff_text1=function(t){for(var e=[],n=0;n<t.length;n++)1!==t[n][0]&&(e[n]=t[n][1]);return e.join("")},fc.prototype.diff_text2=function(t){for(var e=[],n=0;n<t.length;n++)-1!==t[n][0]&&(e[n]=t[n][1]);return e.join("")},fc.prototype.diff_levenshtein=function(t){for(var e=0,n=0,r=0,i=0;i<t.length;i++){var s=t[i][0],o=t[i][1];switch(s){case 1:n+=o.length;break;case-1:r+=o.length;break;case 0:e+=Math.max(n,r),n=0,r=0}}return e+=Math.max(n,r)},fc.prototype.diff_toDelta=function(t){for(var e=[],n=0;n<t.length;n++)switch(t[n][0]){case 1:e[n]="+"+encodeURI(t[n][1]);break;case-1:e[n]="-"+t[n][1].length;break;case 0:e[n]="="+t[n][1].length}return e.join("\t").replace(/%20/g," ")},fc.prototype.diff_fromDelta=function(t,e){for(var n=[],r=0,i=0,s=e.split(/\t/g),o=0;o<s.length;o++){var l=s[o].substring(1);switch(s[o].charAt(0)){case"+":try{n[r++]=new fc.Diff(1,decodeURI(l))}catch(t){throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var a=parseInt(l,10);if(isNaN(a)||a<0)throw new Error("Invalid number in diff_fromDelta: "+l);var c=t.substring(i,i+=a);"="==s[o].charAt(0)?n[r++]=new fc.Diff(0,c):n[r++]=new fc.Diff(-1,c);break;default:if(s[o])throw new Error("Invalid diff operation in diff_fromDelta: "+s[o])}}if(i!=t.length)throw new Error("Delta length ("+i+") does not equal source text length ("+t.length+").");return n},fc.prototype.match_main=function(t,e,n){if(null==t||null==e||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,t.length)),t==e?0:t.length?t.substring(n,n+e.length)==e?n:this.match_bitap_(t,e,n):-1},fc.prototype.match_bitap_=function(t,e,n){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var r=this.match_alphabet_(e),i=this;function s(t,r){var s=t/e.length,o=Math.abs(n-r);return i.Match_Distance?s+o/i.Match_Distance:o?1:s}var o=this.Match_Threshold,l=t.indexOf(e,n);-1!=l&&(o=Math.min(s(0,l),o),-1!=(l=t.lastIndexOf(e,n+e.length))&&(o=Math.min(s(0,l),o)));var a,c,h=1<<e.length-1;l=-1;for(var u,d=e.length+t.length,f=0;f<e.length;f++){for(a=0,c=d;a<c;)s(f,n+c)<=o?a=c:d=c,c=Math.floor((d-a)/2+a);d=c;var p=Math.max(1,n-c+1),g=Math.min(n+c,t.length)+e.length,m=Array(g+2);m[g+1]=(1<<f)-1;for(var y=g;y>=p;y--){var v=r[t.charAt(y-1)];if(m[y]=0===f?(m[y+1]<<1|1)&v:(m[y+1]<<1|1)&v|(u[y+1]|u[y])<<1|1|u[y+1],m[y]&h){var x=s(f,y-1);if(x<=o){if(o=x,!((l=y-1)>n))break;p=Math.max(1,2*n-l)}}}if(s(f+1,n)>o)break;u=m}return l},fc.prototype.match_alphabet_=function(t){for(var e={},n=0;n<t.length;n++)e[t.charAt(n)]=0;for(n=0;n<t.length;n++)e[t.charAt(n)]|=1<<t.length-n-1;return e},fc.prototype.patch_addContext_=function(t,e){if(0!=e.length){if(null===t.start2)throw Error("patch not initialized");for(var n=e.substring(t.start2,t.start2+t.length1),r=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)r+=this.Patch_Margin,n=e.substring(t.start2-r,t.start2+t.length1+r);r+=this.Patch_Margin;var i=e.substring(t.start2-r,t.start2);i&&t.diffs.unshift(new fc.Diff(0,i));var s=e.substring(t.start2+t.length1,t.start2+t.length1+r);s&&t.diffs.push(new fc.Diff(0,s)),t.start1-=i.length,t.start2-=i.length,t.length1+=i.length+s.length,t.length2+=i.length+s.length}},fc.prototype.patch_make=function(t,e,n){var r,i;if("string"==typeof t&&"string"==typeof e&&void 0===n)r=t,(i=this.diff_main(r,e,!0)).length>2&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(t&&"object"==typeof t&&void 0===e&&void 0===n)i=t,r=this.diff_text1(i);else if("string"==typeof t&&e&&"object"==typeof e&&void 0===n)r=t,i=e;else{if("string"!=typeof t||"string"!=typeof e||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");r=t,i=n}if(0===i.length)return[];for(var s=[],o=new fc.patch_obj,l=0,a=0,c=0,h=r,u=r,d=0;d<i.length;d++){var f=i[d][0],p=i[d][1];switch(l||0===f||(o.start1=a,o.start2=c),f){case 1:o.diffs[l++]=i[d],o.length2+=p.length,u=u.substring(0,c)+p+u.substring(c);break;case-1:o.length1+=p.length,o.diffs[l++]=i[d],u=u.substring(0,c)+u.substring(c+p.length);break;case 0:p.length<=2*this.Patch_Margin&&l&&i.length!=d+1?(o.diffs[l++]=i[d],o.length1+=p.length,o.length2+=p.length):p.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(o,h),s.push(o),o=new fc.patch_obj,l=0,h=u,a=c)}1!==f&&(a+=p.length),-1!==f&&(c+=p.length)}return l&&(this.patch_addContext_(o,h),s.push(o)),s},fc.prototype.patch_deepCopy=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n],i=new fc.patch_obj;i.diffs=[];for(var s=0;s<r.diffs.length;s++)i.diffs[s]=new fc.Diff(r.diffs[s][0],r.diffs[s][1]);i.start1=r.start1,i.start2=r.start2,i.length1=r.length1,i.length2=r.length2,e[n]=i}return e},fc.prototype.patch_apply=function(t,e){if(0==t.length)return[e,[]];t=this.patch_deepCopy(t);var n=this.patch_addPadding(t);e=n+e+n,this.patch_splitMax(t);for(var r=0,i=[],s=0;s<t.length;s++){var o,l,a=t[s].start2+r,c=this.diff_text1(t[s].diffs),h=-1;if(c.length>this.Match_MaxBits?-1!=(o=this.match_main(e,c.substring(0,this.Match_MaxBits),a))&&(-1==(h=this.match_main(e,c.substring(c.length-this.Match_MaxBits),a+c.length-this.Match_MaxBits))||o>=h)&&(o=-1):o=this.match_main(e,c,a),-1==o)i[s]=!1,r-=t[s].length2-t[s].length1;else if(i[s]=!0,r=o-a,c==(l=-1==h?e.substring(o,o+c.length):e.substring(o,h+this.Match_MaxBits)))e=e.substring(0,o)+this.diff_text2(t[s].diffs)+e.substring(o+c.length);else{var u=this.diff_main(c,l,!1);if(c.length>this.Match_MaxBits&&this.diff_levenshtein(u)/c.length>this.Patch_DeleteThreshold)i[s]=!1;else{this.diff_cleanupSemanticLossless(u);for(var d,f=0,p=0;p<t[s].diffs.length;p++){var g=t[s].diffs[p];0!==g[0]&&(d=this.diff_xIndex(u,f)),1===g[0]?e=e.substring(0,o+d)+g[1]+e.substring(o+d):-1===g[0]&&(e=e.substring(0,o+d)+e.substring(o+this.diff_xIndex(u,f+g[1].length))),-1!==g[0]&&(f+=g[1].length)}}}}return[e=e.substring(n.length,e.length-n.length),i]},fc.prototype.patch_addPadding=function(t){for(var e=this.Patch_Margin,n="",r=1;r<=e;r++)n+=String.fromCharCode(r);for(r=0;r<t.length;r++)t[r].start1+=e,t[r].start2+=e;var i=t[0],s=i.diffs;if(0==s.length||0!=s[0][0])s.unshift(new fc.Diff(0,n)),i.start1-=e,i.start2-=e,i.length1+=e,i.length2+=e;else if(e>s[0][1].length){var o=e-s[0][1].length;s[0][1]=n.substring(s[0][1].length)+s[0][1],i.start1-=o,i.start2-=o,i.length1+=o,i.length2+=o}if(0==(s=(i=t[t.length-1]).diffs).length||0!=s[s.length-1][0])s.push(new fc.Diff(0,n)),i.length1+=e,i.length2+=e;else if(e>s[s.length-1][1].length){o=e-s[s.length-1][1].length;s[s.length-1][1]+=n.substring(0,o),i.length1+=o,i.length2+=o}return n},fc.prototype.patch_splitMax=function(t){for(var e=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=e)){var r=t[n];t.splice(n--,1);for(var i=r.start1,s=r.start2,o="";0!==r.diffs.length;){var l=new fc.patch_obj,a=!0;for(l.start1=i-o.length,l.start2=s-o.length,""!==o&&(l.length1=l.length2=o.length,l.diffs.push(new fc.Diff(0,o)));0!==r.diffs.length&&l.length1<e-this.Patch_Margin;){var c=r.diffs[0][0],h=r.diffs[0][1];1===c?(l.length2+=h.length,s+=h.length,l.diffs.push(r.diffs.shift()),a=!1):-1===c&&1==l.diffs.length&&0==l.diffs[0][0]&&h.length>2*e?(l.length1+=h.length,i+=h.length,a=!1,l.diffs.push(new fc.Diff(c,h)),r.diffs.shift()):(h=h.substring(0,e-l.length1-this.Patch_Margin),l.length1+=h.length,i+=h.length,0===c?(l.length2+=h.length,s+=h.length):a=!1,l.diffs.push(new fc.Diff(c,h)),h==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(h.length))}o=(o=this.diff_text2(l.diffs)).substring(o.length-this.Patch_Margin);var u=this.diff_text1(r.diffs).substring(0,this.Patch_Margin);""!==u&&(l.length1+=u.length,l.length2+=u.length,0!==l.diffs.length&&0===l.diffs[l.diffs.length-1][0]?l.diffs[l.diffs.length-1][1]+=u:l.diffs.push(new fc.Diff(0,u))),a||t.splice(++n,0,l)}}},fc.prototype.patch_toText=function(t){for(var e=[],n=0;n<t.length;n++)e[n]=t[n];return e.join("")},fc.prototype.patch_fromText=function(t){var e=[];if(!t)return e;for(var n=t.split("\n"),r=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;r<n.length;){var s=n[r].match(i);if(!s)throw new Error("Invalid patch string: "+n[r]);var o=new fc.patch_obj;for(e.push(o),o.start1=parseInt(s[1],10),""===s[2]?(o.start1--,o.length1=1):"0"==s[2]?o.length1=0:(o.start1--,o.length1=parseInt(s[2],10)),o.start2=parseInt(s[3],10),""===s[4]?(o.start2--,o.length2=1):"0"==s[4]?o.length2=0:(o.start2--,o.length2=parseInt(s[4],10)),r++;r<n.length;){var l=n[r].charAt(0);try{var a=decodeURI(n[r].substring(1))}catch(t){throw new Error("Illegal escape in patch_fromText: "+a)}if("-"==l)o.diffs.push(new fc.Diff(-1,a));else if("+"==l)o.diffs.push(new fc.Diff(1,a));else if(" "==l)o.diffs.push(new fc.Diff(0,a));else{if("@"==l)break;if(""!==l)throw new Error('Invalid patch mode "'+l+'" in: '+a)}r++}}return e},fc.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},fc.patch_obj.prototype.toString=function(){for(var t,e=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],n=0;n<this.diffs.length;n++){switch(this.diffs[n][0]){case 1:t="+";break;case-1:t="-";break;case 0:t=" "}e[n+1]=t+encodeURI(this.diffs[n][1])+"\n"}return e.join("").replace(/%20/g," ")};const pc=fc,gc={init(){this.name="markup",this.mountPoint=document.querySelector("#markup");const t=this.requestSnapshot("markupTree");return this.markupEditor=qa(this.mountPoint,{lineNumbers:!0,lineWrapping:!1,mode:"xml",value:t.toMarkupString(),theme:"pen"}),this.markupDoc=this.markupEditor.getDoc(),this.previousMarkupTree=t,this},bindEvents(t){this.bindCodemirrorEvents(),this.bindCustomEvents(t)},bindCodemirrorEvents(){this.markupEditor.on("change",(t,e)=>{"reconcile"!==e.origin&&window.dispatchEvent(new CustomEvent("userChangedMarkup"))}),this.markupEditor.on("beforeSelectionChange",(t,e)=>{if(void 0!==e.origin){e.update(e.ranges);const t=e.ranges[0].anchor;t&&window.dispatchEvent(new CustomEvent("userSelectedPosition",{detail:t}))}})},bindCustomEvents(t){window.addEventListener("userChangedMarkup",e=>{t({source:this.name,type:"userChangedMarkup",value:this.markupEditor.getValue()})}),window.addEventListener("userSelectedPosition",e=>{const n=this.previousMarkupTree.findTokenByPosition(e.detail);n&&t({source:this.name,type:"userSelectedMarkupNode",key:n.key})})},react(t){if("mousemove"!==t.input.type&&"mousedown"!==t.input.type){this.clearTextMarker();const t=this.requestSnapshot("markupTree");this.previousMarkupTree.toMarkupString()!==t.toMarkupString()&&this.reconcile(t),this.placeTextMarker(t),this.previousMarkupTree=t}},reconcile(t){this.patch(this.diff(this.markupDoc.getValue(),t.toMarkupString()))},diff(t,e){const n=new pc,r=n.diff_linesToChars_(t,e),i=r.chars1,s=r.chars2,o=r.lineArray,l=n.diff_main(i,s,!1);return n.diff_charsToLines_(l,o),l},patch(t){let e=0,n=0;for(;n<t.length;){const r=t[n],i=r[0],s=r[1];switch(i){case 0:e+=this.countLines(r),n+=1;break;case-1:const o=t[n+1],l=o&&o[0],a=o&&o[1];1===l?(this.replaceLines(e,this.countLines(r),a),e+=this.countLines(o),n+=2):(this.deleteLines(e,this.countLines(r)),n+=1);break;case 1:this.insertLines(e,s),e+=this.countLines(r),n+=1}}},countLines:t=>t[1].match(/\n/g).length,deleteLines(t,e){const n=t,r=t+e;this.markupDoc.replaceRange("",{line:n,ch:0},{line:r,ch:0},"reconcile")},insertLines(t,e){this.markupDoc.replaceRange(e,{line:t,ch:0},{line:t,ch:0},"reconcile")},replaceLines(t,e,n){const r=t,i=t+e;this.markupDoc.replaceRange(n,{line:r,ch:0},{line:i,ch:0},"reconcile")},placeTextMarker(t){let e,n=t.findDescendantByClass("selected");n?(e="selected-markup",this.setMarker(n,e)):(n=t.findDescendantByClass("tip"))&&(e="tip-markup",this.setMarker(n,e))},setMarker(t,e){const n=t.getRange(),r={line:n[0].line,ch:0};this.markupEditor.scrollIntoView(r),this.textMarker=this.markupDoc.markText(...n,{className:e})},clearTextMarker(){this.textMarker&&this.textMarker.clear()}},mc=Object.assign(Object.create(be),{init(){return this.name="message",be.init.bind(this)(),this},bindEvents(t){window.addEventListener("wipeMessage",e=>{t({source:this.name,type:"wipeMessage"})})},reconcile(t,e,n){t!==e&&(n.textContent=e),this.timer&&clearTimeout(this.timer),""!==e&&(this.timer=window.setTimeout(this.wipeMessage,400))},wipeMessage(){window.dispatchEvent(new Event("wipeMessage"))}});var yc=Object.freeze({db:ge,hist:me,keyboard:ye,mouse:xe,tools:we,menu:Ce,canvas:Se,markup:gc,message:mc});const vc=[],xc={init(){pe.init(document.querySelector("#canvas-wrapper").clientWidth);for(let t of Object.values(yc))vc.includes(t)||(t.requestSnapshot=t=>pe.state.snapshot(t),t.init(),this.isInputDevice(t)&&t.bindEvents(pe.compute.bind(pe)),this.isOutputDevice(t)&&pe.attach(t.name,t.react.bind(t)));pe.kickoff(),setTimeout(()=>document.querySelector("main").classList.remove("hidden"),200)},isInputDevice:t=>!!t.bindEvents,isOutputDevice:t=>!!t.react};document.addEventListener("DOMContentLoaded",xc.init.bind(xc))}();
//# sourceMappingURL=bundle.js.map
